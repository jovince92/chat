import{c as L,r,q as A,W as _,u as F,j as e,g as C,a as R,y as P}from"./utils-d51774f8.js";import{S as I,i as T,j as q,k as H,l as W,m as z,R as O}from"./module-7887c94f.js";import{U as Y,A as Q,R as $,f as B,u as G,a as U,L as M,S as K,C as V,b as J,M as X}from"./useChatScroll-827c7ac5.js";import{I as k,B as y,L as S,A as Z,a as ee,b as se}from"./alert-1d33a961.js";import{t as D,u as te}from"./app-893070f3.js";import{A as ae,a as re,b as le,c as ne,d as ie,e as oe}from"./alert-dialog-1acda4c3.js";import{D as ce,i as de,j as me,l as xe}from"./react-drag-drop-files.esm-082b0a5e.js";import{A as ue}from"./alert-circle-f5d1043f.js";import{L as he}from"./loader-918b2076.js";import"./upload-cloud-377c13ba.js";import"./chevron-down-0c4ee3ec.js";const pe=L("School",[["path",{d:"m4 6 8-4 8 4",key:"1q0ilc"}],["path",{d:"m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2",key:"1vwozw"}],["path",{d:"M14 22v-4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v4",key:"cpkuc4"}],["path",{d:"M18 5v17",key:"1sw6gf"}],["path",{d:"M6 5v17",key:"1xfsm0"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]),fe="d MMMM yyyy HH:mm",je=({message:t,type:u,channel:d,onReply:i})=>{var w;const[s,a]=r.useState(!1),{replies:l}=A().props,[n,v]=r.useState(t.content),[o,g]=r.useState(!1),[h,m]=r.useState(!1),{user:N}=t,c=(w=t.file)==null?void 0:w.split(".").pop(),p=c==="pdf"?route("home")+"/uploads/pdf/pdf.png":t.file,f=r.useRef(null);_({user_id:t.user_id});const x=r.useCallback(j=>{j.preventDefault(),g(!0),F.post(route("server.channel.message.update",{server_id:d.server_id,channel_id:d.id}),{message:n,message_id:t.id}).then(()=>m(!1)).catch(()=>D({title:"Internal Error",description:"Please Try Again"})).finally(()=>g(!1))},[d,n,t.id,u]);r.useEffect(()=>{f.current&&f.current.focus();const j=E=>{(E.key==="Escape"||E.code==="Escape")&&m(!1)};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[]);const b=j=>{i&&i(j),a(!0)};return r.useEffect(()=>{f.current&&h&&f.current.focus()},[f,h]),e.jsx("div",{className:"relative group flex items-center hover:bg-neutral-300 dark:hover:bg-neutral-900 p-3.5 transition w-full",children:e.jsxs("div",{className:"group flex gap-x-1.5 items-start w-full",children:[e.jsx("div",{className:"cursor-pointer hover:drop-shadow-md transition",children:t.is_system_msg===0?e.jsx(Y,{user:N}):""}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex items-center gap-x-1.5",children:[e.jsx("div",{className:"flex items-center",children:t.is_system_msg===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:C("font-semibold text-sm transition"),children:N.name}),e.jsx(Q,{label:"Admin",children:e.jsx("p",{children:$.ADMIN})})]}):e.jsx("p",{className:C("font-semibold text-sm transition"),children:"System"})}),e.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:B(new Date(t.created_at),fe)})]}),t.file&&!t.deleted_at&&e.jsx("a",{href:t.file,target:"_blank",rel:"noopener noreferrer",className:C("relative aspect-square rounded-md mt-1.5 overflow-hidden border flex items-center bg-secondary ",c==="pdf"?"h-10 w-10":"h-48 w-48"),children:e.jsx("img",{src:p,alt:"file",className:"object-cover"})}),e.jsx("p",{className:C("text-xs",c==="pdf"&&!t.deleted_at?"block":"hidden"),children:"PDF File"}),!h&&e.jsxs("p",{className:C("text-sm my-4 text-neutral-600 dark:text-neutral-300",t.deleted_at&&"italic text-neutral-500 dark:text-neutral-400 text-xs mt-1"),children:[t.deleted_at?"Message Deleted":t.content,t.created_at!==t.updated_at&&!t.deleted_at&&e.jsx("span",{className:"text-[0.625rem] mx-1.5 text-neutral-500 dark:text-neutral-400",children:"(edited)"})]}),!t.file&&h&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"flex items-center w-full gap-x-1.5 pt-1.5",onSubmit:x,children:[e.jsx("div",{className:"flex-1",children:e.jsx(k,{disabled:o,ref:f,value:n,onChange:({target:j})=>v(j.value),className:"p-1.5 bg-neutral-200/90 dark:bg-neutral-700/75 border-none !border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0 text-neutral-600 dark:text-neutral-200"})}),e.jsx(y,{size:"sm",disabled:o,children:"Save"})]}),e.jsx("span",{className:"text-[0.625rem] mt-1 text-neutral-400",children:"Press ESC to cancel. Press Enter to save."})]}),t.is_system_msg===1&&!s&&d.is_closed!==1&&e.jsx("div",{className:"w-full grid grid-cols-2 gap-3 pb-3.5",children:l.map(j=>e.jsx(y,{variant:"outline",size:"sm",onClick:()=>b(j),children:j},j))})]})]})})},ge=({channel:t,getMsgsRoute:u,onReply:d})=>{var m,N;const i=r.useRef(null),s=r.useRef(null),{data:a,fetchNextPage:l,hasNextPage:n,isFetchingNextPage:v,status:o}=G({queryRoute:u,queryKey:`channel_${t.id.toString()}`,value:"0"}),g=()=>{if(!(a!=null&&a.pages))return null;l()};U({chatRef:i,bottomRef:s,loadMore:g,shouldLoadMore:!v&&!!n,count:((N=(m=a==null?void 0:a.pages)==null?void 0:m[0])==null?void 0:N.data.length)??0});const h=a==null?void 0:a.pages;return o==="loading"?e.jsxs("div",{className:"flex flex-col flex-1 justify-center items-center",children:[e.jsx(M,{className:"h-7 w-7 text-neutral-500 animate-spin my-3.5"}),e.jsx("p",{className:"text-xs",children:"Loading Messages..."})]}):o==="error"?e.jsxs("div",{className:"flex flex-col flex-1 justify-center items-center",children:[e.jsx(K,{className:"h-7 w-7 text-neutral-500 my-3.5"}),e.jsx("p",{className:"text-xs",children:"Server Error"})]}):e.jsxs("div",{ref:i,className:"flex-1 flex flex-col py-3.5 overflow-y-auto",children:[!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1"}),e.jsx(V,{type:"Channel",name:t.name})]}),n&&e.jsx("div",{className:"flex justify-center",children:v?e.jsx(M,{className:"h-6 w-6 text-neutral-600 animate-ping"}):e.jsx("button",{onClick:g,className:"text-neutral-500 hover:text-neutral-600 dark:text-neutral-400 dark:hover:text-neutral-300 transition text-xs",children:"Load Previous Messages..."})}),e.jsx("div",{className:"flex flex-col-reverse mt-auto",children:h==null?void 0:h.map((c,p)=>{var f;return e.jsx(r.Fragment,{children:(f=c.data)==null?void 0:f.map(x=>e.jsx(je,{onReply:b=>d&&d(b),channel:t,type:"Channel",message:x},x.id))},p)})}),e.jsx("div",{ref:s})]})},ve=({isOpen:t,channel:u,onClose:d,user:i})=>{const[s,a]=r.useState(u),[l,n]=r.useState(!1);A().props;const v=r.useMemo(()=>route("server.channel.message.store",{server_id:(s==null?void 0:s.server_id)||"",channel_id:(s==null?void 0:s.id)||""}),[s]),o=r.useMemo(()=>route("server.channel.message.index",{server_id:(s==null?void 0:s.server_id)||"",channel_id:(s==null?void 0:s.id)||""}),[s]),g=te(),[h,m]=r.useState(!1),N=c=>{F.post(v,{message:c}).then(()=>n(!0)).catch(()=>D({title:"Internal Error",description:"Can't send message. Please try again!"}))};return r.useEffect(()=>{s&&window.Echo.join("channel_"+s.id.toString()).listen("NewChatMessageEvent",({message:c})=>{g.setQueryData([`channel_${s.id.toString()}`],p=>{const{pages:f}=p,x=f;return x[0]={...x[0],data:[c,...x[0].data]},{...p,pages:x}})}).listen("MessageUpdateEvent",({message:c})=>{g.setQueryData([`channel_${s.id.toString()}`],p=>{const{pages:f}=p,x=f;return x[0]={...x[0],data:x[0].data.map(w=>w.id!==c.id?w:c)},{...p,pages:x}})}).listen("CloseCaseEvent",c=>{s&&a(p=>({...p,is_closed:1}))})},[s==null?void 0:s.id,g]),!s||!i?null:e.jsxs(e.Fragment,{children:[e.jsx(I,{open:t,children:e.jsxs(T,{className:"h-full flex flex-col overflow-y-hidden space-y-2",children:[e.jsxs(q,{className:"h-auto",children:[e.jsx(H,{children:"Welcome to Chat Support"}),e.jsx(W,{children:"You Are Now Connected to Chat Support. Please be patient while we assign an agent"})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-y-hidden",children:e.jsx("div",{className:"flex-1 mb-2",children:e.jsx(ge,{onReply:N,getMsgsRoute:o,channel:s})})}),s.is_closed!==1?e.jsx(J,{apiRoute:v,type:"Channel",name:"Chat Support"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx("p",{className:"font-semibold text-lg tracking-tight",children:"This Case Has Been Closed. You Can Not Reply To This Thread Anymore"}),(s.rating<0||!(s!=null&&s.rating))&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold text-lg tracking-tight",children:"Would You Like To Give a Feedback?"}),e.jsx(y,{onClick:()=>m(!0),children:"Give Feedback"})]}),s.rating>-1&&e.jsx("p",{className:"font-semibold text-lg tracking-tight",children:"Thank You For Your Feedback"})]})]})}),e.jsx(Ne,{onFeedback:c=>{a(p=>({...p,rating:c}))},channel_id:s.id,isOpen:h,onClose:()=>m(!1)}),e.jsx(X,{})]})},Ne=({isOpen:t,onClose:u,channel_id:d,onFeedback:i})=>{const[s,a]=r.useState(0),l=()=>{F.post(route("support.feedback"),{rating:s,channel_id:d}).then(()=>{u(),i(s)}).catch(n=>D({description:"Something Went Wrong. Please try again",variant:"destructive"}))};return e.jsx(ae,{open:t,children:e.jsxs(re,{children:[e.jsxs(le,{children:[e.jsx(ne,{children:"Please rate us! "}),e.jsx(ie,{asChild:!0,children:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:" We appreciate your feedback."}),e.jsx("div",{style:{direction:"ltr",fontFamily:"sans-serif",touchAction:"none"},children:e.jsx(O,{allowHover:!1,transition:!0,SVGclassName:"inline-block",onClick:n=>a(n)})})]})})]}),e.jsxs(oe,{children:[e.jsx(y,{onClick:u,size:"sm",variant:"outline",children:"Cancel"}),e.jsx(y,{onClick:l,size:"sm",children:"Proceed"})]})]})})},Le=({channel:t,user:u})=>{const{data:d,setData:i,post:s,get:a,processing:l,errors:n,reset:v}=_({name:"",email:"",password:"",password_confirmation:""}),o=m=>{m.preventDefault(),s(route("support.enter"),{preserveState:!1,onError:N=>{console.error(N)}})},[g,h]=r.useState(!1);return console.log([t,u]),e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"Welcome to Chat Support"}),e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 text-primary py-4 text-center md:text-left shadow-md",children:e.jsxs("div",{className:"container flex items-center mx-auto ",children:[e.jsxs("h1",{className:"text-xl font-extrabold w-full flex items-center",children:[e.jsx(pe,{className:"mr-4"}),e.jsx("span",{children:"Lorem Ipsum"})]}),e.jsx("button",{onClick:()=>h(!0),className:"hidden md:block bg-primary rounded text-secondary text-sm ml-auto w-28 p-2",children:"Login"})]})}),e.jsx("section",{className:"py-10 bg-gray-300 dark:bg-gray-700 flex-1",children:e.jsxs("div",{className:"container flex flex-col-reverse md:flex-row items-center",children:[e.jsxs("div",{className:`w-full p-5 bg-gray-100/50 dark:bg-gray-600 rounded-md shadow-md
                                    md:w-1/3`,children:[e.jsx("h1",{className:"font-bold",children:"For inquiry or support"}),e.jsx("p",{className:"text-sm mt-1 mb-5",children:"Send us a message by providing contact details"}),e.jsxs("form",{onSubmit:o,children:[e.jsxs("div",{className:"grid flex-1 gap-2 mb-4",children:[e.jsx(S,{htmlFor:"name",children:"Name:"}),e.jsx(k,{required:!0,autoFocus:!0,autoComplete:"off",disabled:l,value:d.name,onChange:({target:m})=>i("name",m.value),id:"name",className:"dark:bg-gray-700"}),n.email&&e.jsx("span",{children:n.name})]}),e.jsxs("div",{className:"grid flex-1 gap-2",children:[e.jsx(S,{htmlFor:"email",children:"Email:"}),e.jsx(k,{required:!0,type:"email",autoComplete:"off",disabled:l,value:d.email,onChange:({target:m})=>i("email",m.value),id:"email",className:"dark:bg-gray-700"}),n.email&&e.jsx("span",{children:n.email})]}),e.jsx("div",{className:"flex items-center justify-center mt-4",children:e.jsx(y,{className:"ml-4",disabled:l,children:"Send Message"})})]})]}),e.jsx("div",{className:"mb-5 md:mb-0 md:ml-auto",children:e.jsx("img",{src:`${route("landing")}/images/school.svg`,className:"w-full h-[15rem] md:h-[30rem]"})})]})})]}),e.jsx(ve,{isOpen:!!t,onClose:()=>{},channel:t,user:u}),e.jsx(ye,{openLogin:g,onClose:()=>h(!1)})]})},ye=({openLogin:t,onClose:u})=>{const{data:d,setData:i,post:s,processing:a,errors:l,reset:n}=_({email:"",password:"",remember:!1});r.useEffect(()=>()=>{n("password")},[]);const v=o=>{o.preventDefault(),s(route("login"),{onSuccess:()=>P.get(route("home"))})};return e.jsx(ce,{open:t,onOpenChange:u,children:e.jsxs(de,{className:"sm:max-w-[425px]",children:[e.jsx(me,{}),e.jsx(xe,{}),e.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[e.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Sign In"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter your email and password"})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("form",{onSubmit:v,children:[(l.email||l.password)&&e.jsxs(Z,{variant:"destructive",className:"mb-6",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(ee,{children:"Error"}),e.jsxs(se,{className:"flex flex-col space-y-1.5",children:[e.jsx("span",{children:l==null?void 0:l.email}),e.jsx("span",{children:l==null?void 0:l.password})]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(k,{required:!0,id:"email",placeholder:"name@example.com",type:"text",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:a,onChange:({target:o})=>i("email",o.value)})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(S,{htmlFor:"password",children:"Password"}),e.jsx(k,{required:!0,id:"password",placeholder:"password",type:"password",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:a,onChange:({target:o})=>i("password",o.value)})]}),e.jsxs(y,{disabled:a,children:[a&&e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center"})})]})]})]})})};export{Le as default};
