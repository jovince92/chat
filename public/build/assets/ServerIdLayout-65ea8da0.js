import{c as Oe,q as ce,j as f,g as Xt,y as In,K as fl,W as Ye,r as d,u as si,v as pl,L as ml,w as gl,M as vl}from"./utils-d51774f8.js";import{D as xe,i as Pe,j as Re,k as Le,m as un,l as gt,E as Na,A as Ci,x as vn,B as cn,C as Kt,F as bl,G as Ia,H as Ki,I as yl,J as kl}from"./react-drag-drop-files.esm-082b0a5e.js";import{S as Ma,a as _a,b as Da,c as Aa,d as Oa,u as Sl}from"./index-536976de.js";import{B as Q,L as ge,I as Me,A as qr,a as zr,b as Wr}from"./alert-1d33a961.js";import{D as Hr,t as Gr,v as Kr,w as pn,I as La,N as Tl,x as Ua,u as Ne,g as fr,O as Cl,Q as wl,U as El,V as xl,S as Pl,W as Rl,i as Nl,M as Il,X as Ml,Y as _l,Z as Dl,_ as Al}from"./module-7887c94f.js";import{t as mt,k as $t}from"./app-893070f3.js";import{U as ja}from"./upload-cloud-377c13ba.js";import{A as $r}from"./alert-circle-f5d1043f.js";import{A as wi,U as Li,c as Fa,L as Ba,d as Ol,M as Ll,e as Ja,V as Ul,H as jl,R as Fl,f as Bl,T as Jl}from"./useChatScroll-827c7ac5.js";import{L as Va}from"./loader-918b2076.js";const Vl=Oe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),ql=Oe("Gavel",[["path",{d:"m14 13-7.5 7.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L11 10",key:"c9cbz0"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]]),zl=Oe("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Wl=Oe("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),Hl=Oe("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Gl=Oe("PlusSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),Kl=Oe("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),$l=Oe("ShieldQuestion",[["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]]),Ql=Oe("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Yl=Oe("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),Zl=Oe("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Xl=Oe("XSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),eu=({server:n})=>{const{current_server:e}=ce().props,{id:t,name:i,image:r,invite_code:s,users:a,user:o,created_at:l}=n,c=()=>{In.get(route("server.index",{server_id:t}))};return f.jsx(wi,{label:i,align:"center",side:"right",children:f.jsxs("button",{onClick:c,className:"group relative flex items-center",children:[f.jsx("div",{className:Xt("absolute left-0 bg-primary rounded-r-full transition-all w-[0.25rem]",e.id!==t&&"group-hover:h-[1.3rem]",e.id===t?"h-[2.25rem]":"h-[0.5rem]")}),f.jsx("div",{className:Xt("relative group flex mx-2.5 h-12 w-12 rounded-[1.5rem] group-hover:rounded-[1rem] overflow-hidden",e.id===t&&"bg-primary/10 text-primary rounded-[1rem]"),children:f.jsx("img",{className:"object-cover",src:r})})]})})},tu=()=>{const{setTheme:n}=fl();return f.jsxs(Hr,{children:[f.jsx(Gr,{asChild:!0,children:f.jsxs(Q,{className:"bg-transparent",variant:"outline",size:"icon",children:[f.jsx(Yl,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),f.jsx(Wl,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),f.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),f.jsxs(Kr,{align:"end",children:[f.jsx(pn,{onClick:()=>n("light"),children:"Light"}),f.jsx(pn,{onClick:()=>n("dark"),children:"Dark"}),f.jsx(pn,{onClick:()=>n("system"),children:"System"})]})]})},qa=()=>{const{auth:n,servers:e,current_server:t}=ce().props,{user:i}=n;return f.jsxs("div",{className:"flex flex-col space-y-3.5 items-center h-full text-primary w-full bg-neutral-200 dark:bg-neutral-900  py-2.5",children:[f.jsx(La,{className:"flex-1 w-full",children:e.map(r=>f.jsx("div",{className:"mb-3.5",children:f.jsx(eu,{server:r})},r.id))}),f.jsx(tu,{}),f.jsxs(Hr,{children:[f.jsx(Gr,{asChild:!0,children:f.jsx("div",{role:"button",className:"flex items-center justify-center text-sm p-2.5 mb-4",children:f.jsx(Li,{user:i})})}),f.jsxs(Kr,{className:"w-80",align:"start",alignOffset:11,forceMount:!0,children:[f.jsx(Tl,{className:"font-normal",children:f.jsx("div",{className:"flex flex-col space-y-1",children:f.jsx("p",{className:"text-sm font-medium leading-none",children:i.name})})}),f.jsx(Ua,{}),f.jsx(pn,{onClick:()=>In.post(route("logout")),children:"Log out"})]})]})]})},nu=["TEXT","AUDIO","VIDEO"],iu=()=>{const{current_server:n}=ce().props,{isOpen:e,onClose:t,type:i,data:r}=Ne(),{channelType:s}=r,{data:a,setData:o,post:l,processing:c,errors:u,reset:h}=Ye({server_id:n.id,name:"",type:"TEXT"}),p=g=>{g.preventDefault(),l(route("server.channel.store",{server_id:a.server_id}),{onSuccess:()=>{t(),mt({title:"Success",description:"Channel Created"})}})},v=d.useMemo(()=>e&&i==="CreateChannel",[e,i]),b=()=>{h(),t()};return d.useEffect(()=>{u.name&&mt({variant:"destructive",title:"Error",description:u.name}),u.type&&mt({variant:"destructive",title:"Error",description:u.type})},[u]),d.useEffect(()=>{s&&o("type",s)},[s]),f.jsx(xe,{open:v,onOpenChange:b,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsx(Re,{className:"pt-7 px-5",children:f.jsx(Le,{className:"text-2xl text-center font-bold",children:"Create Channel"})}),f.jsx("form",{id:"channel",onSubmit:p,className:"flex flex-col space-y-7",children:f.jsxs("div",{className:"flex flex-col space-y-7 px-5",children:[f.jsxs("div",{className:"flex flex-col space-y-1",children:[f.jsx(ge,{className:"uppercase text-xs font-bold",children:"Channel Name"}),f.jsx(Me,{value:a.name,onChange:({target:g})=>o("name",g.value),required:!0,disabled:c,className:"border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0",placeholder:"Channel Name...."})]}),f.jsxs("div",{className:"flex flex-col space-y-1",children:[f.jsx(ge,{className:"uppercase text-xs font-bold",children:"Channel Type"}),f.jsxs(Ma,{disabled:c,value:a.type,onValueChange:g=>o("type",g),children:[f.jsx(_a,{className:"bg-secondary border-0 focus:ring-0 ring-offset-0 focus:ring-offset-0 capitalize outline-none",children:f.jsx(Da,{placeholder:"Select Channel Type"})}),f.jsx(Aa,{children:nu.map(g=>f.jsx(Oa,{value:g,className:"capitalize",children:g},g))})]})]})]})}),f.jsx(un,{className:"px-5 py-3.5",children:f.jsx(Q,{disabled:c,form:"channel",className:"ml-auto",children:"Create Channel"})})]})})},ru=["JPG","PNG","WEBP","JPEG"],su=()=>{const{isOpen:n,onClose:e,type:t}=Ne(),[i,r]=d.useState(""),{data:s,setData:a,post:o,processing:l,errors:c,reset:u}=Ye({name:"",image:void 0}),h=S=>{S.preventDefault(),o(route("server.store"),{onSuccess:()=>e()})},p=S=>{var E;const{target:k}=S;if(!k.files||((E=k.files)==null?void 0:E.length)<1)return null;const C=k.files[0],I=URL.createObjectURL(C);a("image",C),r(I)},v=S=>{const k=URL.createObjectURL(S);a("image",S),r(k)},b=d.useMemo(()=>n&&t==="CreateServer",[n,t]),g=()=>{u(),e()};return f.jsx(xe,{open:b,onOpenChange:g,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsx(Le,{className:"text-2xl text-center font-bold",children:"Create a Server"}),f.jsx(gt,{className:"text-center",children:"Provide Server Name and Image..."})]}),f.jsx("form",{id:"server",onSubmit:h,className:"flex flex-col space-y-7",children:f.jsxs("div",{className:"flex flex-col space-y-7 px-5",children:[f.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[(c.name||c.image)&&f.jsx(au,{messages:[(c==null?void 0:c.name)||"",(c==null?void 0:c.image)||""]}),f.jsx(Na,{hoverTitle:"Upload or drop a file right here",handleChange:v,name:"file",types:ru,children:f.jsxs("label",{htmlFor:"image",className:"flex flex-col items-center justify-center cursor-pointer p-6",children:[i?f.jsx("img",{src:i,width:150,height:150}):f.jsx(ja,{size:150}),f.jsx("p",{children:"Click to Select an Image"}),f.jsx("p",{children:"Or Drag and Drop Images Here..."})]})}),f.jsx("input",{accept:".png,.jpeg,.jpg,.webp,",onChange:p,type:"file",hidden:!0,id:"image"})]}),f.jsxs("div",{className:"flex flex-col space-y-1",children:[f.jsx(ge,{className:"uppercase text-xs font-bold",children:"Server Name"}),f.jsx(Me,{value:s.name,onChange:({target:S})=>a("name",S.value),required:!0,disabled:l,className:"border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0",placeholder:"Server Name...."})]})]})}),f.jsx(un,{className:"px-5 py-3.5",children:f.jsx(Q,{disabled:l,form:"server",className:"ml-auto",children:"Create Server"})})]})})},au=({messages:n})=>f.jsxs(qr,{variant:"destructive",children:[f.jsx($r,{className:"h-4 w-4"}),f.jsx(zr,{children:"Error"}),f.jsx(Wr,{className:"flex flex-col",children:n.map(e=>e.length>0&&f.jsx("span",{children:e},e))})]}),ou=()=>{const{current_server:n,current_channel:e}=ce().props,{isOpen:t,onClose:i,type:r,data:s}=Ne(),{channel:a}=s,{toast:o}=$t(),{post:l,processing:c,setData:u}=Ye({channel_id:a==null?void 0:a.id,current_channel_id:e==null?void 0:e.id}),h=()=>{l(route("server.channel.destroy",{server_id:n.id}),{onSuccess:()=>{i(),o({title:"Done",description:"You have deleted the Channel "+(a==null?void 0:a.name)})}})},p=d.useMemo(()=>t&&r==="DeleteChannel",[t,r]);return d.useEffect(()=>{a!=null&&a.id&&u("channel_id",a.id)},[a==null?void 0:a.id,e==null?void 0:e.id]),d.useEffect(()=>{e!=null&&e.id&&u("current_channel_id",e.id)},[e==null?void 0:e.id]),f.jsx(xe,{open:p,onOpenChange:i,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsxs(Le,{className:"text-2xl text-center font-bold",children:["Delete User Conversation ",f.jsxs("span",{className:"font-semibold text-indigo-500",children:["#",a==null?void 0:a.name]})," ?"]}),f.jsx(gt,{className:"text-center",children:"This action is irreversible..."})]}),f.jsx(un,{className:"px-5 py-3.5  bg-primary-foreground",children:f.jsxs("div",{className:"flex justify-between items-center w-full",children:[f.jsx(Q,{variant:"outline",onClick:i,disabled:c,children:"Cancel"}),f.jsx(Q,{variant:"destructive",onClick:h,disabled:c||!(a!=null&&a.id),children:"Confirm"})]})})]})})},cu=()=>{const{isOpen:n,onClose:e,type:t}=Ne(),{current_server:i}=ce().props,{toast:r}=$t(),{post:s,processing:a}=Ye({server_id:i.id}),o=()=>{s(route("server.destroy",{server_id:i.id}),{onSuccess:()=>{e(),r({title:"Done",description:"You have deleted the Server "+i.name})}})},l=d.useMemo(()=>n&&t==="DeleteServer",[n,t]);return f.jsx(xe,{open:l,onOpenChange:e,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsxs(Le,{className:"text-2xl text-center font-bold",children:["Delete Server ",f.jsx("span",{className:"font-semibold text-indigo-500",children:i.name})," ?"]}),f.jsx(gt,{className:"text-center",children:"This action is irreversible..."})]}),f.jsx(un,{className:"px-5 py-3.5  bg-primary-foreground",children:f.jsxs("div",{className:"flex justify-between items-center w-full",children:[f.jsx(Q,{variant:"outline",onClick:e,disabled:a,children:"Cancel"}),f.jsx(Q,{variant:"destructive",onClick:o,disabled:a,children:"Confirm"})]})})]})})},lu=()=>{const{isOpen:n,onClose:e,type:t,data:i}=Ne(),{toast:r}=$t(),[s,a]=d.useState(!1),o=()=>{if(!i.apiRoute)return null;si.post(i.apiRoute).then(()=>{r({title:"Done",description:"Message Deleted"}),e()}).catch(()=>r({title:"Error",description:"Please try again",variant:"destructive"}))},l=d.useMemo(()=>n&&t==="DeleteMessage",[n,t]);return f.jsx(xe,{open:l,onOpenChange:e,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsx(Le,{className:"text-2xl text-center font-bold",children:"Delete Message"}),f.jsx(gt,{className:"text-center",children:"Are you sure?"})]}),f.jsx(un,{className:"px-5 py-3.5  bg-primary-foreground",children:f.jsxs("div",{className:"flex justify-between items-center w-full",children:[f.jsx(Q,{variant:"outline",onClick:e,disabled:s,children:"Cancel"}),f.jsx(Q,{variant:"destructive",onClick:o,disabled:s,children:"Confirm"})]})})]})})},uu=["TEXT","AUDIO","VIDEO"],du=()=>{const{current_server:n}=ce().props,{isOpen:e,onClose:t,type:i,data:r}=Ne(),{channel:s}=r,{data:a,setData:o,post:l,processing:c,errors:u,reset:h}=Ye({channel_id:s==null?void 0:s.id,name:(s==null?void 0:s.name)||"",type:(s==null?void 0:s.type)||"TEXT"}),p=g=>{g.preventDefault(),l(route("server.channel.update",{server_id:n.id}),{onSuccess:()=>{t(),mt({title:"Success",description:"Channel Updated"})}})},v=d.useMemo(()=>e&&i==="EditChannel",[e,i]),b=()=>{h(),t()};return d.useEffect(()=>{u.name&&mt({variant:"destructive",title:"Error",description:u.name}),u.type&&mt({variant:"destructive",title:"Error",description:u.type})},[u]),d.useEffect(()=>{s&&o(g=>({...g,name:s.name,type:s.type,channel_id:s.id}))},[s]),f.jsx(xe,{open:v,onOpenChange:b,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsx(Re,{className:"pt-7 px-5",children:f.jsx(Le,{className:"text-2xl text-center font-bold",children:"Edit Channel "})}),f.jsx("form",{id:"channel",onSubmit:p,className:"flex flex-col space-y-7",children:f.jsxs("div",{className:"flex flex-col space-y-7 px-5",children:[f.jsxs("div",{className:"flex flex-col space-y-1",children:[f.jsx(ge,{className:"uppercase text-xs font-bold",children:"Channel Name"}),f.jsx(Me,{value:a.name,onChange:({target:g})=>o("name",g.value),required:!0,disabled:c,className:"border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0",placeholder:"Channel Name...."})]}),f.jsxs("div",{className:"flex flex-col space-y-1",children:[f.jsx(ge,{className:"uppercase text-xs font-bold",children:"Channel Type"}),f.jsxs(Ma,{disabled:c,value:a.type,onValueChange:g=>o("type",g),children:[f.jsx(_a,{className:"bg-secondary border-0 focus:ring-0 ring-offset-0 focus:ring-offset-0 capitalize outline-none",children:f.jsx(Da,{placeholder:"Select Channel Type"})}),f.jsx(Aa,{children:uu.map(g=>f.jsx(Oa,{value:g,className:"capitalize",children:g},g))})]})]})]})}),f.jsx(un,{className:"px-5 py-3.5",children:f.jsx(Q,{disabled:c,form:"channel",className:"ml-auto",children:"Save Changes"})})]})})},hu=["JPG","PNG","WEBP","JPEG"],fu=()=>{const{current_server:n}=ce().props,{isOpen:e,onClose:t,type:i}=Ne(),{toast:r}=$t(),[s,a]=d.useState(n.image),{data:o,setData:l,post:c,processing:u,errors:h,reset:p}=Ye({server_id:n.id,name:n.name,image:void 0}),v=C=>{C.preventDefault(),c(route("server.update"),{onSuccess:()=>{t(),r({title:"Successs!",description:"Server Updated"})}})},b=C=>{var L;const{target:I}=C;if(!I.files||((L=I.files)==null?void 0:L.length)<1)return null;const E=I.files[0],D=URL.createObjectURL(E);l("image",E),a(D)},g=C=>{const I=URL.createObjectURL(C);l("image",C),a(I)},S=d.useMemo(()=>e&&i==="EditServer",[e,i]),k=()=>{p(),t()};return f.jsx(xe,{open:S,onOpenChange:k,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsx(Le,{className:"text-2xl text-center font-bold",children:"Edit Server"}),f.jsx(gt,{className:"text-center",children:"Update Server Name and Image(optional)"})]}),f.jsx("form",{id:"server",onSubmit:v,className:"flex flex-col space-y-7",children:f.jsxs("div",{className:"flex flex-col space-y-7 px-5",children:[f.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[(h.name||h.image)&&f.jsx(pu,{messages:[(h==null?void 0:h.name)||"",(h==null?void 0:h.image)||""]}),f.jsx(Na,{hoverTitle:"Upload or drop a file right here",handleChange:g,name:"file",types:hu,children:f.jsxs("label",{htmlFor:"image",className:"flex flex-col items-center justify-center cursor-pointer p-6",children:[s?f.jsx("img",{src:s,width:150,height:150}):f.jsx(ja,{size:150}),f.jsx("p",{children:"Click to Select an Image"}),f.jsx("p",{children:"Or Drag and Drop Images Here..."})]})}),f.jsx("input",{accept:".png,.jpeg,.jpg,.webp,",onChange:b,type:"file",hidden:!0,id:"image"})]}),f.jsxs("div",{className:"flex flex-col space-y-1",children:[f.jsx(ge,{className:"uppercase text-xs font-bold",children:"Server Name"}),f.jsx(Me,{value:o.name,onChange:({target:C})=>l("name",C.value),required:!0,disabled:u,className:"border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0",placeholder:"Server Name...."})]})]})}),f.jsx(un,{className:"px-5 py-3.5",children:f.jsx(Q,{disabled:u,form:"server",className:"ml-auto",children:"Update Server"})})]})})},pu=({messages:n})=>f.jsxs(qr,{variant:"destructive",children:[f.jsx($r,{className:"h-4 w-4"}),f.jsx(zr,{children:"Error"}),f.jsx(Wr,{className:"flex flex-col",children:n.map(e=>e.length>0&&f.jsx("span",{children:e},e))})]}),mu=()=>{const{isOpen:n,onClose:e,type:t}=Ne(),{current_server:i}=ce().props,[r,s]=d.useState(!1),[a,o]=d.useState(!1),[l,c]=d.useState(route("server.invite",{invite_code:i.invite_code})),{toast:u}=$t(),h=()=>{navigator.clipboard.writeText(l),s(!0),u({title:"Copied"}),setTimeout(()=>{s(!1)},1e3)},p=d.useMemo(()=>n&&t==="Invite",[n,t]),v=d.useCallback(()=>{o(!0),si.post(route("server.generate"),{server_id:i.id}).then(({data:b})=>c(route("server.invite",{invite_code:b}))).catch(b=>u({title:"Internal Error",description:"Please Try again",variant:"destructive"})).finally(()=>o(!1))},[a,i]);return f.jsx(xe,{open:p,onOpenChange:e,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsx(Re,{className:"pt-7 px-5",children:f.jsx(Le,{className:"text-2xl text-center font-bold",children:"Invite People"})}),f.jsxs("div",{className:"p-5",children:[f.jsx(ge,{className:"uppercase text-xs font-bold text-muted-foreground",children:"Server Invite Link"}),f.jsxs("div",{className:"flex items-center mt-1.5 gap-x-1.5",children:[f.jsx(Me,{readOnly:!0,disabled:a,className:"bg-secondary !border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0",value:l}),f.jsx(Q,{disabled:a,onClick:h,size:"icon",children:r?f.jsx(fr,{className:"h-4 w-4"}):f.jsx(Vl,{className:"w-4 h-4"})})]}),f.jsxs(Q,{disabled:a,onClick:v,variant:"link",size:"sm",className:"text-xs",children:["Generate new Link",f.jsx(Kl,{className:Xt("h-4 w-4 ml-1.5",a&&"animate-spin")})]})]})]})})},gu=()=>{const{isOpen:n,onClose:e,type:t}=Ne(),{current_server:i}=ce().props,{toast:r}=$t(),{post:s,processing:a}=Ye({server_id:i.id}),o=()=>{s(route("server.leave",{server_id:i.id}),{onSuccess:()=>{e(),r({title:"Done",description:"You have left the Server "+i.name})}})},l=d.useMemo(()=>n&&t==="LeaveServer",[n,t]);return f.jsx(xe,{open:l,onOpenChange:e,children:f.jsxs(Pe,{className:"p-0 overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsx(Le,{className:"text-2xl text-center font-bold",children:"Are You Sure?"}),f.jsxs(gt,{className:"text-center",children:["Leave Server ",f.jsx("span",{className:"font-semibold text-indigo-500",children:i.name})," ?"]})]}),f.jsx(un,{className:"px-5 py-3.5  bg-primary-foreground",children:f.jsxs("div",{className:"flex justify-between items-center w-full",children:[f.jsx(Q,{variant:"outline",onClick:e,disabled:a,children:"Cancel"}),f.jsx(Q,{variant:"destructive",onClick:o,disabled:a,children:"Confirm"})]})})]})})},vu={GUEST:null,MODERATOR:f.jsx(Fa,{className:"h-4 w-4 ml-1.5 text-indigo-500"}),ADMIN:f.jsx(Ol,{className:"h-4 w-4 ml-1.5 text-rose-500"})},bu=()=>{const{isOpen:n,onClose:e,type:t}=Ne(),{current_server:i}=ce().props,{users:r}=i;$t();const s=d.useMemo(()=>n&&t==="Members",[n,t]);return f.jsx(xe,{open:s,onOpenChange:e,children:f.jsxs(Pe,{className:" overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsx(Le,{className:"text-2xl text-center font-bold",children:"Manage Members"}),f.jsx(gt,{className:"text-center text-muted-foreground",children:`${i.users.length.toString()} Member${i.users.length>1?"s":""}`})]}),f.jsx(La,{className:"mt-7 max-h-[26.25rem] pr-5",children:r.map(a=>f.jsx(yu,{current_server:i,user:a},a.id))})]})})},yu=({user:n,current_server:e})=>{const[t,i]=d.useState(!1),[r,s]=d.useState(!1),a=l=>{i(!0),In.visit(route("member.role_change"),{method:"post",data:{server_id:e.id,user_id:n.id,role:l},preserveState:!0,onFinish:()=>{i(!1),mt({title:"Success",description:"Role Changed!"})}})},o=()=>{i(!0),In.visit(route("member.kick"),{method:"post",data:{server_id:e.id,user_id:n.id},preserveState:!0,onFinish:()=>{i(!1),mt({title:"Success",description:`${n.name} has been Kicked!`})}})};return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex items-center gap-x-1.5 mb-10",children:[f.jsx(Li,{user:n}),f.jsxs("div",{className:"flex flex-col gap-y-1",children:[f.jsxs("p",{className:"text-xs font-semibold flex items-center gap-x-1",children:[n.name,vu[n.pivot.member_role]]}),f.jsx("p",{className:"text-xs text-muted-foreground",children:n.email})]}),e.user_id!==n.id&&!t&&f.jsx("div",{className:"ml-auto",children:f.jsxs(Hr,{children:[f.jsx(Gr,{children:f.jsx(Hl,{className:"h-4 w-4 text-muted-foreground"})}),f.jsxs(Kr,{side:"left",children:[f.jsxs(Cl,{children:[f.jsxs(wl,{className:"flex items-center",children:[f.jsx($l,{className:"w-4 h-4 mr-1.5"}),f.jsx("span",{children:"Role"})]}),f.jsx(El,{children:f.jsxs(xl,{children:[f.jsxs(pn,{onClick:()=>a("GUEST"),children:[f.jsx(Ql,{className:"h-4 w-4 mr-1.5"}),"GUEST",n.pivot.member_role==="GUEST"&&f.jsx(fr,{className:"h-4 w-4 ml-auto"})]}),f.jsxs(pn,{onClick:()=>a("MODERATOR"),children:[f.jsx(Fa,{className:"h-4 w-4 mr-1.5"}),"MODERATOR",n.pivot.member_role==="MODERATOR"&&f.jsx(fr,{className:"h-4 w-4 ml-auto"})]})]})})]}),f.jsx(Ua,{}),f.jsxs(pn,{onClick:o,children:[f.jsx(ql,{className:"h-4 w-4 mr-1.5"}),"Kick"]})]})]})}),t&&f.jsx(Ba,{className:"animate-spin text-secondary-foreground ml-auto w-4 h-4"})]}),f.jsx("div",{className:"w-full text-center mb-2",children:f.jsx(Q,{onClick:()=>s(!0),className:"mx-auto",children:"Add New User"})}),f.jsx(ku,{openRegister:r,onClose:()=>s(!1)})]})},ku=({openRegister:n,onClose:e})=>{const{data:t,setData:i,post:r,processing:s,errors:a,reset:o}=Ye({name:"",email:"",password:"",password_confirmation:""});d.useEffect(()=>()=>{o("password","password_confirmation")},[]);const l=c=>{c.preventDefault(),r(route("register"),{onSuccess:()=>In.get(route("home"))})};return f.jsx(xe,{open:n,onOpenChange:e,children:f.jsxs(Pe,{className:"sm:max-w-[425px]",children:[f.jsx(Re,{}),f.jsx(gt,{}),f.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[f.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[f.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"New Account"}),f.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the details of new user account"})]}),f.jsx("div",{className:"grid gap-6",children:f.jsxs("form",{onSubmit:l,children:[(a.email||a.password||a.name||a.password_confirmation)&&f.jsxs(qr,{variant:"destructive",className:"mb-6",children:[f.jsx($r,{className:"h-4 w-4"}),f.jsx(zr,{children:"Error"}),f.jsxs(Wr,{className:"flex flex-col space-y-1.5",children:[f.jsx("span",{children:a==null?void 0:a.email}),f.jsx("span",{children:a==null?void 0:a.password}),f.jsx("span",{children:a==null?void 0:a.name})]})]}),f.jsxs("div",{className:"grid gap-6",children:[f.jsxs("div",{className:"grid gap-1.5",children:[f.jsx(ge,{htmlFor:"name",children:"Name"}),f.jsx(Me,{required:!0,id:"name",placeholder:"Juan Dela Cruz",type:"text",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:s,onChange:({target:c})=>i("name",c.value)})]}),f.jsxs("div",{className:"grid gap-1.5",children:[f.jsx(ge,{htmlFor:"email",children:"Email"}),f.jsx(Me,{required:!0,id:"email",placeholder:"name@example.com",type:"email",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:s,onChange:({target:c})=>i("email",c.value)})]}),f.jsxs("div",{className:"grid gap-1.5",children:[f.jsx(ge,{htmlFor:"password",children:"Password"}),f.jsx(Me,{required:!0,id:"password",placeholder:"password",type:"password",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:s,onChange:({target:c})=>i("password",c.value)})]}),f.jsxs("div",{className:"grid gap-1.5",children:[f.jsx(ge,{htmlFor:"password_confirmation",children:"Password Confirmation"}),f.jsx(Me,{required:!0,id:"password_confirmation",placeholder:"password",type:"password",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:s,onChange:({target:c})=>i("password_confirmation",c.value)})]}),f.jsxs(Q,{disabled:s,children:[s&&f.jsx(Va,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign Up"]})]})]})})]})]})})},Su=()=>{const{isOpen:n,onClose:e,type:t}=Ne(),{current_server:i,system_message:r}=ce().props;$t();const s=d.useMemo(()=>n&&t==="SystemMessage",[n,t]),[a,o]=d.useState(r),{data:l,setData:c,post:u,get:h,processing:p,errors:v,reset:b}=Ye({initial_message:"",menus:[{id:0,reply_id:0,name:"",reply:""}]});d.useEffect(()=>{n===!0&&a.length>0?si.get(route("sys_message.index")).then(function(E){o(E.data)}):b()},[n]),d.useEffect(()=>{if(n===!0&&a.length>0){var E=a[0];b(),c("initial_message",E.message),c(D=>({...D,menus:E.menus.map(L=>({id:L.id,reply_id:L.replies.id,name:L.name,reply:L.replies.message}))}))}else b()},[a]);const g=()=>{c(E=>({...E,menus:[...E.menus,{id:E.menus.length,reply_id:E.menus.length+1,name:"",reply:""}]}))},S=()=>{c(E=>{const D=[...E.menus];return D.length===1?{...E,menus:D}:(D.splice(D.length-1,1),{...E,menus:D})})},k=(E,D,L)=>{c(V=>{const B=[...V.menus];return B[E].id=E+1,B[E].reply_id=E+2,D==="name"?B[E].name=L:B[E].reply=L,{...V,menus:B}})},C=()=>l.menus.map((E,D)=>f.jsxs("div",{className:"grid gap-3 p-5 mb-5 bg-white dark:bg-neutral-950 rounded-md shadow",children:[f.jsxs("div",{className:"grid gap-1.5",children:[f.jsxs(ge,{htmlFor:"name"+D,children:["Menu button ",D+1]}),f.jsx(Me,{required:!0,id:"name"+D,placeholder:"Can I speak to one of your agents?",type:"text",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:p,onChange:L=>k(D,"name",L.target.value),value:E.name})]}),f.jsxs("div",{className:"grid gap-1.5",children:[f.jsxs(ge,{htmlFor:"reply"+D,children:["Reply for menu button ",D+1]}),f.jsx(Me,{required:!0,id:"reply"+D,placeholder:"Sure! Please wait...",type:"text",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:p,onChange:L=>k(D,"reply",L.target.value),value:E.reply})]})]},D)),I=E=>{E.preventDefault(),u(route("sys_message.store"),{onSuccess:()=>console.log("system message stored")})};return f.jsx(xe,{open:s,onOpenChange:e,children:f.jsxs(Pe,{className:" overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsx(Le,{className:"text-2xl text-center font-bold",children:"System Message"}),f.jsx(gt,{className:"text-center text-muted-foreground"})]}),f.jsx("form",{onSubmit:I,children:f.jsxs("div",{className:"grid gap-6",children:[f.jsxs("div",{className:"grid gap-1.5",children:[f.jsx(ge,{htmlFor:"initial_message",className:"mb-2",children:"Initial message when user sends a message"}),f.jsx("textarea",{className:"rounded resize-none dark:bg-neutral-950",required:!0,id:"initial_message",placeholder:"Hello! Welcome to Chat Support. What can we do for you?",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:p,onChange:({target:E})=>c("initial_message",E.value),value:l.initial_message})]}),f.jsxs("div",{className:"max-h-[20rem] bg-gray-100 dark:bg-neutral-900 p-4 rounded overflow-auto",children:[f.jsxs("div",{className:"flex items-center mb-4",children:[f.jsx("p",{className:"font-bold text-xs",children:"MENUS"}),f.jsxs("div",{className:"flex items-center ml-auto",children:[f.jsx("button",{onClick:g,className:"text-green-600 mr-0.5",children:f.jsx(Gl,{})}),f.jsx("button",{onClick:S,className:"text-red-600",children:f.jsx(Xl,{})})]})]}),C()]}),f.jsxs(Q,{disabled:p,children:[p&&f.jsx(Va,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})})]})})},Tu=()=>{const{isOpen:n,onClose:e,type:t,data:i}=Ne(),{current_server:r,user:s}=ce().props,{users:a}=r,{toast:o}=$t(),l=d.useMemo(()=>n&&t==="CaseClosed",[n,t]);Ye({initial_message:"",menus:[{name:"",reply:""}]});const c=()=>{i.channel&&In.get(route("support.close"),{channel_id:i.channel.id},{onSuccess:()=>{o({description:"Case Closed"}),e()}})};return f.jsx(xe,{open:l,onOpenChange:e,children:f.jsxs(Pe,{className:" overflow-auto",children:[f.jsxs(Re,{className:"pt-7 px-5",children:[f.jsxs(Le,{className:"text-2xl text-center font-bold",children:["Close this ",a[0].name,"'s case?"]}),f.jsx(gt,{className:"text-center text-muted-foreground",children:"after closing this case, user unable to reply anymore and system will automatically send a score / rating choices for user to choose based on agent's assistance"})]}),f.jsx(Q,{onClick:c,children:"Yes, close this case"})]})})},Cu=()=>f.jsxs(f.Fragment,{children:[f.jsx(su,{}),f.jsx(mu,{}),f.jsx(fu,{}),f.jsx(bu,{}),f.jsx(iu,{}),f.jsx(gu,{}),f.jsx(cu,{}),f.jsx(ou,{}),f.jsx(du,{}),f.jsx(Ll,{}),f.jsx(lu,{}),f.jsx(Su,{}),f.jsx(Tu,{})]}),bv=({children:n})=>f.jsxs(f.Fragment,{children:[f.jsx(Cu,{}),f.jsxs("div",{className:"h-screen",children:[f.jsx("div",{className:"hidden md:flex flex-col fixed inset-y-0 h-full w-[4.5rem] z-30",children:f.jsx(qa,{})}),f.jsx("main",{className:"md:pl-[4.5rem] h-full",children:n})]})]}),wu=()=>f.jsxs(Pl,{children:[f.jsx(Rl,{asChild:!0,className:"z-0",children:f.jsx(Q,{variant:"ghost",size:"icon",className:"flex md:hidden",children:f.jsx(zl,{})})}),f.jsxs(Nl,{side:"left",className:"p-0 flex gap-0",children:[f.jsx("div",{className:"w-[4.5rem]",children:f.jsx(qa,{})}),f.jsx(Ja,{})]})]}),Eu=pl("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function xu({className:n,variant:e,...t}){return f.jsx("div",{className:Xt(Eu({variant:e}),n),...t})}const Pu=()=>(Il(),f.jsx(xu,{variant:"outline",className:"bg-emerald-600 text-white border-none",children:"Connected"})),Ru=()=>{const{current_server:n,current_conversation:e}=ce().props,{isVideo:t,toggle:i}=Sl(),r=t?Zl:Ul,s=t?"End video call":"Start video call";if(!e)return null;const a=()=>{const o=t?0:e.id;i(!t,o)};return f.jsx(wi,{side:"bottom",label:s,children:f.jsx("button",{onClick:a,className:"hover:opacity-75 transit mr-3.5",children:f.jsx(r,{className:"h-6 w-6 text-neutral-500 dark:text-neutral-400"})})})},yv=({server:n,name:e,type:t,user:i})=>f.jsxs("div",{className:"text-md font-semibold px-2.5 flex items-center h-12 border-b-2 border-secondary z-0",children:[f.jsx(wu,{}),t==="Channel"&&f.jsx(jl,{className:"w-5 h-5 text-neutral-500 dark:text-neutral-400 mr-1.5"}),t==="Conversation"&&f.jsx(Li,{className:"h-8 w-8 mr-2",user:i}),f.jsx("p",{className:"font-semibold text-base text-black dark:text-white",children:e}),f.jsxs("div",{className:"ml-auto flex items-center",children:[t==="Conversation"&&f.jsx(Ru,{}),f.jsx(Pu,{})]})]}),Nu="d MMMM yyyy HH:mm",kv=({message:n,type:e})=>{var N;const{current_server:t,current_channel:i,auth:r,current_conversation:s}=ce().props,[a,o]=d.useState(n.content),[l,c]=d.useState(!1),[u,h]=d.useState(!1),{user:p}=n,{user:v}=r,b=d.useMemo(()=>{var U;return(U=t.users.find(({id:q})=>q===p.id))==null?void 0:U.pivot.member_role},[t,p]),g=(N=n.file)==null?void 0:N.split(".").pop(),S=d.useMemo(()=>!n.deleted_at&&(e==="Channel"&&(b==="ADMIN"||b==="MODERATOR")||v.id===n.user_id),[n,b]);d.useMemo(()=>!n.deleted_at&&v.id===n.user_id&&!n.file,[n,b]);const k=g==="pdf"?route("home")+"/uploads/pdf/pdf.png":n.file,{onOpen:C,data:I}=Ne(),E=d.useRef(null),{post:D}=Ye({user_id:n.user_id}),L=()=>{if(n.user_id===v.id)return null;D(route("server.conversation.initiate",{server_id:t.id}))},V=d.useCallback(U=>{if(U.preventDefault(),!i&&e=="Channel"||!s&&e==="Conversation")return;c(!0);const q=e==="Channel"?route("server.channel.message.update",{server_id:t.id,channel_id:i.id}):route("server.conversation.update",{server_id:t.id,conversation_id:s.id});si.post(q,{message:a,message_id:n.id}).then(()=>h(!1)).catch(()=>mt({title:"Internal Error",description:"Please Try Again"})).finally(()=>c(!1))},[i,t,a,n.id,e,s]),B=d.useCallback(()=>{if(!i&&e=="Channel"||!s&&e==="Conversation")return;const U=e==="Channel"?route("server.channel.message.destroy",{server_id:t.id,channel_id:i.id,message_id:n.id}):route("server.conversation.destroy",{server_id:t.id,conversation_id:s.id,direct_message_id:n.id});C("DeleteMessage",{apiRoute:U})},[i,t,n.id,e,s]);return d.useEffect(()=>{E.current&&E.current.focus();const U=q=>{(q.key==="Escape"||q.code==="Escape")&&h(!1)};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[]),d.useEffect(()=>{E.current&&u&&E.current.focus()},[E,u]),f.jsxs("div",{className:"relative group flex items-center hover:bg-neutral-300 dark:hover:bg-neutral-900 p-3.5 transition w-full",children:[f.jsxs("div",{className:"group flex gap-x-1.5 items-start w-full",children:[f.jsx("div",{onClick:L,className:"cursor-pointer hover:drop-shadow-md transition",children:f.jsx(Li,{user:p})}),f.jsxs("div",{className:"flex flex-col w-full",children:[f.jsxs("div",{className:"flex items-center gap-x-1.5",children:[f.jsxs("div",{className:"flex items-center",children:[f.jsx("p",{onClick:L,className:Xt("font-semibold text-sm transition mr-1",n.user_id!==v.id&&"cursor-pointer hover:underline"),children:p.name}),f.jsx(wi,{label:b||"",children:f.jsx("p",{children:Fl[b||"GUEST"]})})]}),f.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:Bl(new Date(n.created_at),Nu)})]}),n.file&&!n.deleted_at&&f.jsx("a",{href:n.file,target:"_blank",rel:"noopener noreferrer",className:Xt("relative aspect-square rounded-md mt-1.5 overflow-hidden border flex items-center bg-secondary ",g==="pdf"?"h-10 w-10":"h-48 w-48"),children:f.jsx("img",{src:k,alt:"file",className:"object-cover"})}),f.jsx("p",{className:Xt("text-xs",g==="pdf"&&!n.deleted_at?"block":"hidden"),children:"PDF File"}),!u&&f.jsxs("p",{className:Xt("text-sm text-neutral-600 dark:text-neutral-300",n.deleted_at&&"italic text-neutral-500 dark:text-neutral-400 text-xs mt-1"),children:[n.deleted_at?"Message Deleted":n.content,n.created_at!==n.updated_at&&!n.deleted_at&&f.jsx("span",{className:"text-[0.625rem] mx-1.5 text-neutral-500 dark:text-neutral-400",children:"(edited)"})]}),!n.file&&u&&f.jsxs(f.Fragment,{children:[f.jsxs("form",{className:"flex items-center w-full gap-x-1.5 pt-1.5",onSubmit:V,children:[f.jsx("div",{className:"flex-1",children:f.jsx(Me,{disabled:l,ref:E,value:a,onChange:({target:U})=>o(U.value),className:"p-1.5 bg-neutral-200/90 dark:bg-neutral-700/75 border-none !border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0 text-neutral-600 dark:text-neutral-200"})}),f.jsx(Q,{size:"sm",disabled:l,children:"Save"})]}),f.jsx("span",{className:"text-[0.625rem] mt-1 text-neutral-400",children:"Press ESC to cancel. Press Enter to save."})]})]})]}),S&&f.jsx("div",{className:"hidden group-hover:flex items-center gap-x-1.5 absolute p-1 -top-2 right-5 bg-white dark:bg-neutral-800 border rounded-sm",children:f.jsx(wi,{label:"Delete",children:f.jsx(Jl,{onClick:B,className:"cursor-pointer ml-auto w-4 h-4 text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition"})})})]})},Iu=n=>{const e=d.useRef(n);return d.useEffect(()=>{e.current=n}),e},Mu=Iu;function _u(n,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if(i!=="default"&&!(i in n)){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(n)}var Du=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Au(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var za={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(Du,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function s(g,S){var k=g[S];if(typeof k.bind=="function")return k.bind(g);try{return Function.prototype.bind.call(k,g)}catch{return function(){return Function.prototype.apply.apply(k,[g,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(g){return g==="debug"&&(g="log"),typeof console===t?!1:g==="trace"&&i?a:console[g]!==void 0?s(console,g):console.log!==void 0?s(console,"log"):e}function l(g,S){for(var k=0;k<r.length;k++){var C=r[k];this[C]=k<g?e:this.methodFactory(C,g,S)}this.log=this.debug}function c(g,S,k){return function(){typeof console!==t&&(l.call(this,S,k),this[g].apply(this,arguments))}}function u(g,S,k){return o(g)||c.apply(this,arguments)}function h(g,S,k){var C=this,I;S=S??"WARN";var E="loglevel";typeof g=="string"?E+=":"+g:typeof g=="symbol"&&(E=void 0);function D(N){var U=(r[N]||"silent").toUpperCase();if(!(typeof window===t||!E)){try{window.localStorage[E]=U;return}catch{}try{window.document.cookie=encodeURIComponent(E)+"="+U+";"}catch{}}}function L(){var N;if(!(typeof window===t||!E)){try{N=window.localStorage[E]}catch{}if(typeof N===t)try{var U=window.document.cookie,q=U.indexOf(encodeURIComponent(E)+"=");q!==-1&&(N=/^([^;]+)/.exec(U.slice(q))[1])}catch{}return C.levels[N]===void 0&&(N=void 0),N}}function V(){if(!(typeof window===t||!E)){try{window.localStorage.removeItem(E);return}catch{}try{window.document.cookie=encodeURIComponent(E)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}C.name=g,C.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},C.methodFactory=k||u,C.getLevel=function(){return I},C.setLevel=function(N,U){if(typeof N=="string"&&C.levels[N.toUpperCase()]!==void 0&&(N=C.levels[N.toUpperCase()]),typeof N=="number"&&N>=0&&N<=C.levels.SILENT){if(I=N,U!==!1&&D(N),l.call(C,N,g),typeof console===t&&N<C.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+N},C.setDefaultLevel=function(N){S=N,L()||C.setLevel(N,!1)},C.resetLevel=function(){C.setLevel(S,!1),V()},C.enableAll=function(N){C.setLevel(C.levels.TRACE,N)},C.disableAll=function(N){C.setLevel(C.levels.SILENT,N)};var B=L();B==null&&(B=S),C.setLevel(B,!1)}var p=new h,v={};p.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var k=v[S];return k||(k=v[S]=new h(S,p.getLevel(),p.methodFactory)),k};var b=typeof window!==t?window.log:void 0;return p.noConflict=function(){return typeof window!==t&&window.log===p&&(window.log=b),p},p.getLoggers=function(){return v},p.default=p,p})})(za);var Wa=za.exports,pr;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(pr||(pr={}));const y=Wa.getLogger("livekit");y.setDefaultLevel(pr.info);Wa.getLogger("lk-e2ee");function me(n,e){if(!n)throw new Error(e)}const Ou=34028234663852886e22,Lu=-34028234663852886e22,Uu=4294967295,ju=2147483647,Fu=-2147483648;function hi(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>ju||n<Fu)throw new Error("invalid int 32: "+n)}function mr(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>Uu||n<0)throw new Error("invalid uint 32: "+n)}function Ha(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Ou||n<Lu))throw new Error("invalid float 32: "+n)}const Ga=Symbol("@bufbuild/protobuf/enum-type");function Bu(n){const e=n[Ga];return me(e,"missing enum type on enum object"),e}function Ka(n,e,t,i){n[Ga]=$a(e,t.map(r=>({no:r.no,name:r.name,localName:n[r.no]})))}function $a(n,e,t){const i=Object.create(null),r=Object.create(null),s=[];for(const a of e){const o=Qa(a);s.push(o),i[a.name]=o,r[a.no]=o}return{typeName:n,values:s,findName(a){return i[a]},findNumber(a){return r[a]}}}function Ju(n,e,t){const i={};for(const r of e){const s=Qa(r);i[s.localName]=s.no,i[s.no]=s.localName}return Ka(i,n,e),i}function Qa(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class _{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(t);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,t){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(t);return r.readMessage(i,e,s,this),this}fromJsonString(e,t){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,t)}toBinary(e){const t=this.getType(),i=t.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const t=this.getType(),i=t.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var t;const i=this.toJson(e);return JSON.stringify(i,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Vu(n,e,t,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),a={[s]:function(o){n.util.initFields(this),n.util.initPartial(o,this)}}[s];return Object.setPrototypeOf(a.prototype,new _),Object.assign(a,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(o,l){return new a().fromBinary(o,l)},fromJson(o,l){return new a().fromJson(o,l)},fromJsonString(o,l){return new a().fromJsonString(o,l)},equals(o,l){return n.util.equals(a,o,l)}}),a}function qu(n,e,t,i){return{syntax:n,json:e,bin:t,util:i,makeMessageType(r,s,a){return Vu(this,r,s,a)},makeEnum:Ju,makeEnumType:$a,getEnumType:Bu}}var P;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(P||(P={}));function zu(){let n=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(n|=(r&127)<<i,!(r&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function $i(n,e,t){for(let s=0;s<28;s=s+7){const a=n>>>s,o=!(!(a>>>7)&&e==0),l=(o?a|128:a)&255;if(t.push(l),!o)return}const i=n>>>28&15|(e&7)<<4,r=!!(e>>3);if(t.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const a=e>>>s,o=!!(a>>>7),l=(o?a|128:a)&255;if(t.push(l),!o)return}t.push(e>>>31&1)}}const fi=4294967296;function ys(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let i=0,r=0;function s(a,o){const l=Number(n.slice(a,o));r*=t,i=i*t+l,i>=fi&&(r=r+(i/fi|0),i=i%fi)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?Za(i,r):Qr(i,r)}function Wu(n,e){let t=Qr(n,e);const i=t.hi&2147483648;i&&(t=Za(t.lo,t.hi));const r=Ya(t.lo,t.hi);return i?"-"+r:r}function Ya(n,e){if({lo:n,hi:e}=Hu(n,e),e<=2097151)return String(fi*e+n);const t=n&16777215,i=(n>>>24|e<<8)&16777215,r=e>>16&65535;let s=t+i*6777216+r*6710656,a=i+r*8147497,o=r*2;const l=1e7;return s>=l&&(a+=Math.floor(s/l),s%=l),a>=l&&(o+=Math.floor(a/l),a%=l),o.toString()+ks(a)+ks(s)}function Hu(n,e){return{lo:n>>>0,hi:e>>>0}}function Qr(n,e){return{lo:n|0,hi:e|0}}function Za(n,e){return e=~e,n?n=~n+1:e+=1,Qr(n,e)}const ks=n=>{const e=String(n);return"0000000".slice(e.length)+e};function Ss(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Gu(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Ku(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),a=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>s||c<r)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>o||c<a)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return n.setBigInt64(0,this.parse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(l){return n.setBigInt64(0,this.uParse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(l,c){return n.setInt32(0,l,!0),n.setInt32(4,c,!0),n.getBigInt64(0,!0)},uDec(l,c){return n.setInt32(0,l,!0),n.setInt32(4,c,!0),n.getBigUint64(0,!0)}}}const t=r=>me(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>me(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),t(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),t(r),ys(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),ys(r)},dec(r,s){return Wu(r,s)},uDec(r,s){return Ya(r,s)}}}const j=Ku();var K;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(K||(K={}));class $u{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let t=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)t.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(mr(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return hi(e),Ss(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Ha(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){mr(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){hi(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return hi(e),e=(e<<1^e>>31)>>>0,Ss(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=j.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),r=j.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(t)}int64(e){let t=j.enc(e);return $i(t.lo,t.hi,this.buf),this}sint64(e){let t=j.enc(e),i=t.hi>>31,r=t.lo<<1^i,s=(t.hi<<1|t.lo>>>31)^i;return $i(r,s,this.buf),this}uint64(e){let t=j.uEnc(e);return $i(t.lo,t.hi,this.buf),this}}class Qu{constructor(e,t){this.varint64=zu,this.uint32=Gu,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,i=e&7;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e){let t=this.pos;switch(e){case K.Varint:for(;this.buf[this.pos++]&128;);break;case K.Bit64:this.pos+=4;case K.Bit32:this.pos+=4;break;case K.LengthDelimited:let i=this.uint32();this.pos+=i;break;case K.StartGroup:let r;for(;(r=this.tag()[1])!==K.EndGroup;)this.skip(r);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return j.dec(...this.varint64())}uint64(){return j.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(e&1);return e=(e>>>1|(t&1)<<31)^i,t=t>>>1^i,j.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return j.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return j.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function gr(n,e){return e instanceof _||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}P.DOUBLE,P.FLOAT,P.INT64,P.UINT64,P.INT32,P.UINT32,P.BOOL,P.STRING,P.BYTES;function Zt(n,e,t){if(e===t)return!0;if(n==P.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}switch(n){case P.UINT64:case P.FIXED64:case P.INT64:case P.SFIXED64:case P.SINT64:return e==t}return!1}function vr(n){switch(n){case P.BOOL:return!1;case P.UINT64:case P.FIXED64:case P.INT64:case P.SFIXED64:case P.SINT64:return j.zero;case P.DOUBLE:case P.FLOAT:return 0;case P.BYTES:return new Uint8Array(0);case P.STRING:return"";default:return 0}}function Xa(n,e){const t=e===void 0;let i=K.Varint,r=e===0;switch(n){case P.STRING:r=t||!e.length,i=K.LengthDelimited;break;case P.BOOL:r=e===!1;break;case P.DOUBLE:i=K.Bit64;break;case P.FLOAT:i=K.Bit32;break;case P.INT64:r=t||e==0;break;case P.UINT64:r=t||e==0;break;case P.FIXED64:r=t||e==0,i=K.Bit64;break;case P.BYTES:r=t||!e.byteLength,i=K.LengthDelimited;break;case P.FIXED32:i=K.Bit32;break;case P.SFIXED32:i=K.Bit32;break;case P.SFIXED64:r=t||e==0,i=K.Bit64;break;case P.SINT64:r=t||e==0;break}const s=P[n].toLowerCase();return[i,s,t||r]}const Tn=Symbol("@bufbuild/protobuf/unknown-fields"),Ts={readUnknownFields:!0,readerFactory:n=>new Qu(n)},Cs={writeUnknownFields:!0,writerFactory:()=>new $u};function Yu(n){return n?Object.assign(Object.assign({},Ts),n):Ts}function Zu(n){return n?Object.assign(Object.assign({},Cs),n):Cs}function Xu(){return{makeReadOptions:Yu,makeWriteOptions:Zu,listUnknownFields(n){var e;return(e=n[Tn])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[Tn]},writeUnknownFields(n,e){const i=n[Tn];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(n,e,t,i){const r=n;Array.isArray(r[Tn])||(r[Tn]=[]),r[Tn].push({no:e,wireType:t,data:i})},readMessage(n,e,t,i){const r=n.getType(),s=t===void 0?e.len:e.pos+t;for(;e.pos<s;){const[a,o]=e.tag(),l=r.fields.find(a);if(!l){const p=e.skip(o);i.readUnknownFields&&this.onUnknownField(n,a,o,p);continue}let c=n,u=l.repeated,h=l.localName;switch(l.oneof&&(c=c[l.oneof.localName],c.case!=h&&delete c.value,c.case=h,h="value"),l.kind){case"scalar":case"enum":const p=l.kind=="enum"?P.INT32:l.T;if(u){let S=c[h];if(o==K.LengthDelimited&&p!=P.STRING&&p!=P.BYTES){let k=e.uint32()+e.pos;for(;e.pos<k;)S.push(Hn(e,p))}else S.push(Hn(e,p))}else c[h]=Hn(e,p);break;case"message":const v=l.T;u?c[h].push(pi(e,new v,i)):c[h]instanceof _?pi(e,c[h],i):(c[h]=pi(e,new v,i),v.fieldWrapper&&!l.oneof&&!l.repeated&&(c[h]=v.fieldWrapper.unwrapField(c[h])));break;case"map":let[b,g]=ed(l,e,i);c[h][b]=g;break}}}}}function pi(n,e,t){return e.getType().runtime.bin.readMessage(e,n,n.uint32(),t),e}function ed(n,e,t){const i=e.uint32(),r=e.pos+i;let s,a;for(;e.pos<r;){let[o]=e.tag();switch(o){case 1:s=Hn(e,n.K);break;case 2:switch(n.V.kind){case"scalar":a=Hn(e,n.V.T);break;case"enum":a=e.int32();break;case"message":a=pi(e,new n.V.T,t);break}break}}if(s===void 0){let o=vr(n.K);s=n.K==P.BOOL?o.toString():o}if(typeof s!="string"&&typeof s!="number"&&(s=s.toString()),a===void 0)switch(n.V.kind){case"scalar":a=vr(n.V.T);break;case"enum":a=0;break;case"message":a=new n.V.T;break}return[s,a]}function Hn(n,e){switch(e){case P.STRING:return n.string();case P.BOOL:return n.bool();case P.DOUBLE:return n.double();case P.FLOAT:return n.float();case P.INT32:return n.int32();case P.INT64:return n.int64();case P.UINT64:return n.uint64();case P.FIXED64:return n.fixed64();case P.BYTES:return n.bytes();case P.FIXED32:return n.fixed32();case P.SFIXED32:return n.sfixed32();case P.SFIXED64:return n.sfixed64();case P.SINT64:return n.sint64();case P.UINT32:return n.uint32();case P.SINT32:return n.sint32()}}function td(n,e,t,i,r){n.tag(t.no,K.LengthDelimited),n.fork();let s=i;switch(t.K){case P.INT32:case P.FIXED32:case P.UINT32:case P.SFIXED32:case P.SINT32:s=Number.parseInt(i);break;case P.BOOL:me(i=="true"||i=="false"),s=i=="true";break}switch(Gn(n,t.K,1,s,!0),t.V.kind){case"scalar":Gn(n,t.V.T,2,r,!0);break;case"enum":Gn(n,P.INT32,2,r,!0);break;case"message":br(n,e,t.V.T,2,r);break}n.join()}function br(n,e,t,i,r){if(r!==void 0){const s=gr(t,r);n.tag(i,K.LengthDelimited).bytes(s.toBinary(e))}}function Gn(n,e,t,i,r){let[s,a,o]=Xa(e,i);(!o||r)&&n.tag(t,s)[a](i)}function nd(n,e,t,i){if(!i.length)return;n.tag(t,K.LengthDelimited).fork();let[,r]=Xa(e);for(let s=0;s<i.length;s++)n[r](i[s]);n.join()}function id(){return Object.assign(Object.assign({},Xu()),{writeMessage(n,e,t){const i=n.getType();for(const r of i.fields.byNumber()){let s,a=r.repeated,o=r.localName;if(r.oneof){const l=n[r.oneof.localName];if(l.case!==o)continue;s=l.value}else s=n[o];switch(r.kind){case"scalar":case"enum":let l=r.kind=="enum"?P.INT32:r.T;if(a)if(r.packed)nd(e,l,r.no,s);else for(const c of s)Gn(e,l,r.no,c,!0);else s!==void 0&&Gn(e,l,r.no,s,!!r.oneof||r.opt);break;case"message":if(a)for(const c of s)br(e,t,r.T,r.no,c);else br(e,t,r.T,r.no,s);break;case"map":for(const[c,u]of Object.entries(s))td(e,t,r,c,u);break}}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e}})}let kt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Ui=[];for(let n=0;n<kt.length;n++)Ui[kt[n].charCodeAt(0)]=n;Ui["-".charCodeAt(0)]=kt.indexOf("+");Ui["_".charCodeAt(0)]=kt.indexOf("/");const eo={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),i=0,r=0,s,a=0;for(let o=0;o<n.length;o++){if(s=Ui[n.charCodeAt(o)],s===void 0)switch(n[o]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=s,r=1;break;case 1:t[i++]=a<<2|(s&48)>>4,a=s,r=2;break;case 2:t[i++]=(a&15)<<4|(s&60)>>2,a=s,r=3;break;case 3:t[i++]=(a&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return t.subarray(0,i)},enc(n){let e="",t=0,i,r=0;for(let s=0;s<n.length;s++)switch(i=n[s],t){case 0:e+=kt[i>>2],r=(i&3)<<4,t=1;break;case 1:e+=kt[r|i>>4],r=(i&15)<<2,t=2;break;case 2:e+=kt[r|i>>6],e+=kt[i&63],t=0;break}return t&&(e+=kt[r],e+="=",t==1&&(e+="=")),e}},ws={ignoreUnknownFields:!1},Es={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function rd(n){return n?Object.assign(Object.assign({},ws),n):ws}function sd(n){return n?Object.assign(Object.assign({},Es),n):Es}function ad(n){const e=n(od,xs);return{makeReadOptions:rd,makeWriteOptions:sd,readMessage(t,i,r,s){if(i==null||Array.isArray(i)||typeof i!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(this.debug(i)));s=s??new t;const a={};for(const[o,l]of Object.entries(i)){const c=t.fields.findJsonName(o);if(!c){if(!r.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'));continue}let u=c.localName,h=s;if(c.oneof){if(l===null&&c.kind=="scalar")continue;const p=a[c.oneof.localName];if(p)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(p,'", "').concat(o,'"'));a[c.oneof.localName]=o,h=h[c.oneof.localName]={case:u},u="value"}if(c.repeated){if(l===null)continue;if(!Array.isArray(l))throw new Error("cannot decode field ".concat(t.typeName,".").concat(c.name," from JSON: ").concat(this.debug(l)));const p=h[u];for(const v of l){if(v===null)throw new Error("cannot decode field ".concat(t.typeName,".").concat(c.name," from JSON: ").concat(this.debug(v)));let b;switch(c.kind){case"message":b=c.T.fromJson(v,r);break;case"enum":if(b=Qi(c.T,v,r.ignoreUnknownFields),b===void 0)continue;break;case"scalar":try{b=jn(c.T,v)}catch(g){let S="cannot decode field ".concat(t.typeName,".").concat(c.name," from JSON: ").concat(this.debug(v));throw g instanceof Error&&g.message.length>0&&(S+=": ".concat(g.message)),new Error(S)}break}p.push(b)}}else if(c.kind=="map"){if(l===null)continue;if(Array.isArray(l)||typeof l!="object")throw new Error("cannot decode field ".concat(t.typeName,".").concat(c.name," from JSON: ").concat(this.debug(l)));const p=h[u];for(const[v,b]of Object.entries(l)){if(b===null)throw new Error("cannot decode field ".concat(t.typeName,".").concat(c.name," from JSON: map value null"));let g;switch(c.V.kind){case"message":g=c.V.T.fromJson(b,r);break;case"enum":if(g=Qi(c.V.T,b,r.ignoreUnknownFields),g===void 0)continue;break;case"scalar":try{g=jn(c.V.T,b)}catch(S){let k="cannot decode map value for field ".concat(t.typeName,".").concat(c.name," from JSON: ").concat(this.debug(l));throw S instanceof Error&&S.message.length>0&&(k+=": ".concat(S.message)),new Error(k)}break}try{p[jn(c.K,c.K==P.BOOL?v=="true"?!0:v=="false"?!1:v:v).toString()]=g}catch(S){let k="cannot decode map key for field ".concat(t.typeName,".").concat(c.name," from JSON: ").concat(this.debug(l));throw S instanceof Error&&S.message.length>0&&(k+=": ".concat(S.message)),new Error(k)}}}else switch(c.kind){case"message":const p=c.T;if(l===null&&p.typeName!="google.protobuf.Value"){if(c.oneof)throw new Error("cannot decode field ".concat(t.typeName,".").concat(c.name,' from JSON: null is invalid for oneof field "').concat(o,'"'));continue}h[u]instanceof _?h[u].fromJson(l,r):(h[u]=p.fromJson(l,r),p.fieldWrapper&&!c.oneof&&(h[u]=p.fieldWrapper.unwrapField(h[u])));break;case"enum":const v=Qi(c.T,l,r.ignoreUnknownFields);v!==void 0&&(h[u]=v);break;case"scalar":try{h[u]=jn(c.T,l)}catch(b){let g="cannot decode field ".concat(t.typeName,".").concat(c.name," from JSON: ").concat(this.debug(l));throw b instanceof Error&&b.message.length>0&&(g+=": ".concat(b.message)),new Error(g)}break}}return s},writeMessage(t,i){const r=t.getType(),s={};let a;try{for(const o of r.fields.byMember()){let l;if(o.kind=="oneof"){const c=t[o.localName];if(c.value===void 0)continue;if(a=o.findField(c.case),!a)throw"oneof case not found: "+c.case;l=e(a,c.value,i)}else a=o,l=e(a,t[a.localName],i);l!==void 0&&(s[i.useProtoFieldName?a.name:a.jsonName]=l)}}catch(o){const l=a?"cannot encode field ".concat(r.typeName,".").concat(a.name," to JSON"):"cannot encode message ".concat(r.typeName," to JSON"),c=o instanceof Error?o.message:String(o);throw new Error(l+(c.length>0?": ".concat(c):""))}return s},readScalar:jn,writeScalar:xs,debug:to}}function to(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function jn(n,e){switch(n){case P.DOUBLE:case P.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const t=Number(e);if(Number.isNaN(t)||!Number.isFinite(t))break;return n==P.FLOAT&&Ha(t),t;case P.INT32:case P.FIXED32:case P.SFIXED32:case P.SINT32:case P.UINT32:if(e===null)return 0;let i;if(typeof e=="number"?i=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(i=Number(e)),i===void 0)break;return n==P.UINT32?mr(i):hi(i),i;case P.INT64:case P.SFIXED64:case P.SINT64:if(e===null)return j.zero;if(typeof e!="number"&&typeof e!="string")break;return j.parse(e);case P.FIXED64:case P.UINT64:if(e===null)return j.zero;if(typeof e!="number"&&typeof e!="string")break;return j.uParse(e);case P.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case P.STRING:if(e===null)return"";if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case P.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return eo.dec(e)}throw new Error}function Qi(n,e,t){if(e===null)return 0;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=n.findName(e);if(i||t)return i==null?void 0:i.no;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(to(e)))}function od(n,e,t,i){var r;if(e===void 0)return e;if(e===0&&!t)return;if(i)return e;if(n.typeName=="google.protobuf.NullValue")return null;const s=n.findNumber(e);return(r=s==null?void 0:s.name)!==null&&r!==void 0?r:e}function xs(n,e,t){if(e!==void 0)switch(n){case P.INT32:case P.SFIXED32:case P.SINT32:case P.FIXED32:case P.UINT32:return me(typeof e=="number"),e!=0||t?e:void 0;case P.FLOAT:case P.DOUBLE:return me(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e!==0||t?e:void 0;case P.STRING:return me(typeof e=="string"),e.length>0||t?e:void 0;case P.BOOL:return me(typeof e=="boolean"),e||t?e:void 0;case P.UINT64:case P.FIXED64:case P.INT64:case P.SFIXED64:case P.SINT64:return me(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),t||e!=0?e.toString(10):void 0;case P.BYTES:return me(e instanceof Uint8Array),t||e.byteLength>0?eo.enc(e):void 0}}function cd(){return ad((n,e)=>function(i,r,s){if(i.kind=="map"){const a={};switch(i.V.kind){case"scalar":for(const[l,c]of Object.entries(r)){const u=e(i.V.T,c,!0);me(u!==void 0),a[l.toString()]=u}break;case"message":for(const[l,c]of Object.entries(r))a[l.toString()]=c.toJson(s);break;case"enum":const o=i.V.T;for(const[l,c]of Object.entries(r)){me(c===void 0||typeof c=="number");const u=n(o,c,!0,s.enumAsInteger);me(u!==void 0),a[l.toString()]=u}break}return s.emitDefaultValues||Object.keys(a).length>0?a:void 0}else if(i.repeated){const a=[];switch(i.kind){case"scalar":for(let o=0;o<r.length;o++)a.push(e(i.T,r[o],!0));break;case"enum":for(let o=0;o<r.length;o++)a.push(n(i.T,r[o],!0,s.enumAsInteger));break;case"message":for(let o=0;o<r.length;o++)a.push(gr(i.T,r[o]).toJson(s));break}return s.emitDefaultValues||a.length>0?a:void 0}else switch(i.kind){case"scalar":return e(i.T,r,!!i.oneof||i.opt||s.emitDefaultValues);case"enum":return n(i.T,r,!!i.oneof||i.opt||s.emitDefaultValues,s.enumAsInteger);case"message":return r!==void 0?gr(i.T,r).toJson(s):void 0}})}function ld(){return{setEnumType:Ka,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const i of t.fields.byMember()){const r=i.localName,s=e,a=n;if(a[r]!==void 0)switch(i.kind){case"oneof":const o=a[r].case;if(o===void 0)continue;const l=i.findField(o);let c=a[r].value;l&&l.kind=="message"&&!(c instanceof l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===P.BYTES&&(c=Fn(c)),s[r]={case:o,value:c};break;case"scalar":case"enum":let u=a[r];i.T===P.BYTES&&(u=i.repeated?u.map(Fn):Fn(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===P.BYTES)for(const[v,b]of Object.entries(a[r]))s[r][v]=Fn(b);else Object.assign(s[r],a[r]);break;case"message":const p=i.V.T;for(const v of Object.keys(a[r])){let b=a[r][v];p.fieldWrapper||(b=new p(b)),s[r][v]=b}break}break;case"message":const h=i.T;if(i.repeated)s[r]=a[r].map(p=>p instanceof h?p:new h(p));else if(a[r]!==void 0){const p=a[r];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?s[r]=Fn(p):s[r]=p:s[r]=p instanceof h?p:new h(p)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(i=>{const r=e[i.localName],s=t[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((a,o)=>i.T.equals(a,s[o]));case"scalar":return r.every((a,o)=>Zt(i.T,a,s[o]));case"enum":return r.every((a,o)=>Zt(P.INT32,a,s[o]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":return i.T.equals(r,s);case"enum":return Zt(P.INT32,r,s);case"scalar":return Zt(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const a=i.findField(r.case);if(a===void 0)return!0;switch(a.kind){case"message":return a.T.equals(r.value,s.value);case"enum":return Zt(P.INT32,r.value,s.value);case"scalar":return Zt(a.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(a.kind));case"map":const o=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const l=i.V.T;return o.every(u=>l.equals(r[u],s[u]));case"enum":return o.every(u=>Zt(P.INT32,r[u],s[u]));case"scalar":const c=i.V.T;return o.every(u=>Zt(c,r[u],s[u]))}break}})},clone(n){const e=n.getType(),t=new e,i=t;for(const r of e.fields.byMember()){const s=n[r.localName];let a;if(r.repeated)a=s.map(ci);else if(r.kind=="map"){a=i[r.localName];for(const[o,l]of Object.entries(s))a[o]=ci(l)}else r.kind=="oneof"?a=r.findField(s.case)?{case:s.case,value:ci(s.value)}:{case:void 0}:a=ci(s);i[r.localName]=a}return t}}}function ci(n){if(n===void 0)return n;if(n instanceof _)return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function Fn(n){return n instanceof Uint8Array?n:new Uint8Array(n)}class ud{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const i of this.list())t[i.jsonName]=t[i.name]=i;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const i of this.list())t[i.no]=i;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const i of this.list())i.oneof?i.oneof!==t&&(t=i.oneof,e.push(t)):e.push(i)}return this.members}}function no(n,e){const t=io(n);return e?t:gd(md(t))}function dd(n){return no(n,!1)}const hd=io;function io(n){let e=!1;const t=[];for(let i=0;i<n.length;i++){let r=n.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),t.push(r);break}}return t.join("")}const fd=new Set(["constructor","toString","toJSON","valueOf"]),pd=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),ro=n=>"".concat(n,"$"),md=n=>pd.has(n)?ro(n):n,gd=n=>fd.has(n)?ro(n):n;class vd{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=dd(e)}addField(e){me(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}const m=qu("proto3",cd(),id(),Object.assign(Object.assign({},ld()),{newFieldList(n){return new ud(n,bd)},initFields(n){for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,i=n;if(e.repeated){i[t]=[];continue}switch(e.kind){case"oneof":i[t]={case:void 0};break;case"enum":i[t]=0;break;case"map":i[t]={};break;case"scalar":i[t]=vr(e.T);break}}}}));function bd(n){var e,t,i;const r=[];let s;for(const a of typeof n=="function"?n():n){const o=a;if(o.localName=no(a.name,a.oneof!==void 0),o.jsonName=(e=a.jsonName)!==null&&e!==void 0?e:hd(a.name),o.repeated=(t=a.repeated)!==null&&t!==void 0?t:!1,o.packed=(i=a.packed)!==null&&i!==void 0?i:a.kind=="enum"||a.kind=="scalar"&&a.T!=P.BYTES&&a.T!=P.STRING,a.oneof!==void 0){const l=typeof a.oneof=="string"?a.oneof:a.oneof.name;(!s||s.name!=l)&&(s=new vd(l)),o.oneof=s,s.addField(o)}r.push(o)}return r}class se extends _{constructor(e){super(),this.seconds=j.zero,this.nanos=0,m.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(m.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=j.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(t).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return se.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new se({seconds:j.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new se().fromBinary(e,t)}static fromJson(e,t){return new se().fromJson(e,t)}static fromJsonString(e,t){return new se().fromJsonString(e,t)}static equals(e,t){return m.util.equals(se,e,t)}}se.runtime=m;se.typeName="google.protobuf.Timestamp";se.fields=m.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);var yr;(function(n){n[n.DEFAULT_AC=0]="DEFAULT_AC",n[n.OPUS=1]="OPUS",n[n.AAC=2]="AAC"})(yr||(yr={}));m.util.setEnumType(yr,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]);var kr;(function(n){n[n.DEFAULT_VC=0]="DEFAULT_VC",n[n.H264_BASELINE=1]="H264_BASELINE",n[n.H264_MAIN=2]="H264_MAIN",n[n.H264_HIGH=3]="H264_HIGH",n[n.VP8=4]="VP8"})(kr||(kr={}));m.util.setEnumType(kr,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]);var ae;(function(n){n[n.AUDIO=0]="AUDIO",n[n.VIDEO=1]="VIDEO",n[n.DATA=2]="DATA"})(ae||(ae={}));m.util.setEnumType(ae,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]);var $;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.CAMERA=1]="CAMERA",n[n.MICROPHONE=2]="MICROPHONE",n[n.SCREEN_SHARE=3]="SCREEN_SHARE",n[n.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})($||($={}));m.util.setEnumType($,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]);var X;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH",n[n.OFF=3]="OFF"})(X||(X={}));m.util.setEnumType(X,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]);var an;(function(n){n[n.POOR=0]="POOR",n[n.GOOD=1]="GOOD",n[n.EXCELLENT=2]="EXCELLENT"})(an||(an={}));m.util.setEnumType(an,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"}]);var $e;(function(n){n[n.UNSET=0]="UNSET",n[n.DISABLED=1]="DISABLED",n[n.ENABLED=2]="ENABLED"})($e||($e={}));m.util.setEnumType($e,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]);var Wt;(function(n){n[n.UNKNOWN_REASON=0]="UNKNOWN_REASON",n[n.CLIENT_INITIATED=1]="CLIENT_INITIATED",n[n.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",n[n.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",n[n.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",n[n.ROOM_DELETED=5]="ROOM_DELETED",n[n.STATE_MISMATCH=6]="STATE_MISMATCH",n[n.JOIN_FAILURE=7]="JOIN_FAILURE"})(Wt||(Wt={}));m.util.setEnumType(Wt,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"}]);var Ie;(function(n){n[n.RR_UNKNOWN=0]="RR_UNKNOWN",n[n.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",n[n.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",n[n.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",n[n.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"})(Ie||(Ie={}));m.util.setEnumType(Ie,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]);var Yn;(function(n){n[n.SE_UNKNOWN=0]="SE_UNKNOWN",n[n.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",n[n.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND"})(Yn||(Yn={}));m.util.setEnumType(Yn,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]);let An=class zn extends _{constructor(e){super(),this.sid="",this.name="",this.emptyTimeout=0,this.maxParticipants=0,this.creationTime=j.zero,this.turnPassword="",this.enabledCodecs=[],this.metadata="",this.numParticipants=0,this.numPublishers=0,this.activeRecording=!1,m.util.initPartial(e,this)}static fromBinary(e,t){return new zn().fromBinary(e,t)}static fromJson(e,t){return new zn().fromJson(e,t)}static fromJsonString(e,t){return new zn().fromJsonString(e,t)}static equals(e,t){return m.util.equals(zn,e,t)}};An.runtime=m;An.typeName="livekit.Room";An.fields=m.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Je,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:12,name:"playout_delay",kind:"message",T:St}]);class Je extends _{constructor(e){super(),this.mime="",this.fmtpLine="",m.util.initPartial(e,this)}static fromBinary(e,t){return new Je().fromBinary(e,t)}static fromJson(e,t){return new Je().fromJson(e,t)}static fromJsonString(e,t){return new Je().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Je,e,t)}}Je.runtime=m;Je.typeName="livekit.Codec";Je.fields=m.util.newFieldList(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]);class St extends _{constructor(e){super(),this.enabled=!1,this.min=0,this.max=0,m.util.initPartial(e,this)}static fromBinary(e,t){return new St().fromBinary(e,t)}static fromJson(e,t){return new St().fromJson(e,t)}static fromJsonString(e,t){return new St().fromJsonString(e,t)}static equals(e,t){return m.util.equals(St,e,t)}}St.runtime=m;St.typeName="livekit.PlayoutDelay";St.fields=m.util.newFieldList(()=>[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]);class Tt extends _{constructor(e){super(),this.canSubscribe=!1,this.canPublish=!1,this.canPublishData=!1,this.canPublishSources=[],this.hidden=!1,this.recorder=!1,this.canUpdateMetadata=!1,m.util.initPartial(e,this)}static fromBinary(e,t){return new Tt().fromBinary(e,t)}static fromJson(e,t){return new Tt().fromJson(e,t)}static fromJsonString(e,t){return new Tt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Tt,e,t)}}Tt.runtime=m;Tt.typeName="livekit.ParticipantPermission";Tt.fields=m.util.newFieldList(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:m.getEnumType($),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8}]);class Ce extends _{constructor(e){super(),this.sid="",this.identity="",this.state=bn.JOINING,this.tracks=[],this.metadata="",this.joinedAt=j.zero,this.name="",this.version=0,this.region="",this.isPublisher=!1,m.util.initPartial(e,this)}static fromBinary(e,t){return new Ce().fromBinary(e,t)}static fromJson(e,t){return new Ce().fromJson(e,t)}static fromJsonString(e,t){return new Ce().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Ce,e,t)}}Ce.runtime=m;Ce.typeName="livekit.ParticipantInfo";Ce.fields=m.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:m.getEnumType(bn)},{no:4,name:"tracks",kind:"message",T:ve,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Tt},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8}]);var bn;(function(n){n[n.JOINING=0]="JOINING",n[n.JOINED=1]="JOINED",n[n.ACTIVE=2]="ACTIVE",n[n.DISCONNECTED=3]="DISCONNECTED"})(bn||(bn={}));m.util.setEnumType(bn,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]);class en extends _{constructor(e){super(),m.util.initPartial(e,this)}static fromBinary(e,t){return new en().fromBinary(e,t)}static fromJson(e,t){return new en().fromJson(e,t)}static fromJsonString(e,t){return new en().fromJsonString(e,t)}static equals(e,t){return m.util.equals(en,e,t)}}en.runtime=m;en.typeName="livekit.Encryption";en.fields=m.util.newFieldList(()=>[]);var de;(function(n){n[n.NONE=0]="NONE",n[n.GCM=1]="GCM",n[n.CUSTOM=2]="CUSTOM"})(de||(de={}));m.util.setEnumType(de,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);class Ct extends _{constructor(e){super(),this.mimeType="",this.mid="",this.cid="",this.layers=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new Ct().fromBinary(e,t)}static fromJson(e,t){return new Ct().fromJson(e,t)}static fromJsonString(e,t){return new Ct().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Ct,e,t)}}Ct.runtime=m;Ct.typeName="livekit.SimulcastCodecInfo";Ct.fields=m.util.newFieldList(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:he,repeated:!0}]);class ve extends _{constructor(e){super(),this.sid="",this.type=ae.AUDIO,this.name="",this.muted=!1,this.width=0,this.height=0,this.simulcast=!1,this.disableDtx=!1,this.source=$.UNKNOWN,this.layers=[],this.mimeType="",this.mid="",this.codecs=[],this.stereo=!1,this.disableRed=!1,this.encryption=de.NONE,this.stream="",m.util.initPartial(e,this)}static fromBinary(e,t){return new ve().fromBinary(e,t)}static fromJson(e,t){return new ve().fromJson(e,t)}static fromJsonString(e,t){return new ve().fromJsonString(e,t)}static equals(e,t){return m.util.equals(ve,e,t)}}ve.runtime=m;ve.typeName="livekit.TrackInfo";ve.fields=m.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:m.getEnumType(ae)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:m.getEnumType($)},{no:10,name:"layers",kind:"message",T:he,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Ct,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:m.getEnumType(de)},{no:17,name:"stream",kind:"scalar",T:9}]);class he extends _{constructor(e){super(),this.quality=X.LOW,this.width=0,this.height=0,this.bitrate=0,this.ssrc=0,m.util.initPartial(e,this)}static fromBinary(e,t){return new he().fromBinary(e,t)}static fromJson(e,t){return new he().fromJson(e,t)}static fromJsonString(e,t){return new he().fromJsonString(e,t)}static equals(e,t){return m.util.equals(he,e,t)}}he.runtime=m;he.typeName="livekit.VideoLayer";he.fields=m.util.newFieldList(()=>[{no:1,name:"quality",kind:"enum",T:m.getEnumType(X)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]);class Xe extends _{constructor(e){super(),this.kind=Z.RELIABLE,this.value={case:void 0},m.util.initPartial(e,this)}static fromBinary(e,t){return new Xe().fromBinary(e,t)}static fromJson(e,t){return new Xe().fromJson(e,t)}static fromJsonString(e,t){return new Xe().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Xe,e,t)}}Xe.runtime=m;Xe.typeName="livekit.DataPacket";Xe.fields=m.util.newFieldList(()=>[{no:1,name:"kind",kind:"enum",T:m.getEnumType(Z)},{no:2,name:"user",kind:"message",T:tt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:wt,oneof:"value"}]);var Z;(function(n){n[n.RELIABLE=0]="RELIABLE",n[n.LOSSY=1]="LOSSY"})(Z||(Z={}));m.util.setEnumType(Z,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);class wt extends _{constructor(e){super(),this.speakers=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new wt().fromBinary(e,t)}static fromJson(e,t){return new wt().fromJson(e,t)}static fromJsonString(e,t){return new wt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(wt,e,t)}}wt.runtime=m;wt.typeName="livekit.ActiveSpeakerUpdate";wt.fields=m.util.newFieldList(()=>[{no:1,name:"speakers",kind:"message",T:et,repeated:!0}]);class et extends _{constructor(e){super(),this.sid="",this.level=0,this.active=!1,m.util.initPartial(e,this)}static fromBinary(e,t){return new et().fromBinary(e,t)}static fromJson(e,t){return new et().fromJson(e,t)}static fromJsonString(e,t){return new et().fromJsonString(e,t)}static equals(e,t){return m.util.equals(et,e,t)}}et.runtime=m;et.typeName="livekit.SpeakerInfo";et.fields=m.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]);class tt extends _{constructor(e){super(),this.participantSid="",this.payload=new Uint8Array(0),this.destinationSids=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new tt().fromBinary(e,t)}static fromJson(e,t){return new tt().fromJson(e,t)}static fromJsonString(e,t){return new tt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(tt,e,t)}}tt.runtime=m;tt.typeName="livekit.UserPacket";tt.fields=m.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0}]);class nt extends _{constructor(e){super(),this.participantSid="",this.trackSids=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new nt().fromBinary(e,t)}static fromJson(e,t){return new nt().fromJson(e,t)}static fromJsonString(e,t){return new nt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(nt,e,t)}}nt.runtime=m;nt.typeName="livekit.ParticipantTracks";nt.fields=m.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]);class Et extends _{constructor(e){super(),this.edition=Mn.Standard,this.version="",this.protocol=0,this.region="",this.nodeId="",this.debugInfo="",m.util.initPartial(e,this)}static fromBinary(e,t){return new Et().fromBinary(e,t)}static fromJson(e,t){return new Et().fromJson(e,t)}static fromJsonString(e,t){return new Et().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Et,e,t)}}Et.runtime=m;Et.typeName="livekit.ServerInfo";Et.fields=m.util.newFieldList(()=>[{no:1,name:"edition",kind:"enum",T:m.getEnumType(Mn)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9}]);var Mn;(function(n){n[n.Standard=0]="Standard",n[n.Cloud=1]="Cloud"})(Mn||(Mn={}));m.util.setEnumType(Mn,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);class xt extends _{constructor(e){super(),this.sdk=_n.UNKNOWN,this.version="",this.protocol=0,this.os="",this.osVersion="",this.deviceModel="",this.browser="",this.browserVersion="",this.address="",this.network="",m.util.initPartial(e,this)}static fromBinary(e,t){return new xt().fromBinary(e,t)}static fromJson(e,t){return new xt().fromJson(e,t)}static fromJsonString(e,t){return new xt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(xt,e,t)}}xt.runtime=m;xt.typeName="livekit.ClientInfo";xt.fields=m.util.newFieldList(()=>[{no:1,name:"sdk",kind:"enum",T:m.getEnumType(_n)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}]);var _n;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.JS=1]="JS",n[n.SWIFT=2]="SWIFT",n[n.ANDROID=3]="ANDROID",n[n.FLUTTER=4]="FLUTTER",n[n.GO=5]="GO",n[n.UNITY=6]="UNITY",n[n.REACT_NATIVE=7]="REACT_NATIVE",n[n.RUST=8]="RUST"})(_n||(_n={}));m.util.setEnumType(_n,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"}]);class it extends _{constructor(e){super(),this.resumeConnection=$e.UNSET,this.forceRelay=$e.UNSET,m.util.initPartial(e,this)}static fromBinary(e,t){return new it().fromBinary(e,t)}static fromJson(e,t){return new it().fromJson(e,t)}static fromJsonString(e,t){return new it().fromJsonString(e,t)}static equals(e,t){return m.util.equals(it,e,t)}}it.runtime=m;it.typeName="livekit.ClientConfiguration";it.fields=m.util.newFieldList(()=>[{no:1,name:"video",kind:"message",T:rt},{no:2,name:"screen",kind:"message",T:rt},{no:3,name:"resume_connection",kind:"enum",T:m.getEnumType($e)},{no:4,name:"disabled_codecs",kind:"message",T:Pt},{no:5,name:"force_relay",kind:"enum",T:m.getEnumType($e)}]);class rt extends _{constructor(e){super(),this.hardwareEncoder=$e.UNSET,m.util.initPartial(e,this)}static fromBinary(e,t){return new rt().fromBinary(e,t)}static fromJson(e,t){return new rt().fromJson(e,t)}static fromJsonString(e,t){return new rt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(rt,e,t)}}rt.runtime=m;rt.typeName="livekit.VideoConfiguration";rt.fields=m.util.newFieldList(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:m.getEnumType($e)}]);class Pt extends _{constructor(e){super(),this.codecs=[],this.publish=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new Pt().fromBinary(e,t)}static fromJson(e,t){return new Pt().fromJson(e,t)}static fromJsonString(e,t){return new Pt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Pt,e,t)}}Pt.runtime=m;Pt.typeName="livekit.DisabledCodecs";Pt.fields=m.util.newFieldList(()=>[{no:1,name:"codecs",kind:"message",T:Je,repeated:!0},{no:2,name:"publish",kind:"message",T:Je,repeated:!0}]);class tn extends _{constructor(e){super(),this.duration=0,this.packets=0,this.packetRate=0,this.bytes=j.zero,this.headerBytes=j.zero,this.bitrate=0,this.packetsLost=0,this.packetLossRate=0,this.packetLossPercentage=0,this.packetsDuplicate=0,this.packetDuplicateRate=0,this.bytesDuplicate=j.zero,this.headerBytesDuplicate=j.zero,this.bitrateDuplicate=0,this.packetsPadding=0,this.packetPaddingRate=0,this.bytesPadding=j.zero,this.headerBytesPadding=j.zero,this.bitratePadding=0,this.packetsOutOfOrder=0,this.frames=0,this.frameRate=0,this.jitterCurrent=0,this.jitterMax=0,this.gapHistogram={},this.nacks=0,this.nackAcks=0,this.nackMisses=0,this.nackRepeated=0,this.plis=0,this.firs=0,this.rttCurrent=0,this.rttMax=0,this.keyFrames=0,this.layerLockPlis=0,this.sampleRate=0,this.driftMs=0,m.util.initPartial(e,this)}static fromBinary(e,t){return new tn().fromBinary(e,t)}static fromJson(e,t){return new tn().fromJson(e,t)}static fromJsonString(e,t){return new tn().fromJsonString(e,t)}static equals(e,t){return m.util.equals(tn,e,t)}}tn.runtime=m;tn.typeName="livekit.RTPStats";tn.fields=m.util.newFieldList(()=>[{no:1,name:"start_time",kind:"message",T:se},{no:2,name:"end_time",kind:"message",T:se},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:se},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:se},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:se},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:se},{no:42,name:"sample_rate",kind:"scalar",T:1},{no:43,name:"drift_ms",kind:"scalar",T:1}]);class nn extends _{constructor(e){super(),this.unixMicro=j.zero,this.ticks=0,m.util.initPartial(e,this)}static fromBinary(e,t){return new nn().fromBinary(e,t)}static fromJson(e,t){return new nn().fromJson(e,t)}static fromJsonString(e,t){return new nn().fromJsonString(e,t)}static equals(e,t){return m.util.equals(nn,e,t)}}nn.runtime=m;nn.typeName="livekit.TimedVersion";nn.fields=m.util.newFieldList(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]);const Bn=7e3,yd=[0,300,2*2*300,3*3*300,4*4*300,Bn,Bn,Bn,Bn,Bn];class kd{constructor(e){this._retryDelays=e!==void 0?[...e]:yd}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function T(n,e,t,i){function r(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):r(u.value).then(o,l)}c((i=i.apply(n,e||[])).next())})}function Ps(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cn(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Ps=="function"?Ps(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(a){return new Promise(function(o,l){a=n[s](a),r(o,l,a.done,a.value)})}}function r(s,a,o,l){Promise.resolve(l).then(function(c){s({value:c,done:o})},a)}}var Yr={exports:{}},En=typeof Reflect=="object"?Reflect:null,Rs=En&&typeof En.apply=="function"?En.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},mi;En&&typeof En.ownKeys=="function"?mi=En.ownKeys:Object.getOwnPropertySymbols?mi=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:mi=function(e){return Object.getOwnPropertyNames(e)};function Sd(n){console&&console.warn&&console.warn(n)}var so=Number.isNaN||function(e){return e!==e};function z(){z.init.call(this)}Yr.exports=z;Yr.exports.once=Ed;z.EventEmitter=z;z.prototype._events=void 0;z.prototype._eventsCount=0;z.prototype._maxListeners=void 0;var Ns=10;function ji(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return Ns},set:function(n){if(typeof n!="number"||n<0||so(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Ns=n}});z.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};z.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||so(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ao(n){return n._maxListeners===void 0?z.defaultMaxListeners:n._maxListeners}z.prototype.getMaxListeners=function(){return ao(this)};z.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r=e==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")Rs(l,this,t);else for(var c=l.length,u=ho(l,c),i=0;i<c;++i)Rs(u[i],this,t);return!0};function oo(n,e,t,i){var r,s,a;if(ji(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),a=s[e]),a===void 0)a=s[e]=t,++n._eventsCount;else if(typeof a=="function"?a=s[e]=i?[t,a]:[a,t]:i?a.unshift(t):a.push(t),r=ao(n),r>0&&a.length>r&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=n,o.type=e,o.count=a.length,Sd(o)}return n}z.prototype.addListener=function(e,t){return oo(this,e,t,!1)};z.prototype.on=z.prototype.addListener;z.prototype.prependListener=function(e,t){return oo(this,e,t,!0)};function Td(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function co(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},r=Td.bind(i);return r.listener=t,i.wrapFn=r,r}z.prototype.once=function(e,t){return ji(t),this.on(e,co(this,e,t)),this};z.prototype.prependOnceListener=function(e,t){return ji(t),this.prependListener(e,co(this,e,t)),this};z.prototype.removeListener=function(e,t){var i,r,s,a,o;if(ji(t),r=this._events,r===void 0)return this;if(i=r[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){o=i[a].listener,s=a;break}if(s<0)return this;s===0?i.shift():Cd(i,s),i.length===1&&(r[e]=i[0]),r.removeListener!==void 0&&this.emit("removeListener",e,o||t)}return this};z.prototype.off=z.prototype.removeListener;z.prototype.removeAllListeners=function(e){var t,i,r;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),a;for(r=0;r<s.length;++r)a=s[r],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};function lo(n,e,t){var i=n._events;if(i===void 0)return[];var r=i[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?wd(r):ho(r,r.length)}z.prototype.listeners=function(e){return lo(this,e,!0)};z.prototype.rawListeners=function(e){return lo(this,e,!1)};z.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):uo.call(n,e)};z.prototype.listenerCount=uo;function uo(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}z.prototype.eventNames=function(){return this._eventsCount>0?mi(this._events):[]};function ho(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function Cd(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function wd(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function Ed(n,e){return new Promise(function(t,i){function r(a){n.removeListener(e,s),i(a)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",r),t([].slice.call(arguments))}fo(n,e,s,{once:!0}),e!=="error"&&xd(n,r,{once:!0})})}function xd(n,e,t){typeof n.on=="function"&&fo(n,"error",e,t)}function fo(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function r(s){i.once&&n.removeEventListener(e,r),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var vt=Yr.exports;let po=!0,mo=!0;function gi(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function Sn(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(a,o){if(a!==e)return r.apply(this,arguments);const l=c=>{const u=t(c);u&&(o.handleEvent?o.handleEvent(u):o(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(o,l),r.apply(this,[a,l])};const s=i.removeEventListener;i.removeEventListener=function(a,o){if(a!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(o))return s.apply(this,arguments);const l=this._eventMap[e].get(o);return this._eventMap[e].delete(o),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function Pd(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(po=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function Rd(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(mo=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function go(){if(typeof window=="object"){if(po)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Zr(n,e){mo&&console.warn(n+" is deprecated, please use "+e+" instead.")}function Nd(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.mozGetUserMedia)e.browser="firefox",e.version=gi(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=gi(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=gi(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function Is(n){return Object.prototype.toString.call(n)==="[object Object]"}function vo(n){return Is(n)?Object.keys(n).reduce(function(e,t){const i=Is(n[t]),r=i?vo(n[t]):n[t],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[t]:r})},{}):n}function Sr(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Sr(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(r=>{Sr(n,n.get(r),t)})}))}function Ms(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&s.push(a)}),s.forEach(a=>{n.forEach(o=>{o.type===i&&o.trackId===a.id&&Sr(n,o,r)})}),r}const _s=go;function bo(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const l={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof o[c]=="object"?o[c]:{ideal:o[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(p,v){return p?p+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(u.ideal!==void 0){l.optional=l.optional||[];let p={};typeof u.ideal=="number"?(p[h("min",c)]=u.ideal,l.optional.push(p),p={},p[h("max",c)]=u.ideal,l.optional.push(p)):(p[h("",c)]=u.ideal,l.optional.push(p))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[h("",c)]=u.exact):["min","max"].forEach(p=>{u[p]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[h(p,c)]=u[p])})}),o.advanced&&(l.optional=(l.optional||[]).concat(o.advanced)),l},r=function(o,l){if(e.version>=61)return l(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const c=function(u,h,p){h in u&&!(p in u)&&(u[p]=u[h],delete u[h])};o=JSON.parse(JSON.stringify(o)),c(o.audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=i(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete o.video.facingMode;let h;if(c.exact==="environment"||c.ideal==="environment"?h=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(h=["front"]),h)return t.mediaDevices.enumerateDevices().then(p=>{p=p.filter(b=>b.kind==="videoinput");let v=p.find(b=>h.some(g=>b.label.toLowerCase().includes(g)));return!v&&p.length&&h.includes("back")&&(v=p[p.length-1]),v&&(o.video.deviceId=c.exact?{exact:v.deviceId}:{ideal:v.deviceId}),o.video=i(o.video),_s("chrome: "+JSON.stringify(o)),l(o)})}o.video=i(o.video)}return _s("chrome: "+JSON.stringify(o)),l(o)},s=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,l,c){r(o,u=>{t.webkitGetUserMedia(u,l,h=>{c&&c(s(h))})})};if(t.getUserMedia=a.bind(t),t.mediaDevices.getUserMedia){const o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return r(l,c=>o(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function Id(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(r=>{const s=i.video&&i.video.width,a=i.video&&i.video.height,o=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},s&&(i.video.mandatory.maxWidth=s),a&&(i.video.mandatory.maxHeight=a),n.navigator.mediaDevices.getUserMedia(i)})}}}function yo(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function ko(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===r.track.id):s={track:r.track};const a=new Event("track");a.track=r.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[i.stream],this.dispatchEvent(a)}),i.stream.getTracks().forEach(r=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===r.id):s={track:r};const a=new Event("track");a.track=r,a.receiver=s,a.transceiver={receiver:s},a.streams=[i.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Sn(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function So(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,l){let c=r.apply(this,arguments);return c||(c=e(this,o),this._senders.push(c)),c};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const l=this._senders.indexOf(o);l!==-1&&this._senders.splice(l,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(a=>{const o=this._senders.find(l=>l.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function To(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,r,s]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const a=function(l){const c={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(v=>{p[v]=h.stat(v)}),c[p.id]=p}),c},o=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){r(o(a(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(u){l(o(a(u)))},c])}).then(r,s)}}function Co(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(a=>a._pc=this),s});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>Ms(a,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Sn(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>Ms(s,r.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let r,s,a;return this.getSenders().forEach(o=>{o.track===i&&(r?a=!0:r=o)}),this.getReceivers().forEach(o=>(o.track===i&&(s?a=!0:s=o),o.track===i)),a||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function wo(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(l)===-1&&this._shimmedLocalStreams[o.id].push(l):this._shimmedLocalStreams[o.id]=[o,l],l};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(h=>h.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const l=this._shimmedLocalStreams[o].indexOf(a);l!==-1&&this._shimmedLocalStreams[o].splice(l,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),r.apply(this,arguments)}}function Eo(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return wo(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(v=>v.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new n.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}i.apply(this,[u])};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[h.id];if(b)b.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new n.MediaStream([u]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function s(c,u){let h=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(p=>{const v=c._reverseStreams[p],b=c._streams[v.id];h=h.replace(new RegExp(b.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function a(c,u){let h=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(p=>{const v=c._reverseStreams[p],b=c._streams[v.id];h=h.replace(new RegExp(v.id,"g"),b.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(c){const u=n.RTCPeerConnection.prototype[c],h={[c](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[b=>{const g=s(this,b);p[0].apply(null,[g])},b=>{p[1]&&p[1].apply(null,b)},arguments[2]]):u.apply(this,arguments).then(b=>s(this,b))}};n.RTCPeerConnection.prototype[c]=h[c]});const o=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(g=>u.track===g)&&(p=this._streams[v])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Tr(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=r[t]})}function xo(n,e){Sn(n,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}var Ds=Object.freeze({__proto__:null,fixNegotiationNeeded:xo,shimAddTrackRemoveTrack:Eo,shimAddTrackRemoveTrackWithNative:wo,shimGetDisplayMedia:Id,shimGetSendersWithDtmf:So,shimGetStats:To,shimGetUserMedia:bo,shimMediaStream:yo,shimOnTrack:ko,shimPeerConnection:Tr,shimSenderReceiverGetStats:Co});function Po(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(r,s,a){Zr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(r).then(s,a)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const r=function(a,o,l){o in a&&!(l in a)&&(a[l]=a[o],delete a[o])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const o=a.apply(this,arguments);return r(o,"mozAutoGainControl","autoGainControl"),r(o,"mozNoiseSuppression","noiseSuppression"),o}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o,"autoGainControl","mozAutoGainControl"),r(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function Md(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function Ro(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cr(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=n.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[r]=a[r]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,a,o]=arguments;return i.apply(this,[s||null]).then(l=>{if(e.version<53&&!a)try{l.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,h)=>{l.set(h,Object.assign({},u,{type:t[u.type]||u.type}))})}return l}).then(a,o)}}function No(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=t.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Io(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Sn(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Mo(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){Zr("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function _o(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function Do(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:a}=s,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=i,a.sendEncodings=i,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function Ao(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function Oo(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Lo(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var As=Object.freeze({__proto__:null,shimAddTransceiver:Do,shimCreateAnswer:Lo,shimCreateOffer:Oo,shimGetDisplayMedia:Md,shimGetParameters:Ao,shimGetUserMedia:Po,shimOnTrack:Ro,shimPeerConnection:Cr,shimRTCDataChannel:_o,shimReceiverGetStats:Io,shimRemoveStream:Mo,shimSenderGetStats:No});function Uo(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},n.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return s&&s.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const r=t.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function jo(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,i.dispatchEvent(a)})}),e.apply(i,arguments)}}}function Fo(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(c,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=t.apply(this,[h]);return u?(p.then(c,u),Promise.resolve()):p},e.createAnswer=function(c,u){const h=arguments.length>=2?arguments[2]:arguments[0],p=i.apply(this,[h]);return u?(p.then(c,u),Promise.resolve()):p};let o=function(l,c,u){const h=r.apply(this,[l]);return u?(h.then(c,u),Promise.resolve()):h};e.setLocalDescription=o,o=function(l,c,u){const h=s.apply(this,[l]);return u?(h.then(c,u),Promise.resolve()):h},e.setRemoteDescription=o,o=function(l,c,u){const h=a.apply(this,[l]);return u?(h.then(c,u),Promise.resolve()):h},e.addIceCandidate=o}function Bo(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=r=>i(Jo(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function Jo(n){return n&&n.video!==void 0?Object.assign({},n,{video:vo(n.video)}):n}function Vo(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let a=0;a<i.iceServers.length;a++){let o=i.iceServers[a];o.urls===void 0&&o.url?(Zr("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,s.push(o)):s.push(i.iceServers[a])}i.iceServers=s}return new e(i,r)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function qo(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zo(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Wo(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var Os=Object.freeze({__proto__:null,shimAudioContext:Wo,shimCallbacksAPI:Fo,shimConstraints:Jo,shimCreateOfferLegacy:zo,shimGetUserMedia:Bo,shimLocalStreamsAPI:Uo,shimRTCIceServerUrls:Vo,shimRemoteStreamsAPI:jo,shimTrackEventTransceiver:qo}),Ho={exports:{}};(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(t){return t.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(t){const i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){const i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(t){let i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(t){const i=[];i.push(t.foundation);const r=t.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);const s=t.type;return i.push("typ"),i.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let i=t.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(t){let i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);const r=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(t){const i=t.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const i={};let r;const s=t.substring(t.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)r=s[a].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(t){let i="",r=t.payloadType;if(t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const s=[];Object.keys(t.parameters).forEach(a=>{t.parameters[a]!==void 0?s.push(a+"="+t.parameters[a]):s.push(a)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){const i=t.substring(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){let i="",r=t.payloadType;return t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){const i=t.indexOf(" "),r={ssrc:parseInt(t.substring(7,i),10)},s=t.indexOf(":",i);return s>-1?(r.attribute=t.substring(i+1,s),r.value=t.substring(s+1)):r.attribute=t.substring(i+1),r},e.parseSsrcGroup=function(t){const i=t.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(t){const i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(t){const i=t.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(t,i){return{role:"auto",fingerprints:e.matchPrefix(t+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){let r="a=setup:"+i+`\r
`;return t.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(t){const i=t.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const i=t.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){return e.matchPrefix(t+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,i){const r=e.matchPrefix(t+i,"a=ice-ufrag:")[0],s=e.matchPrefix(t+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(t){let i="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(t){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t)[0].split(" ");i.profile=s[2];for(let o=3;o<s.length;o++){const l=s[o],c=e.matchPrefix(t,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),h=e.matchPrefix(t,"a=fmtp:"+l+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(o=>{i.headerExtensions.push(e.parseExtmap(o))});const a=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(o=>{a.forEach(l=>{o.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||o.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(t,i){let r="";r+="m="+t+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{r+=e.writeRtpMap(a),r+=e.writeFmtp(a),r+=e.writeRtcpFb(a)});let s=0;return i.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{r+=e.writeExtmap(a)}),r},e.parseRtpEncodingParameters=function(t){const i=[],r=e.parseRtpParameters(t),s=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,o=e.matchPrefix(t,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),l=o.length>0&&o[0].ssrc;let c;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(b=>parseInt(b,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),r.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let v={ssrc:l,codecPayloadType:parseInt(p.parameters.apt,10)};l&&c&&(v.rtx={ssrc:c}),i.push(v),s&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},i.push(v))}}),i.length===0&&l&&i.push({ssrc:l});let h=e.matchPrefix(t,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,i.forEach(p=>{p.maxBitrate=h})),i},e.parseRtcpParameters=function(t){const i={},r=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const a=e.matchPrefix(t,"a=rtcp-mux");return i.mux=a.length>0,i},e.writeRtcpParameters=function(t){let i="";return t.reducedSize&&(i+=`a=rtcp-rsize\r
`),t.mux&&(i+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(i+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),i},e.parseMsid=function(t){let i;const r=e.matchPrefix(t,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){const i=e.parseMLine(t),r=e.matchPrefix(t,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const a=e.matchPrefix(t,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const o=e.matchPrefix(t,"a=sctpmap:");if(o.length>0){const l=o[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,i){let r=[];return t.protocol!=="DTLS/SCTP"?r=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,i,r){let s;const a=i!==void 0?i:2;return t?s=t:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,i){const r=e.splitLines(t);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const r=e.splitLines(t)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(t){const r=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const i=e.splitLines(t);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},n.exports=e})(Ho);var Go=Ho.exports,xn=Au(Go),_d=_u({__proto__:null,default:xn},[Go]);function vi(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=xn.parseCandidate(i.candidate);for(const a in s)a in r||Object.defineProperty(r,a,{value:s[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,Sn(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function wr(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Sn(n,"icecandidate",e=>{if(e.candidate){const t=xn.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function bi(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(o){if(!o||!o.sdp)return!1;const l=xn.splitSections(o.sdp);return l.shift(),l.some(c=>{const u=xn.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(o){const l=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},r=function(o){let l=65536;return e.browser==="firefox"&&(e.version<57?o===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},s=function(o,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=xn.matchPrefix(o.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=i(arguments[0]),c=r(l),u=s(arguments[0],l);let h;c===0&&u===0?h=Number.POSITIVE_INFINITY:c===0||u===0?h=Math.max(c,u):h=Math.min(c,u);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return h}}),this._sctp=p}return a.apply(this,arguments)}}function yi(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const o=arguments[0],l=o.length||o.size||o.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const r=t.apply(this,arguments);return e(r,this),r},Sn(n,"datachannel",i=>(e(i.channel,i.target),i))}function Er(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",r);s.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function xr(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&r instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return t.apply(this,arguments)}}function ki(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Si(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return t.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?t.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>t.apply(this,[a]))})}var Dd=Object.freeze({__proto__:null,removeExtmapAllowMixed:xr,shimAddIceCandidateNullOrEmpty:ki,shimConnectionState:Er,shimMaxMessageSize:bi,shimParameterlessSetLocalDescription:Si,shimRTCIceCandidate:vi,shimRTCIceCandidateRelayProtocol:wr,shimSendThrowTypeError:yi});function Ad(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=go,i=Nd(n),r={browserDetails:i,commonShim:Dd,extractVersion:gi,disableLog:Pd,disableWarnings:Rd,sdp:_d};switch(i.browser){case"chrome":if(!Ds||!Tr||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),r;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),r;t("adapter.js shimming chrome."),r.browserShim=Ds,ki(n,i),Si(n),bo(n,i),yo(n),Tr(n,i),ko(n),Eo(n,i),So(n),To(n),Co(n),xo(n,i),vi(n),wr(n),Er(n),bi(n,i),yi(n),xr(n,i);break;case"firefox":if(!As||!Cr||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),r;t("adapter.js shimming firefox."),r.browserShim=As,ki(n,i),Si(n),Po(n,i),Cr(n,i),Ro(n),Mo(n),No(n),Io(n),_o(n),Do(n),Ao(n),Oo(n),Lo(n),vi(n),Er(n),bi(n,i),yi(n);break;case"safari":if(!Os||!e.shimSafari)return t("Safari shim is not included in this adapter release."),r;t("adapter.js shimming safari."),r.browserShim=Os,ki(n,i),Si(n),Vo(n),zo(n),Fo(n),Uo(n),jo(n),qo(n),Bo(n),Wo(n),vi(n),wr(n),bi(n,i),yi(n),xr(n,i);break;default:t("Unsupported browser!");break}return r}Ad({window:typeof window>"u"?void 0:window});var be;(function(n){n[n.PUBLISHER=0]="PUBLISHER",n[n.SUBSCRIBER=1]="SUBSCRIBER"})(be||(be={}));m.util.setEnumType(be,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]);var yn;(function(n){n[n.ACTIVE=0]="ACTIVE",n[n.PAUSED=1]="PAUSED"})(yn||(yn={}));m.util.setEnumType(yn,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]);var Ei;(function(n){n[n.UDP=0]="UDP",n[n.TCP=1]="TCP",n[n.TLS=2]="TLS"})(Ei||(Ei={}));m.util.setEnumType(Ei,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]);class Rt extends _{constructor(e){super(),this.message={case:void 0},m.util.initPartial(e,this)}static fromBinary(e,t){return new Rt().fromBinary(e,t)}static fromJson(e,t){return new Rt().fromJson(e,t)}static fromJsonString(e,t){return new Rt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Rt,e,t)}}Rt.runtime=m;Rt.typeName="livekit.SignalRequest";Rt.fields=m.util.newFieldList(()=>[{no:1,name:"offer",kind:"message",T:fe,oneof:"message"},{no:2,name:"answer",kind:"message",T:fe,oneof:"message"},{no:3,name:"trickle",kind:"message",T:qe,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Ve,oneof:"message"},{no:5,name:"mute",kind:"message",T:ze,oneof:"message"},{no:6,name:"subscription",kind:"message",T:De,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:at,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ae,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:ot,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:dt,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:ht,oneof:"message"},{no:13,name:"simulate",kind:"message",T:le,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:ct,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:pt,oneof:"message"}]);class st extends _{constructor(e){super(),this.message={case:void 0},m.util.initPartial(e,this)}static fromBinary(e,t){return new st().fromBinary(e,t)}static fromJson(e,t){return new st().fromJson(e,t)}static fromJsonString(e,t){return new st().fromJsonString(e,t)}static equals(e,t){return m.util.equals(st,e,t)}}st.runtime=m;st.typeName="livekit.SignalResponse";st.fields=m.util.newFieldList(()=>[{no:1,name:"join",kind:"message",T:Nt,oneof:"message"},{no:2,name:"answer",kind:"message",T:fe,oneof:"message"},{no:3,name:"offer",kind:"message",T:fe,oneof:"message"},{no:4,name:"trickle",kind:"message",T:qe,oneof:"message"},{no:5,name:"update",kind:"message",T:_t,oneof:"message"},{no:6,name:"track_published",kind:"message",T:We,oneof:"message"},{no:8,name:"leave",kind:"message",T:Ae,oneof:"message"},{no:9,name:"mute",kind:"message",T:ze,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Dt,oneof:"message"},{no:11,name:"room_update",kind:"message",T:At,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Lt,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:jt,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Bt,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Jt,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Mt,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:It,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Vt,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:zt,oneof:"message"}]);class _e extends _{constructor(e){super(),this.codec="",this.cid="",this.enableSimulcastLayers=!1,m.util.initPartial(e,this)}static fromBinary(e,t){return new _e().fromBinary(e,t)}static fromJson(e,t){return new _e().fromJson(e,t)}static fromJsonString(e,t){return new _e().fromJsonString(e,t)}static equals(e,t){return m.util.equals(_e,e,t)}}_e.runtime=m;_e.typeName="livekit.SimulcastCodec";_e.fields=m.util.newFieldList(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:3,name:"enable_simulcast_layers",kind:"scalar",T:8}]);class Ve extends _{constructor(e){super(),this.cid="",this.name="",this.type=ae.AUDIO,this.width=0,this.height=0,this.muted=!1,this.disableDtx=!1,this.source=$.UNKNOWN,this.layers=[],this.simulcastCodecs=[],this.sid="",this.stereo=!1,this.disableRed=!1,this.encryption=de.NONE,this.stream="",m.util.initPartial(e,this)}static fromBinary(e,t){return new Ve().fromBinary(e,t)}static fromJson(e,t){return new Ve().fromJson(e,t)}static fromJsonString(e,t){return new Ve().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Ve,e,t)}}Ve.runtime=m;Ve.typeName="livekit.AddTrackRequest";Ve.fields=m.util.newFieldList(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:m.getEnumType(ae)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:m.getEnumType($)},{no:9,name:"layers",kind:"message",T:he,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:_e,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:m.getEnumType(de)},{no:15,name:"stream",kind:"scalar",T:9}]);class qe extends _{constructor(e){super(),this.candidateInit="",this.target=be.PUBLISHER,m.util.initPartial(e,this)}static fromBinary(e,t){return new qe().fromBinary(e,t)}static fromJson(e,t){return new qe().fromJson(e,t)}static fromJsonString(e,t){return new qe().fromJsonString(e,t)}static equals(e,t){return m.util.equals(qe,e,t)}}qe.runtime=m;qe.typeName="livekit.TrickleRequest";qe.fields=m.util.newFieldList(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:m.getEnumType(be)}]);class ze extends _{constructor(e){super(),this.sid="",this.muted=!1,m.util.initPartial(e,this)}static fromBinary(e,t){return new ze().fromBinary(e,t)}static fromJson(e,t){return new ze().fromJson(e,t)}static fromJsonString(e,t){return new ze().fromJsonString(e,t)}static equals(e,t){return m.util.equals(ze,e,t)}}ze.runtime=m;ze.typeName="livekit.MuteTrackRequest";ze.fields=m.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]);class Nt extends _{constructor(e){super(),this.otherParticipants=[],this.serverVersion="",this.iceServers=[],this.subscriberPrimary=!1,this.alternativeUrl="",this.serverRegion="",this.pingTimeout=0,this.pingInterval=0,this.sifTrailer=new Uint8Array(0),m.util.initPartial(e,this)}static fromBinary(e,t){return new Nt().fromBinary(e,t)}static fromJson(e,t){return new Nt().fromJson(e,t)}static fromJsonString(e,t){return new Nt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Nt,e,t)}}Nt.runtime=m;Nt.typeName="livekit.JoinResponse";Nt.fields=m.util.newFieldList(()=>[{no:1,name:"room",kind:"message",T:An},{no:2,name:"participant",kind:"message",T:Ce},{no:3,name:"other_participants",kind:"message",T:Ce,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:lt,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:it},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Et},{no:13,name:"sif_trailer",kind:"scalar",T:12}]);class It extends _{constructor(e){super(),this.iceServers=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new It().fromBinary(e,t)}static fromJson(e,t){return new It().fromJson(e,t)}static fromJsonString(e,t){return new It().fromJsonString(e,t)}static equals(e,t){return m.util.equals(It,e,t)}}It.runtime=m;It.typeName="livekit.ReconnectResponse";It.fields=m.util.newFieldList(()=>[{no:1,name:"ice_servers",kind:"message",T:lt,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:it}]);class We extends _{constructor(e){super(),this.cid="",m.util.initPartial(e,this)}static fromBinary(e,t){return new We().fromBinary(e,t)}static fromJson(e,t){return new We().fromJson(e,t)}static fromJsonString(e,t){return new We().fromJsonString(e,t)}static equals(e,t){return m.util.equals(We,e,t)}}We.runtime=m;We.typeName="livekit.TrackPublishedResponse";We.fields=m.util.newFieldList(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ve}]);class Mt extends _{constructor(e){super(),this.trackSid="",m.util.initPartial(e,this)}static fromBinary(e,t){return new Mt().fromBinary(e,t)}static fromJson(e,t){return new Mt().fromJson(e,t)}static fromJsonString(e,t){return new Mt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Mt,e,t)}}Mt.runtime=m;Mt.typeName="livekit.TrackUnpublishedResponse";Mt.fields=m.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);class fe extends _{constructor(e){super(),this.type="",this.sdp="",m.util.initPartial(e,this)}static fromBinary(e,t){return new fe().fromBinary(e,t)}static fromJson(e,t){return new fe().fromJson(e,t)}static fromJsonString(e,t){return new fe().fromJsonString(e,t)}static equals(e,t){return m.util.equals(fe,e,t)}}fe.runtime=m;fe.typeName="livekit.SessionDescription";fe.fields=m.util.newFieldList(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]);class _t extends _{constructor(e){super(),this.participants=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new _t().fromBinary(e,t)}static fromJson(e,t){return new _t().fromJson(e,t)}static fromJsonString(e,t){return new _t().fromJsonString(e,t)}static equals(e,t){return m.util.equals(_t,e,t)}}_t.runtime=m;_t.typeName="livekit.ParticipantUpdate";_t.fields=m.util.newFieldList(()=>[{no:1,name:"participants",kind:"message",T:Ce,repeated:!0}]);class De extends _{constructor(e){super(),this.trackSids=[],this.subscribe=!1,this.participantTracks=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new De().fromBinary(e,t)}static fromJson(e,t){return new De().fromJson(e,t)}static fromJsonString(e,t){return new De().fromJsonString(e,t)}static equals(e,t){return m.util.equals(De,e,t)}}De.runtime=m;De.typeName="livekit.UpdateSubscription";De.fields=m.util.newFieldList(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:nt,repeated:!0}]);class at extends _{constructor(e){super(),this.trackSids=[],this.disabled=!1,this.quality=X.LOW,this.width=0,this.height=0,this.fps=0,this.priority=0,m.util.initPartial(e,this)}static fromBinary(e,t){return new at().fromBinary(e,t)}static fromJson(e,t){return new at().fromJson(e,t)}static fromJsonString(e,t){return new at().fromJsonString(e,t)}static equals(e,t){return m.util.equals(at,e,t)}}at.runtime=m;at.typeName="livekit.UpdateTrackSettings";at.fields=m.util.newFieldList(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:m.getEnumType(X)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]);class Ae extends _{constructor(e){super(),this.canReconnect=!1,this.reason=Wt.UNKNOWN_REASON,m.util.initPartial(e,this)}static fromBinary(e,t){return new Ae().fromBinary(e,t)}static fromJson(e,t){return new Ae().fromJson(e,t)}static fromJsonString(e,t){return new Ae().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Ae,e,t)}}Ae.runtime=m;Ae.typeName="livekit.LeaveRequest";Ae.fields=m.util.newFieldList(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:m.getEnumType(Wt)}]);class ot extends _{constructor(e){super(),this.trackSid="",this.layers=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new ot().fromBinary(e,t)}static fromJson(e,t){return new ot().fromJson(e,t)}static fromJsonString(e,t){return new ot().fromJsonString(e,t)}static equals(e,t){return m.util.equals(ot,e,t)}}ot.runtime=m;ot.typeName="livekit.UpdateVideoLayers";ot.fields=m.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:he,repeated:!0}]);class ct extends _{constructor(e){super(),this.metadata="",this.name="",m.util.initPartial(e,this)}static fromBinary(e,t){return new ct().fromBinary(e,t)}static fromJson(e,t){return new ct().fromJson(e,t)}static fromJsonString(e,t){return new ct().fromJsonString(e,t)}static equals(e,t){return m.util.equals(ct,e,t)}}ct.runtime=m;ct.typeName="livekit.UpdateParticipantMetadata";ct.fields=m.util.newFieldList(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}]);class lt extends _{constructor(e){super(),this.urls=[],this.username="",this.credential="",m.util.initPartial(e,this)}static fromBinary(e,t){return new lt().fromBinary(e,t)}static fromJson(e,t){return new lt().fromJson(e,t)}static fromJsonString(e,t){return new lt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(lt,e,t)}}lt.runtime=m;lt.typeName="livekit.ICEServer";lt.fields=m.util.newFieldList(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]);class Dt extends _{constructor(e){super(),this.speakers=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new Dt().fromBinary(e,t)}static fromJson(e,t){return new Dt().fromJson(e,t)}static fromJsonString(e,t){return new Dt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Dt,e,t)}}Dt.runtime=m;Dt.typeName="livekit.SpeakersChanged";Dt.fields=m.util.newFieldList(()=>[{no:1,name:"speakers",kind:"message",T:et,repeated:!0}]);class At extends _{constructor(e){super(),m.util.initPartial(e,this)}static fromBinary(e,t){return new At().fromBinary(e,t)}static fromJson(e,t){return new At().fromJson(e,t)}static fromJsonString(e,t){return new At().fromJsonString(e,t)}static equals(e,t){return m.util.equals(At,e,t)}}At.runtime=m;At.typeName="livekit.RoomUpdate";At.fields=m.util.newFieldList(()=>[{no:1,name:"room",kind:"message",T:An}]);class Ot extends _{constructor(e){super(),this.participantSid="",this.quality=an.POOR,this.score=0,m.util.initPartial(e,this)}static fromBinary(e,t){return new Ot().fromBinary(e,t)}static fromJson(e,t){return new Ot().fromJson(e,t)}static fromJsonString(e,t){return new Ot().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Ot,e,t)}}Ot.runtime=m;Ot.typeName="livekit.ConnectionQualityInfo";Ot.fields=m.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:m.getEnumType(an)},{no:3,name:"score",kind:"scalar",T:2}]);class Lt extends _{constructor(e){super(),this.updates=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new Lt().fromBinary(e,t)}static fromJson(e,t){return new Lt().fromJson(e,t)}static fromJsonString(e,t){return new Lt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Lt,e,t)}}Lt.runtime=m;Lt.typeName="livekit.ConnectionQualityUpdate";Lt.fields=m.util.newFieldList(()=>[{no:1,name:"updates",kind:"message",T:Ot,repeated:!0}]);class Ut extends _{constructor(e){super(),this.participantSid="",this.trackSid="",this.state=yn.ACTIVE,m.util.initPartial(e,this)}static fromBinary(e,t){return new Ut().fromBinary(e,t)}static fromJson(e,t){return new Ut().fromJson(e,t)}static fromJsonString(e,t){return new Ut().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Ut,e,t)}}Ut.runtime=m;Ut.typeName="livekit.StreamStateInfo";Ut.fields=m.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:m.getEnumType(yn)}]);class jt extends _{constructor(e){super(),this.streamStates=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new jt().fromBinary(e,t)}static fromJson(e,t){return new jt().fromJson(e,t)}static fromJsonString(e,t){return new jt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(jt,e,t)}}jt.runtime=m;jt.typeName="livekit.StreamStateUpdate";jt.fields=m.util.newFieldList(()=>[{no:1,name:"stream_states",kind:"message",T:Ut,repeated:!0}]);class He extends _{constructor(e){super(),this.quality=X.LOW,this.enabled=!1,m.util.initPartial(e,this)}static fromBinary(e,t){return new He().fromBinary(e,t)}static fromJson(e,t){return new He().fromJson(e,t)}static fromJsonString(e,t){return new He().fromJsonString(e,t)}static equals(e,t){return m.util.equals(He,e,t)}}He.runtime=m;He.typeName="livekit.SubscribedQuality";He.fields=m.util.newFieldList(()=>[{no:1,name:"quality",kind:"enum",T:m.getEnumType(X)},{no:2,name:"enabled",kind:"scalar",T:8}]);class Ft extends _{constructor(e){super(),this.codec="",this.qualities=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new Ft().fromBinary(e,t)}static fromJson(e,t){return new Ft().fromJson(e,t)}static fromJsonString(e,t){return new Ft().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Ft,e,t)}}Ft.runtime=m;Ft.typeName="livekit.SubscribedCodec";Ft.fields=m.util.newFieldList(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:He,repeated:!0}]);class Bt extends _{constructor(e){super(),this.trackSid="",this.subscribedQualities=[],this.subscribedCodecs=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new Bt().fromBinary(e,t)}static fromJson(e,t){return new Bt().fromJson(e,t)}static fromJsonString(e,t){return new Bt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Bt,e,t)}}Bt.runtime=m;Bt.typeName="livekit.SubscribedQualityUpdate";Bt.fields=m.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:He,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Ft,repeated:!0}]);class ut extends _{constructor(e){super(),this.participantSid="",this.allTracks=!1,this.trackSids=[],this.participantIdentity="",m.util.initPartial(e,this)}static fromBinary(e,t){return new ut().fromBinary(e,t)}static fromJson(e,t){return new ut().fromJson(e,t)}static fromJsonString(e,t){return new ut().fromJsonString(e,t)}static equals(e,t){return m.util.equals(ut,e,t)}}ut.runtime=m;ut.typeName="livekit.TrackPermission";ut.fields=m.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]);class dt extends _{constructor(e){super(),this.allParticipants=!1,this.trackPermissions=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new dt().fromBinary(e,t)}static fromJson(e,t){return new dt().fromJson(e,t)}static fromJsonString(e,t){return new dt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(dt,e,t)}}dt.runtime=m;dt.typeName="livekit.SubscriptionPermission";dt.fields=m.util.newFieldList(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:ut,repeated:!0}]);class Jt extends _{constructor(e){super(),this.participantSid="",this.trackSid="",this.allowed=!1,m.util.initPartial(e,this)}static fromBinary(e,t){return new Jt().fromBinary(e,t)}static fromJson(e,t){return new Jt().fromJson(e,t)}static fromJsonString(e,t){return new Jt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Jt,e,t)}}Jt.runtime=m;Jt.typeName="livekit.SubscriptionPermissionUpdate";Jt.fields=m.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]);class ht extends _{constructor(e){super(),this.publishTracks=[],this.dataChannels=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new ht().fromBinary(e,t)}static fromJson(e,t){return new ht().fromJson(e,t)}static fromJsonString(e,t){return new ht().fromJsonString(e,t)}static equals(e,t){return m.util.equals(ht,e,t)}}ht.runtime=m;ht.typeName="livekit.SyncState";ht.fields=m.util.newFieldList(()=>[{no:1,name:"answer",kind:"message",T:fe},{no:2,name:"subscription",kind:"message",T:De},{no:3,name:"publish_tracks",kind:"message",T:We,repeated:!0},{no:4,name:"data_channels",kind:"message",T:ft,repeated:!0},{no:5,name:"offer",kind:"message",T:fe}]);class ft extends _{constructor(e){super(),this.label="",this.id=0,this.target=be.PUBLISHER,m.util.initPartial(e,this)}static fromBinary(e,t){return new ft().fromBinary(e,t)}static fromJson(e,t){return new ft().fromJson(e,t)}static fromJsonString(e,t){return new ft().fromJsonString(e,t)}static equals(e,t){return m.util.equals(ft,e,t)}}ft.runtime=m;ft.typeName="livekit.DataChannelInfo";ft.fields=m.util.newFieldList(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:m.getEnumType(be)}]);class le extends _{constructor(e){super(),this.scenario={case:void 0},m.util.initPartial(e,this)}static fromBinary(e,t){return new le().fromBinary(e,t)}static fromJson(e,t){return new le().fromJson(e,t)}static fromJsonString(e,t){return new le().fromJsonString(e,t)}static equals(e,t){return m.util.equals(le,e,t)}}le.runtime=m;le.typeName="livekit.SimulateScenario";le.fields=m.util.newFieldList(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:m.getEnumType(Ei),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"}]);class pt extends _{constructor(e){super(),this.timestamp=j.zero,this.rtt=j.zero,m.util.initPartial(e,this)}static fromBinary(e,t){return new pt().fromBinary(e,t)}static fromJson(e,t){return new pt().fromJson(e,t)}static fromJsonString(e,t){return new pt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(pt,e,t)}}pt.runtime=m;pt.typeName="livekit.Ping";pt.fields=m.util.newFieldList(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]);class Vt extends _{constructor(e){super(),this.lastPingTimestamp=j.zero,this.timestamp=j.zero,m.util.initPartial(e,this)}static fromBinary(e,t){return new Vt().fromBinary(e,t)}static fromJson(e,t){return new Vt().fromJson(e,t)}static fromJsonString(e,t){return new Vt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(Vt,e,t)}}Vt.runtime=m;Vt.typeName="livekit.Pong";Vt.fields=m.util.newFieldList(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]);class rn extends _{constructor(e){super(),this.regions=[],m.util.initPartial(e,this)}static fromBinary(e,t){return new rn().fromBinary(e,t)}static fromJson(e,t){return new rn().fromJson(e,t)}static fromJsonString(e,t){return new rn().fromJsonString(e,t)}static equals(e,t){return m.util.equals(rn,e,t)}}rn.runtime=m;rn.typeName="livekit.RegionSettings";rn.fields=m.util.newFieldList(()=>[{no:1,name:"regions",kind:"message",T:qt,repeated:!0}]);class qt extends _{constructor(e){super(),this.region="",this.url="",this.distance=j.zero,m.util.initPartial(e,this)}static fromBinary(e,t){return new qt().fromBinary(e,t)}static fromJson(e,t){return new qt().fromJson(e,t)}static fromJsonString(e,t){return new qt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(qt,e,t)}}qt.runtime=m;qt.typeName="livekit.RegionInfo";qt.fields=m.util.newFieldList(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]);class zt extends _{constructor(e){super(),this.trackSid="",this.err=Yn.SE_UNKNOWN,m.util.initPartial(e,this)}static fromBinary(e,t){return new zt().fromBinary(e,t)}static fromJson(e,t){return new zt().fromJson(e,t)}static fromJsonString(e,t){return new zt().fromJsonString(e,t)}static equals(e,t){return m.util.equals(zt,e,t)}}zt.runtime=m;zt.typeName="livekit.SubscriptionResponse";zt.fields=m.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:m.getEnumType(Yn)}]);class On extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}class G extends On{constructor(e,t,i){super(1,e),this.status=i,this.reason=t}}class Xr extends On{constructor(e){super(21,e??"device is unsupported")}}class Ze extends On{constructor(e){super(20,e??"track is invalid")}}class Od extends On{constructor(e){super(10,e??"unsupported server")}}class re extends On{constructor(e){super(12,e??"unexpected connection state")}}class Pr extends On{constructor(e){super(13,e??"unable to negotiate")}}var Zn;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(Zn||(Zn={}));(function(n){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?n.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?n.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(Zn||(Zn={}));class oe{}oe.setTimeout=function(){return setTimeout(...arguments)};oe.setInterval=function(){return setInterval(...arguments)};oe.clearTimeout=function(){return clearTimeout(...arguments)};oe.clearInterval=function(){return clearInterval(...arguments)};const Ld=/version\/(\d+(\.?_?\d+)+)/i;let Yi;function Ln(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof n>"u"&&typeof navigator>"u")return;const t=(n??navigator.userAgent).toLowerCase();if(Yi===void 0||e){const i=Ud.find(r=>{let{test:s}=r;return s.test(t)});Yi=i==null?void 0:i.describe(t)}return Yi}const Ud=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:Zi(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:Zi(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:Zi(Ld,n),os:n.includes("mobile/")?"iOS":"macOS"}}}];function Zi(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(n);return i&&i.length>=t&&i[t]||""}var jd="1.13.3";const Fd=jd,Bd=9;class W{constructor(e,t,i,r,s){this.width=e,this.height=t,this.encoding={maxBitrate:i,maxFramerate:r,priority:s}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}const Jd=["vp8","h264"],Ko=["vp8","h264","vp9","av1"];function Vd(n){return!!Jd.find(e=>e===n)}function Ls(n,e){return(n==null?void 0:n.toLowerCase().replace(/audio\/|video\//y,""))===(e==null?void 0:e.toLowerCase().replace(/audio\/|video\//y,""))}var xi;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:2e4},n.music={maxBitrate:32e3},n.musicStereo={maxBitrate:48e3},n.musicHighQuality={maxBitrate:64e3},n.musicHighQualityStereo={maxBitrate:96e3}})(xi||(xi={}));const Xn={h90:new W(160,90,9e4,20),h180:new W(320,180,16e4,20),h216:new W(384,216,18e4,20),h360:new W(640,360,45e4,20),h540:new W(960,540,8e5,25),h720:new W(1280,720,17e5,30),h1080:new W(1920,1080,3e6,30),h1440:new W(2560,1440,5e6,30),h2160:new W(3840,2160,8e6,30)},Rr={h120:new W(160,120,7e4,20),h180:new W(240,180,125e3,20),h240:new W(320,240,14e4,20),h360:new W(480,360,33e4,20),h480:new W(640,480,5e5,20),h540:new W(720,540,6e5,25),h720:new W(960,720,13e5,30),h1080:new W(1440,1080,23e5,30),h1440:new W(1920,1440,38e5,30)},es={h360fps3:new W(640,360,2e5,3,"medium"),h720fps5:new W(1280,720,4e5,5,"medium"),h720fps15:new W(1280,720,15e5,15,"medium"),h720fps30:new W(1280,720,2e6,30,"medium"),h1080fps15:new W(1920,1080,25e5,15,"medium"),h1080fps30:new W(1920,1080,4e6,30,"medium")};var x;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.StateChanged="connectionStateChanged",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged"})(x||(x={}));var R;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded"})(R||(R={}));var A;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate"})(A||(A={}));var M;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed"})(M||(M={}));const qd=5e3,Jn=[];class w extends vt.EventEmitter{constructor(e,t){super(),this.attachedElements=[],this.isMuted=!1,this.streamState=w.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),qd):this.handleAppVisibilityChanged()},this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=w.Source.Unknown}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===w.Kind.Video&&(t="video"),this.attachedElements.length===0&&w.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(Jn.forEach(r=>{r.parentElement===null&&!e&&(e=r)}),e&&Jn.splice(Jn.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),wn(this.mediaStreamTrack,e);const i=e.srcObject.getTracks();return i.some(r=>r.kind==="audio")&&e.play().then(()=>{this.emit(M.AudioPlaybackStarted)}).catch(r=>{r.name==="NotAllowedError"?this.emit(M.AudioPlaybackFailed,r):y.warn("could not playback audio",r),e&&i.some(s=>s.kind==="video")&&r.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(M.ElementAttached,e),e}detach(e){try{if(e){Pn(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(M.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(i=>{Pn(this.mediaStreamTrack,i),t.push(i),this.recycleElement(i),this.emit(M.ElementDetached,i)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Jn.forEach(i=>{i.parentElement||(t=!1)}),t&&Jn.push(e)}}handleAppVisibilityChanged(){return T(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden"})}addAppVisibilityListener(){ye()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ye()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function wn(n,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let i;n.kind==="audio"?i=t.getAudioTracks():i=t.getVideoTracks(),i.includes(n)||(i.forEach(r=>{t.removeTrack(r)}),t.addTrack(n)),e.autoplay=!0,e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(Bi()||ei())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function Pn(n,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(n),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(n){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let t;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(t=n.Source||(n.Source={}));let i;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(i=n.StreamState||(n.StreamState={}));function r(c){switch(c){case e.Audio:return ae.AUDIO;case e.Video:return ae.VIDEO;default:return ae.DATA}}n.kindToProto=r;function s(c){switch(c){case ae.AUDIO:return e.Audio;case ae.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=s;function a(c){switch(c){case t.Camera:return $.CAMERA;case t.Microphone:return $.MICROPHONE;case t.ScreenShare:return $.SCREEN_SHARE;case t.ScreenShareAudio:return $.SCREEN_SHARE_AUDIO;default:return $.UNKNOWN}}n.sourceToProto=a;function o(c){switch(c){case $.CAMERA:return t.Camera;case $.MICROPHONE:return t.Microphone;case $.SCREEN_SHARE:return t.ScreenShare;case $.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}n.sourceFromProto=o;function l(c){switch(c){case yn.ACTIVE:return i.Active;case yn.PAUSED:return i.Paused;default:return i.Unknown}}n.streamStateFromProto=l})(w||(w={}));function $o(n,e,t){const i=Object.assign({},n);return i.audio===!0&&(i.audio={}),i.video===!0&&(i.video={}),i.audio&&Nr(i.audio,e),i.video&&Nr(i.video,t),i}function Nr(n,e){return Object.keys(e).forEach(t=>{n[t]===void 0&&(n[t]=e[t])}),n}function Fi(n){const e={};if(n.video)if(typeof n.video=="object"){const t={},i=t,r=n.video;Object.keys(r).forEach(s=>{switch(s){case"resolution":Nr(i,r.resolution);break;default:i[s]=r[s]}}),e.video=t}else e.video=n.video;else e.video=!1;return n.audio?typeof n.audio=="object"?e.audio=n.audio:e.audio=!0:e.audio=!1,e}function zd(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return T(this,void 0,void 0,function*(){const t=Qo();if(t){const i=t.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,s=new Uint8Array(r);t.createMediaStreamSource(new MediaStream([n.mediaStreamTrack])).connect(i),yield mn(e),i.getByteTimeDomainData(s);const o=s.some(l=>l!==128&&l!==0);return t.close(),!o}return!1})}function Qo(){const n=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(n)return new n({latencyHint:"interactive"})}function Wd(n){return n===w.Source.Microphone?"audioinput":n===w.Source.Camera?"videoinput":void 0}function Hd(n){var e,t;let i=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&(i=typeof i=="boolean"?{}:i,Bi()?i=Object.assign(Object.assign({},i),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(t=n.audio)!==null&&t!==void 0?t:!1,video:i,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio}}const Gd="|",Us="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Kd(n){const e=n.split(Gd);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function mn(n){return T(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,n))})}function js(){return"addTransceiver"in RTCPeerConnection.prototype}function Fs(){return"addTrack"in RTCPeerConnection.prototype}function $d(){if(!("getCapabilities"in RTCRtpSender))return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType==="video/AV1"){e=!0;break}}return e}function Qd(){if(!("getCapabilities"in RTCRtpSender))return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const t of n.codecs)if(t.mimeType==="video/VP9"){e=!0;break}}return e}function Kn(n){return n==="av1"||n==="vp9"}function Ir(n){return document?(n||(n=document.createElement("audio")),"setSinkId"in n):!1}const Yd={Chrome:"100",Safari:"15",Firefox:"100"};function Zd(n){if(!ye()||!("setCodecPreferences"in n))return!1;const e=Ln();if(!(e!=null&&e.name)||!e.version)return!1;const t=Yd[e.name];return t?ec(e.version,t)>=0:!1}function ei(){var n;return((n=Ln())===null||n===void 0?void 0:n.name)==="Firefox"}function Xd(){var n;return((n=Ln())===null||n===void 0?void 0:n.name)==="Chrome"}function Bi(){var n;return((n=Ln())===null||n===void 0?void 0:n.name)==="Safari"}function Yo(){return ye()?/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function ye(){return typeof document<"u"}function kn(){return navigator.product=="ReactNative"}function Mr(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function Zo(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Xo(){if(!kn())return;let n=Zo();if(n)return n.platform}function Bs(){if(ye())return window.devicePixelRatio;if(kn()){let n=Zo();if(n)return n.devicePixelRatio}return 1}function ec(n,e){const t=n.split("."),i=e.split("."),r=Math.min(t.length,i.length);for(let s=0;s<r;++s){const a=parseInt(t[s],10),o=parseInt(i[s],10);if(a>o)return 1;if(a<o)return-1;if(s===r-1&&a===o)return 0}return n===""&&e!==""?-1:e===""?1:t.length==i.length?0:t.length<i.length?-1:1}function eh(n){for(const e of n)e.target.handleResize(e)}function th(n){for(const e of n)e.target.handleVisibilityChanged(e)}let Xi=null;const Js=()=>(Xi||(Xi=new ResizeObserver(eh)),Xi);let er=null;const Vs=()=>(er||(er=new IntersectionObserver(th,{root:null,rootMargin:"0px"})),er);function nh(){var n;const e=new xt({sdk:_n.JS,protocol:Bd,version:Fd});return kn()&&(e.os=(n=Xo())!==null&&n!==void 0?n:""),e}function qs(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=n,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(n/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const a=r.captureStream(),[o]=a.getTracks();if(!o)throw Error("Could not get empty media stream video track");return o.enabled=t,o}let Vn;function tr(){if(!Vn){const n=new AudioContext,e=n.createOscillator(),t=n.createGain();t.gain.setValueAtTime(0,0);const i=n.createMediaStreamDestination();if(e.connect(t),t.connect(i),e.start(),[Vn]=i.stream.getAudioTracks(),!Vn)throw Error("Could not get empty media stream audio track");Vn.enabled=!1}return Vn.clone()}class tc{constructor(e,t){this.onFinally=t,this.promise=new Promise((i,r)=>T(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;return(i=this.onFinally)===null||i===void 0?void 0:i.call(this)})}}class Ht{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),i}}function ih(n){return Ko.includes(n)}function gn(n){if(typeof n=="string")return n;if(Array.isArray(n))return n[0];if(n.exact)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function rh(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function zs(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}var $n;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})($n||($n={}));class sh{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ht,this.nextTaskIndex=0}run(e){return T(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:$n.WAITING};this.pendingTasks.set(t.id,t);const i=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=$n.RUNNING,yield e()}finally{t.status=$n.COMPLETED,this.pendingTasks.delete(t.id),i()}})}flush(){return T(this,void 0,void 0,function*(){return this.run(()=>T(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const ah=["syncState","trickle","offer","answer","simulate","leave"];function oh(n){const e=ah.indexOf(n.case)>=0;return y.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}class ts{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.rtt=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.isConnected=!1,this.isReconnecting=!1,this.useJSON=e,this.requestQueue=new sh,this.queuedRequests=[],this.closingLock=new Ht}join(e,t,i,r){return T(this,void 0,void 0,function*(){return this.isConnected=!1,this.options=i,yield this.connect(e,t,i,r)})}reconnect(e,t,i,r){return T(this,void 0,void 0,function*(){if(!this.options){y.warn("attempted to reconnect without signal options being set, ignoring");return}return this.isReconnecting=!0,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,t,i,r){this.connectOptions=i,e=rh(e),e=e.replace(/\/$/,""),e+="/rtc";const s=nh(),a=ch(t,s,i);return new Promise((o,l)=>T(this,void 0,void 0,function*(){const c=()=>T(this,void 0,void 0,function*(){this.close(),clearTimeout(u),l(new G("room connection has been cancelled (signal)"))}),u=setTimeout(()=>{this.close(),l(new G("room connection has timed out (signal)"))},i.websocketTimeout);r!=null&&r.aborted&&c(),r==null||r.addEventListener("abort",c),y.debug("connecting to ".concat(e+a)),this.ws&&(yield this.close()),this.ws=new WebSocket(e+a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(u)},this.ws.onerror=h=>T(this,void 0,void 0,function*(){if(!this.isConnected){clearTimeout(u);try{const p=yield fetch("http".concat(e.substring(2),"/validate").concat(a));if(p.status.toFixed(0).startsWith("4")){const v=yield p.text();l(new G(v,0,p.status))}else l(new G("Internal error",2,p.status))}catch{l(new G("server was not reachable",1))}return}this.handleWSError(h)}),this.ws.onmessage=h=>T(this,void 0,void 0,function*(){var p,v,b,g;let S;if(typeof h.data=="string"){const k=JSON.parse(h.data);S=st.fromJson(k)}else if(h.data instanceof ArrayBuffer)S=st.fromBinary(new Uint8Array(h.data));else{y.error("could not decode websocket message: ".concat(typeof h.data));return}if(!this.isConnected){let k=!1;if(((p=S.message)===null||p===void 0?void 0:p.case)==="join"?(this.isConnected=!0,r==null||r.removeEventListener("abort",c),this.pingTimeoutDuration=S.message.value.pingTimeout,this.pingIntervalDuration=S.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(y.debug("ping config",{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration}),this.startPingInterval()),o(S.message.value)):i.reconnect?(this.isConnected=!0,r==null||r.removeEventListener("abort",c),this.startPingInterval(),((v=S.message)===null||v===void 0?void 0:v.case)==="reconnect"?o((b=S.message)===null||b===void 0?void 0:b.value):(o(),k=!0)):i.reconnect||l(new G("did not receive join response, got ".concat((g=S.message)===null||g===void 0?void 0:g.case," instead"))),!k)return}this.signalLatency&&(yield mn(this.signalLatency)),this.handleSignalResponse(S)}),this.ws.onclose=h=>{y.warn("websocket closed",{ev:h}),this.handleOnClose(h.reason)}}))}close(){return T(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();try{if(this.isConnected=!1,this.ws){this.ws.onmessage=null,this.ws.onopen=null,this.ws.onclose=null;const t=new Promise(i=>{this.ws?this.ws.onclose=()=>{i()}:i()});this.ws.readyState<this.ws.CLOSING&&(this.ws.close(),yield Promise.race([t,mn(250)])),this.ws=void 0}}finally{this.clearPingInterval(),e()}})}sendOffer(e){y.debug("sending offer",e),this.sendRequest({case:"offer",value:Pi(e)})}sendAnswer(e){return y.debug("sending answer"),this.sendRequest({case:"answer",value:Pi(e)})}sendIceCandidate(e,t){return y.trace("sending ice candidate",e),this.sendRequest({case:"trickle",value:new qe({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new ze({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return this.sendRequest({case:"updateMetadata",value:new ct({metadata:e,name:t})})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new ot({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new dt({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:j.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new pt({timestamp:j.parse(Date.now()),rtt:j.parse(this.rtt)})})])}sendLeave(){return this.sendRequest({case:"leave",value:new Ae({canReconnect:!1,reason:Wt.CLIENT_INITIATED})})}sendRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return T(this,void 0,void 0,function*(){if(!t&&!oh(e)&&this.isReconnecting){this.queuedRequests.push(()=>T(this,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));return}if(t||(yield this.requestQueue.flush()),this.signalLatency&&(yield mn(this.signalLatency)),!this.ws||this.ws.readyState!==this.ws.OPEN){y.error("cannot send signal request before connected, type: ".concat(e==null?void 0:e.case));return}const r=new Rt({message:e});try{this.useJSON?this.ws.send(r.toJsonString()):this.ws.send(r.toBinary())}catch(s){y.error("error sending signal message",{error:s})}})}handleSignalResponse(e){var t,i;const r=e.message;if(r==null){y.debug("received unsupported message");return}if(r.case==="answer"){const s=Ws(r.value);this.onAnswer&&this.onAnswer(s)}else if(r.case==="offer"){const s=Ws(r.value);this.onOffer&&this.onOffer(s)}else if(r.case==="trickle"){const s=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(s,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=r.value.participants)!==null&&t!==void 0?t:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"?this.resetPingTimeout():r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout()):y.debug("unsupported message",r)}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}this.isReconnecting=!1}handleOnClose(e){return T(this,void 0,void 0,function*(){if(!this.isConnected)return;const t=this.onClose;yield this.close(),y.debug("websocket connection closed: ".concat(e)),t&&t(e)})}handleWSError(e){y.error("websocket error",e)}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){y.warn("ping timeout duration not set");return}this.pingTimeout=oe.setTimeout(()=>{y.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString())),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&oe.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){y.warn("ping interval duration not set");return}y.debug("start ping interval"),this.pingInterval=oe.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){y.debug("clearing ping interval"),this.clearPingTimeout(),this.pingInterval&&oe.clearInterval(this.pingInterval)}}function Ws(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function Pi(n){return new fe({sdp:n.sdp,type:n.type})}function ch(n,e,t){var i;const r=new URLSearchParams;return r.set("access_token",n),t.reconnect&&(r.set("reconnect","1"),t.sid&&r.set("sid",t.sid)),r.set("auto_subscribe",t.autoSubscribe?"1":"0"),r.set("sdk",kn()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),t.publishOnly!==void 0&&r.set("publish",t.publishOnly),t.adaptiveStream&&r.set("adaptive_stream","1"),t.reconnectReason&&r.set("reconnect_reason",t.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),"?".concat(r.toString())}const lh=10,li="lk_e2ee",uh="LKFrameEncryptionKey",dh={sharedKey:!1,ratchetSalt:uh,ratchetWindowSize:8,failureTolerance:lh};var on;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(on||(on={}));var Hs;(function(n){n.KeyRatcheted="keyRatcheted"})(Hs||(Hs={}));var sn;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(sn||(sn={}));var Gs;(function(n){n.Error="cryptorError"})(Gs||(Gs={}));function hh(){return fh()||_r()}function _r(){return typeof window.RTCRtpScriptTransform<"u"}function fh(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function ph(n){const e=n.split("/")[1].toLowerCase();if(!Ko.includes(e))throw Error("Video codec not supported: ".concat(e));return e}class Sv extends vt.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,i)=>{y.debug("key ratcheted event received",{material:t,keyIndex:i})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},dh),e),this.on(on.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,i){const r={key:e,participantIdentity:t,keyIndex:i};this.keyInfoMap.set("".concat(t??"shared","-").concat(i??0),r),this.emit(on.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(on.RatchetRequest,e,t)}}function ns(n,e,t){var i,r,s;e===void 0&&(e=50),t===void 0&&(t={});var a=(i=t.isImmediate)!=null&&i,o=(r=t.callback)!=null&&r,l=t.maxWait,c=Date.now(),u=[];function h(){if(l!==void 0){var v=Date.now()-c;if(v+e>=l)return l-v}return e}var p=function(){var v=[].slice.call(arguments),b=this;return new Promise(function(g,S){var k=a&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,c=Date.now(),!a){var I=n.apply(b,v);o&&o(I),u.forEach(function(E){return(0,E.resolve)(I)}),u=[]}},h()),k){var C=n.apply(b,v);return o&&o(C),g(C)}u.push({resolve:g,reject:S})})};return p.cancel=function(v){s!==void 0&&clearTimeout(s),u.forEach(function(b){return(0,b.reject)(v)}),u=[]},p}const Ks="default";class ue{static getInstance(){return this.instance===void 0&&(this.instance=new ue),this.instance}getDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var i;return T(this,void 0,void 0,function*(){if(((i=ue.userMediaPromiseMap)===null||i===void 0?void 0:i.size)>0){y.debug("awaiting getUserMedia promise");try{e?yield ue.userMediaPromiseMap.get(e):yield Promise.all(ue.userMediaPromiseMap.values())}catch{y.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(t&&!(Bi()&&this.hasDeviceInUse(e))&&(r.length===0||r.some(a=>{const o=a.label==="",l=e?a.kind===e:!0;return o&&l}))){const a={video:e!=="audioinput"&&e!=="audiooutput",audio:e!=="videoinput"},o=yield navigator.mediaDevices.getUserMedia(a);r=yield navigator.mediaDevices.enumerateDevices(),o.getTracks().forEach(l=>{l.stop()})}return e&&(r=r.filter(s=>s.kind===e)),r})}normalizeDeviceId(e,t,i){return T(this,void 0,void 0,function*(){if(t!==Ks)return t;const s=(yield this.getDevices(e)).find(a=>a.groupId===i&&a.deviceId!==Ks);return s==null?void 0:s.deviceId})}hasDeviceInUse(e){return e?ue.userMediaPromiseMap.has(e):ue.userMediaPromiseMap.size>0}}ue.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];ue.userMediaPromiseMap=new Map;const mh=1e3;class Dn extends w{get constraints(){return this._constraints}constructor(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;super(e,t),this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>y.debug("track mute bounce got cancelled by an unmute event")),this.debouncedTrackMuteHandler=ns(()=>T(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>T(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(M.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ht,this.pauseUpstreamLock=new Ht,this.processorLock=new Ht,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==w.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}setMediaStreamTrack(e,t){return T(this,void 0,void 0,function*(){if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(r=>{Pn(this._mediaStreamTrack,r)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop()),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let i;if(this.processor&&e&&this.processorElement){if(y.debug("restarting processor"),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");wn(e,this.processorElement),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}this.sender&&(yield this.sender.replaceTrack(i??e)),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(r=>{wn(i??e,r)}))})}waitForDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mh;return T(this,void 0,void 0,function*(){if(this.kind===w.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");const t=Date.now();for(;Date.now()-t<e;){const i=this.dimensions;if(i)return i;yield mn(50)}throw new Ze("unable to get track dimensions after timeout")})}getDeviceId(){return T(this,void 0,void 0,function*(){if(this.source===w.Source.ScreenShare)return;const{deviceId:e,groupId:t}=this._mediaStreamTrack.getSettings(),i=this.kind===w.Kind.Audio?"audioinput":"videoinput";return ue.getInstance().normalizeDeviceId(i,e,t)})}mute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return T(this,void 0,void 0,function*(){if(!this.sender)throw new Ze("unable to replace an unpublished track");return y.debug("replace MediaStreamTrack"),yield this.setMediaStreamTrack(e),this.providedByUser=t,this.processor&&(yield this.stopProcessor()),this})}restart(e){return T(this,void 0,void 0,function*(){e||(e=this._constraints),y.debug("restarting track with constraints",e);const t={audio:!1,video:!1};this.kind===w.Kind.Video?t.video=e:t.audio=e,this.attachedElements.forEach(s=>{Pn(this.mediaStreamTrack,s)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const r=(yield navigator.mediaDevices.getUserMedia(t)).getTracks()[0];return r.addEventListener("ended",this.handleEnded),y.debug("re-acquired MediaStreamTrack"),yield this.setMediaStreamTrack(r),this._constraints=e,this.emit(M.Restarted,this),this})}setTrackMuted(e){y.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted")),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?M.Muted:M.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Yo()&&(y.debug("visibility changed, is in Background: ".concat(this.isInBackground)),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(y.debug("track needs to be reacquired, restarting ".concat(this.source)),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return T(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){y.warn("unable to pause upstream for an unpublished track");return}this._isUpstreamPaused=!0,this.emit(M.UpstreamPaused,this);const t=Ln();if((t==null?void 0:t.name)==="Safari"&&ec(t.version,"12.0")<0)throw new Xr("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{e()}})}resumeUpstream(){return T(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){y.warn("unable to resume upstream for an unpublished track");return}this._isUpstreamPaused=!1,this.emit(M.UpstreamResumed,this),yield this.sender.replaceTrack(this._mediaStreamTrack)}finally{e()}})}setProcessor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var i,r;return T(this,void 0,void 0,function*(){const s=yield this.processorLock.lock();try{if(y.debug("setting up processor"),this.processor&&(yield this.stopProcessor()),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement=(i=this.processorElement)!==null&&i!==void 0?i:document.createElement(this.kind),this.processorElement.muted=!0,wn(this._mediaStreamTrack,this.processorElement),this.processorElement.play().catch(o=>y.error("failed to play processor element",{error:o}));const a={kind:this.kind,track:this._mediaStreamTrack,element:this.processorElement};if(yield e.init(a),this.processor=e,this.processor.processedTrack){for(const o of this.attachedElements)o!==this.processorElement&&t&&(Pn(this._mediaStreamTrack,o),wn(this.processor.processedTrack,o));yield(r=this.sender)===null||r===void 0?void 0:r.replaceTrack(this.processor.processedTrack)}}finally{s()}})}getProcessor(){return this.processor}stopProcessor(){var e,t;return T(this,void 0,void 0,function*(){this.processor&&(y.debug("stopping processor"),(e=this.processor.processedTrack)===null||e===void 0||e.stop(),yield this.processor.destroy(),this.processor=void 0,(t=this.processorElement)===null||t===void 0||t.remove(),this.processorElement=void 0,yield this.restart())})}}class gh extends vt.EventEmitter{constructor(e){super(),this.onWorkerMessage=t=>{var i,r;const{kind:s,data:a}=t.data;switch(s){case"error":y.error(a.error.message),this.emit(sn.EncryptionError,a.error);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(o=>{this.postKey(o)});break;case"enable":if(this.encryptionEnabled!==a.enabled&&a.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(sn.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const o=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(a.participantIdentity);if(!o)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(sn.ParticipantEncryptionStatusChanged,a.enabled,o)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach(o=>{this.postKey(o)});break;case"ratchetKey":this.keyProvider.emit(on.KeyRatcheted,a.material,a.keyIndex);break}},this.onWorkerError=t=>{y.error("e2ee worker encountered an error:",{error:t.error}),this.emit(sn.EncryptionError,t.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!hh())throw new Xr("tried to setup end-to-end encryption on an unsupported browser");if(y.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions()}};this.worker&&(y.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){y.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?y.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(A.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on(x.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==de.NONE,r.identity)),e.on(x.ConnectionStateChanged,i=>{i===F.Connected&&e.participants.forEach(r=>{r.tracks.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==de.NONE,r.identity)})})}).on(x.TrackUnsubscribed,(i,r,s)=>{var a;const o={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(o)}).on(x.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(x.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),t.getKeys().forEach(i=>{this.postKey(i)})}),e.localParticipant.on(R.LocalTrackPublished,i=>T(this,void 0,void 0,function*(){this.setupE2EESender(i.track,i.track.sender)})),t.on(on.SetKey,i=>this.postKey(i)).on(on.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(i)}postKey(e){let{key:t,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:t,keyIndex:r}};this.worker.postMessage(a)}postEnable(e,t){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?ph(i.mimeType):void 0)}}setupE2EESender(e,t){if(!(e instanceof Dn)||!t){t||y.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,i,r){return T(this,void 0,void 0,function*(){if(this.worker){if(_r()){const s={kind:"decode",participantIdentity:i,trackId:t,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(li in e&&r){const l={kind:"updateCodec",data:{trackId:t,codec:r,participantIdentity:i}};this.worker.postMessage(l);return}let s=e.writableStream,a=e.readableStream;if(!s||!a){const l=e.createEncodedStreams();e.writableStream=l.writable,s=l.writable,e.readableStream=l.readable,a=l.readable}const o={kind:"decode",data:{readableStream:a,writableStream:s,trackId:t,codec:r,participantIdentity:i}};this.worker.postMessage(o,[a,s])}e[li]=!0}})}handleSender(e,t,i){var r;if(!(li in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(_r()){y.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{y.info("initialize encoded streams");const s=e.createEncodedStreams(),a={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a,[s.readable,s.writable])}e[li]=!0}}}var nc={},ic={exports:{}},$s=ic.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(n){return n.encoding?"rtpmap:%d %s/%s/%s":n.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(n){return n.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(n){return n.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(n){return"extmap:%d"+(n.direction?"/%s":"%v")+(n["encrypt-uri"]?" %s":"%v")+" %s"+(n.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(n){return n.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(n){var e="candidate:%s %d %s %d %s %d typ %s";return e+=n.raddr!=null?" raddr %s rport %d":"%v%v",e+=n.tcptype!=null?" tcptype %s":"%v",n.generation!=null&&(e+=" generation %d"),e+=n["network-id"]!=null?" network-id %d":"%v",e+=n["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(n){var e="ssrc:%d";return n.attribute!=null&&(e+=" %s",n.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(n){return n.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(n){return n.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(n){return"imageattr:%s %s %s"+(n.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(n){return"simulcast:%s %s"+(n.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(n){return"ts-refclk:%s"+(n.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(n){var e="mediaclk:";return e+=n.id!=null?"id=%s %s":"%v%s",e+=n.mediaClockValue!=null?"=%s":"",e+=n.rateNumerator!=null?" rate=%s":"",e+=n.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys($s).forEach(function(n){var e=$s[n];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})});var rc=ic.exports;(function(n){var e=function(o){return String(Number(o))===o?Number(o):o},t=function(o,l,c,u){if(u&&!c)l[u]=e(o[1]);else for(var h=0;h<c.length;h+=1)o[h+1]!=null&&(l[c[h]]=e(o[h+1]))},i=function(o,l,c){var u=o.name&&o.names;o.push&&!l[o.push]?l[o.push]=[]:u&&!l[o.name]&&(l[o.name]={});var h=o.push?{}:u?l[o.name]:l;t(c.match(o.reg),h,o.names,o.name),o.push&&l[o.push].push(h)},r=rc,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(o){var l={},c=[],u=l;return o.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var p=h[0],v=h.slice(2);p==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var b=0;b<(r[p]||[]).length;b+=1){var g=r[p][b];if(g.reg.test(v))return i(g,u,v)}}),l.media=c,l};var a=function(o,l){var c=l.split(/=(.+)/,2);return c.length===2?o[c[0]]=e(c[1]):c.length===1&&l.length>1&&(o[c[0]]=void 0),o};n.parseParams=function(o){return o.split(/;\s?/).reduce(a,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(o){return o.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(o){for(var l=[],c=o.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},n.parseImageAttributes=function(o){return o.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(a,{})})},n.parseSimulcastStreamList=function(o){return o.split(";").map(function(l){return l.split(",").map(function(c){var u,h=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),h=!0),{scid:u,paused:h}})})}})(nc);var nr=rc,vh=/%[sdv%]/g,bh=function(n){var e=1,t=arguments,i=t.length;return n.replace(vh,function(r){if(e>=i)return r;var s=t[e];switch(e+=1,r){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},qn=function(n,e,t){var i=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,r=[n+"="+i];if(e.names)for(var s=0;s<e.names.length;s+=1){var a=e.names[s];e.name?r.push(t[e.name][a]):r.push(t[e.names[s]])}else r.push(t[e.name]);return bh.apply(null,r)},yh=["v","o","s","i","u","e","p","c","b","t","r","z","a"],kh=["i","c","b","a"],Sh=function(n,e){e=e||{},n.version==null&&(n.version=0),n.name==null&&(n.name=" "),n.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var t=e.outerOrder||yh,i=e.innerOrder||kh,r=[];return t.forEach(function(s){nr[s].forEach(function(a){a.name in n&&n[a.name]!=null?r.push(qn(s,a,n)):a.push in n&&n[a.push]!=null&&n[a.push].forEach(function(o){r.push(qn(s,a,o))})})}),n.media.forEach(function(s){r.push(qn("m",nr.m[0],s)),i.forEach(function(a){nr[a].forEach(function(o){o.name in s&&s[o.name]!=null?r.push(qn(a,o,s)):o.push in s&&s[o.push]!=null&&s[o.push].forEach(function(l){r.push(qn(a,o,l))})})})}),r.join(`\r
`)+`\r
`},Th=nc,Ch=Sh,ir=Ch,Wn=Th.parse;const Qs=.7,Rn={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Ys extends vt.EventEmitter{get pc(){if(this._pc)return this._pc;throw new re("Expected peer connection to be available")}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=ns(i=>{this.emit(Rn.NegotiationStarted);try{this.createAndSendOffer()}catch(r){if(i)i(r);else throw r}},100),this._pc=Xd()?new RTCPeerConnection(e,t):new RTCPeerConnection(e)}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return T(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){var t;return T(this,void 0,void 0,function*(){let i;if(e.type==="offer"){let{stereoMids:r,nackMids:s}=Eh(e);this.remoteStereoMids=r,this.remoteNackMids=s}else if(e.type==="answer"){const r=Wn((t=e.sdp)!==null&&t!==void 0?t:"");r.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||s.mid!=a.transceiver.mid)return!1;let o=0;if(s.rtp.some(c=>c.codec.toUpperCase()===a.codec.toUpperCase()?(o=c.payload,!0):!1),o===0)return!0;let l=!1;for(const c of s.fmtp)if(c.payload===o){c.config=c.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(c.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&s.fmtp.push({payload:o,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),i=ir(r)}yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(r=>{this.pc.addIceCandidate(r)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,this.createAndSendOffer()):e.type==="answer"&&(this.emit(Rn.NegotiationComplete),e.sdp&&Wn(e.sdp).media.forEach(s=>{s.type==="video"&&this.emit(Rn.RTPVideoPayloadTypes,s.rtp)}))})}createAndSendOffer(e){var t;return T(this,void 0,void 0,function*(){if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(y.debug("restarting ICE"),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const s=this.pc.remoteDescription;if(e!=null&&e.iceRestart&&s)yield this.pc.setRemoteDescription(s);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){y.warn("could not createOffer with closed peer connection");return}y.debug("starting to negotiate");const i=yield this.pc.createOffer(e),r=Wn((t=i.sdp)!==null&&t!==void 0?t:"");r.media.forEach(s=>{s.type==="audio"?Zs(s,[],[]):s.type==="video"&&(wh(s),this.trackBitrates.some(a=>{if(!s.msid||!a.cid||!s.msid.includes(a.cid))return!1;let o=0;if(s.rtp.some(c=>c.codec.toUpperCase()===a.codec.toUpperCase()?(o=c.payload,!0):!1),o===0)return!0;let l=!1;for(const c of s.fmtp)if(c.payload===o){c.config.includes("x-google-start-bitrate")||(c.config+=";x-google-start-bitrate=".concat(a.maxbr*Qs)),c.config.includes("x-google-max-bitrate")||(c.config+=";x-google-max-bitrate=".concat(a.maxbr)),l=!0;break}return l||s.fmtp.push({payload:o,config:"x-google-start-bitrate=".concat(a.maxbr*Qs,";x-google-max-bitrate=").concat(a.maxbr)}),!0}))}),yield this.setMungedSDP(i,ir(r)),this.onOffer(i)})}createAndSetAnswer(){var e;return T(this,void 0,void 0,function*(){const t=yield this.pc.createAnswer(),i=Wn((e=t.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{r.type==="audio"&&Zs(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,ir(i)),t})}setTrackCodecBitrate(e){this.trackBitrates.push(e)}close(){this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)}setMungedSDP(e,t,i){return T(this,void 0,void 0,function*(){if(t){const r=e.sdp;e.sdp=t;try{y.debug("setting munged ".concat(i?"remote":"local"," description")),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){y.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),{error:s,sdp:t}),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const a={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),y.error("unable to set ".concat(e.type),a),new Pr(s)}})}}function Zs(n,e,t){let i=0;n.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(n.rtcpFb||(n.rtcpFb=[]),t.includes(n.mid)&&!n.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&n.rtcpFb.push({payload:i,type:"nack"}),e.includes(n.mid)&&n.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function wh(n){var e,t,i,r;const s=(t=(e=n.rtp[0])===null||e===void 0?void 0:e.codec)===null||t===void 0?void 0:t.toLowerCase();if(!Kn(s))return;let a=0;((i=n.ext)===null||i===void 0?void 0:i.some(l=>l.uri===Us?!0:(l.value>a&&(a=l.value),!1)))||(r=n.ext)===null||r===void 0||r.push({value:a+1,uri:Us})}function Eh(n){var e;const t=[],i=[],r=Wn((e=n.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(a=>{var o;a.type==="audio"&&(a.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((o=a.rtcpFb)===null||o===void 0)&&o.some(l=>l.payload===s&&l.type==="nack")&&i.push(a.mid),a.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&t.push(a.mid),!0):!1))}),{stereoMids:t,nackMids:i}}const xh={audioBitrate:xi.music.maxBitrate,audioPreset:xi.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:es.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",backupCodec:!1},sc={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},ac={resolution:Xn.h720.resolution},Ph={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new kd,disconnectOnPageLeave:!0,expWebAudioMix:!1},oc={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3},Xs="_lossy",ea="_reliable",Rh=2*1e3,ta="leave-reconnect";var Se;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(Se||(Se={}));class Nh extends vt.EventEmitter{get isClosed(){return this._isClosed}constructor(e){super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=oc.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=Se.New,this._isClosed=!0,this.pendingTrackResolvers={},this.hasPublished=!1,this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.handleDataChannel=t=>{let{channel:i}=t;return T(this,void 0,void 0,function*(){if(i){if(i.label===ea)this.reliableDCSub=i;else if(i.label===Xs)this.lossyDCSub=i;else return;y.debug("on data channel ".concat(i.id,", ").concat(i.label)),i.onmessage=this.handleDataMessage}})},this.handleDataMessage=t=>T(this,void 0,void 0,function*(){var i,r;const s=yield this.dataProcessLock.lock();try{let a;if(t.data instanceof ArrayBuffer)a=t.data;else if(t.data instanceof Blob)a=yield t.data.arrayBuffer();else{y.error("unsupported data type",t.data);return}const o=Xe.fromBinary(new Uint8Array(a));((i=o.value)===null||i===void 0?void 0:i.case)==="speaker"?this.emit(A.ActiveSpeakersUpdate,o.value.value.speakers):((r=o.value)===null||r===void 0?void 0:r.case)==="user"&&this.emit(A.DataPacketReceived,o.value.value,o.kind)}finally{s()}}),this.handleDataError=t=>{const r=t.currentTarget.maxRetransmits===0?"lossy":"reliable";if(t instanceof ErrorEvent&&t.error){const{error:s}=t.error;y.error("DataChannel error on ".concat(r,": ").concat(t.message),s)}else y.error("Unknown DataChannel error on ".concat(r),t)},this.handleBufferedAmountLow=t=>{const r=t.currentTarget.maxRetransmits===0?Z.LOSSY:Z.RELIABLE;this.updateAndEmitDCBufferStatus(r)},this.handleDisconnect=(t,i)=>{if(this._isClosed)return;y.warn("".concat(t," disconnected")),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const r=o=>{y.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(o,"ms. giving up")),this.emit(A.Disconnected),this.close()},s=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:s,retryCount:this.reconnectAttempts});if(a===null){r(s);return}t===ta&&(a=0),y.debug("reconnecting in ".concat(a,"ms")),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=oe.setTimeout(()=>this.attemptReconnect(i),a)},this.waitForRestarted=()=>new Promise((t,i)=>{this.pcState===Se.Connected&&t();const r=()=>{this.off(A.Disconnected,s),t()},s=()=>{this.off(A.Restarted,r),i()};this.once(A.Restarted,r),this.once(A.Disconnected,s)}),this.updateAndEmitDCBufferStatus=t=>{const i=this.isBufferStatusLow(t);typeof i<"u"&&i!==this.dcBufferStatus.get(t)&&(this.dcBufferStatus.set(t,i),this.emit(A.DCBufferStatusChanged,i,t))},this.isBufferStatusLow=t=>{const i=this.dataChannelForKind(t);if(i)return i.bufferedAmount<=i.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.isReconnecting&&(this.clearReconnectTimeout(),this.attemptReconnect(Ie.RR_SIGNAL_DISCONNECTED))},this.client=new ts,this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Ht,this.dataProcessLock=new Ht,this.dcBufferStatus=new Map([[Z.LOSSY,!0],[Z.RELIABLE,!0]]),this.client.onParticipantUpdate=t=>this.emit(A.ParticipantUpdate,t),this.client.onConnectionQuality=t=>this.emit(A.ConnectionQualityUpdate,t),this.client.onRoomUpdate=t=>this.emit(A.RoomUpdate,t),this.client.onSubscriptionError=t=>this.emit(A.SubscriptionError,t),this.client.onSubscriptionPermissionUpdate=t=>this.emit(A.SubscriptionPermissionUpdate,t),this.client.onSpeakersChanged=t=>this.emit(A.SpeakersChanged,t),this.client.onStreamStateUpdate=t=>this.emit(A.StreamStateChanged,t)}join(e,t,i,r){return T(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,t,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.publisher||this.configure(s),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=s.clientConfiguration,s}catch(s){if(s instanceof G&&s.reason===1&&(y.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts)),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,i,r);throw s}})}close(){return T(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.emit(A.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return T(this,void 0,void 0,function*(){this.publisher&&this.publisher.pc.signalingState!=="closed"&&this.publisher.pc.getSenders().forEach(t=>{var i,r;try{!((i=this.publisher)===null||i===void 0)&&i.pc.removeTrack&&((r=this.publisher)===null||r===void 0||r.pc.removeTrack(t))}catch(s){y.warn("could not removeTrack",{error:s})}}),this.publisher&&(this.publisher.close(),this.publisher=void 0),this.subscriber&&(this.subscriber.close(),this.subscriber=void 0),this.primaryPC=void 0;const e=t=>{t&&(t.close(),t.onbufferedamountlow=null,t.onclose=null,t.onclosing=null,t.onerror=null,t.onmessage=null,t.onopen=null)};e(this.lossyDC),e(this.lossyDCSub),e(this.reliableDC),e(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return T(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ze("a track with the same ID has already been published");return new Promise((t,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new G("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),t(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){var t;if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:i}=this.pendingTrackResolvers[e.track.id];i&&i(),delete this.pendingTrackResolvers[e.track.id]}try{return(t=this.publisher)===null||t===void 0||t.pc.removeTrack(e),!0}catch(i){y.warn("failed to remove track",{error:i,method:"removeTrack"})}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return T(this,void 0,void 0,function*(){if(this.primaryPC!==void 0)return Ih(this.primaryPC)})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){var t,i;if(this.publisher||this.subscriber)return;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid;const r=this.makeRTCConfiguration(e);!((i=this.signalOpts)===null||i===void 0)&&i.e2eeEnabled&&(y.debug("E2EE - setting up transports with insertable streams"),r.encodedInsertableStreams=!0);const s={optional:[{googDscp:!0}]};this.publisher=new Ys(r,s),this.subscriber=new Ys(r),this.emit(A.TransportsCreated,this.publisher,this.subscriber),this.publisher.pc.onicecandidate=c=>{c.candidate&&(y.trace("adding ICE candidate for peer",c.candidate),this.client.sendIceCandidate(c.candidate,be.PUBLISHER))},this.subscriber.pc.onicecandidate=c=>{c.candidate&&this.client.sendIceCandidate(c.candidate,be.SUBSCRIBER)},this.publisher.onOffer=c=>{this.client.sendOffer(c)};let a=this.publisher.pc,o=this.subscriber.pc,l=e.subscriberPrimary;l&&(a=this.subscriber.pc,o=this.publisher.pc,this.subscriber.pc.ondatachannel=this.handleDataChannel),this.primaryPC=a,a.onconnectionstatechange=()=>T(this,void 0,void 0,function*(){if(y.debug("primary PC state changed ".concat(a.connectionState)),a.connectionState==="connected"){const c=this.pcState===Se.New;this.pcState=Se.Connected,c&&this.emit(A.Connected,e)}else a.connectionState==="failed"&&this.pcState===Se.Connected&&(this.pcState=Se.Disconnected,this.handleDisconnect("primary peerconnection",l?Ie.RR_SUBSCRIBER_FAILED:Ie.RR_PUBLISHER_FAILED))}),o.onconnectionstatechange=()=>T(this,void 0,void 0,function*(){y.debug("secondary PC state changed ".concat(o.connectionState)),o.connectionState==="failed"&&this.handleDisconnect("secondary peerconnection",l?Ie.RR_PUBLISHER_FAILED:Ie.RR_SUBSCRIBER_FAILED)}),this.subscriber.pc.ontrack=c=>{this.emit(A.MediaTrackAdded,c.track,c.streams[0],c.receiver)},this.createDataChannels()}setupSignalClientCallbacks(){this.client.onAnswer=e=>T(this,void 0,void 0,function*(){this.publisher&&(y.debug("received server answer",{RTCSdpType:e.type,signalingState:this.publisher.pc.signalingState.toString()}),yield this.publisher.setRemoteDescription(e))}),this.client.onTrickle=(e,t)=>{!this.publisher||!this.subscriber||(y.trace("got ICE candidate from peer",{candidate:e,target:t}),t===be.PUBLISHER?this.publisher.addIceCandidate(e):this.subscriber.addIceCandidate(e))},this.client.onOffer=e=>T(this,void 0,void 0,function*(){if(!this.subscriber)return;y.debug("received server offer",{RTCSdpType:e.type,signalingState:this.subscriber.pc.signalingState.toString()}),yield this.subscriber.setRemoteDescription(e);const t=yield this.subscriber.createAndSetAnswer();this.client.sendAnswer(t)}),this.client.onLocalTrackPublished=e=>{if(y.debug("received trackPublishedResponse",e),!this.pendingTrackResolvers[e.cid]){y.error("missing track resolver for ".concat(e.cid));return}const{resolve:t}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],t(e.track)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onClose=()=>{this.handleDisconnect("signal",Ie.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{e!=null&&e.canReconnect?(this.fullReconnectOnNext=!0,this.primaryPC=void 0,this.handleDisconnect(ta)):(this.emit(A.Disconnected,e==null?void 0:e.reason),this.close()),y.trace("leave request",{leave:e})}}makeRTCConfiguration(e){const t=Object.assign({},this.rtcConfig);if(e.iceServers&&!t.iceServers){const i=[];e.iceServers.forEach(r=>{const s={urls:r.urls};r.username&&(s.username=r.username),r.credential&&(s.credential=r.credential),i.push(s)}),t.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===$e.ENABLED&&(t.iceTransportPolicy="relay"),t.sdpSemantics="unified-plan",t.continualGatheringPolicy="gather_continually",t}createDataChannels(){this.publisher&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.publisher.pc.createDataChannel(Xs,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.publisher.pc.createDataChannel(ea,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}setPreferredCodec(e,t,i){if(!("getCapabilities"in RTCRtpSender))return;const r=RTCRtpSender.getCapabilities(t);if(!r)return;y.debug("get capabilities",r);const s=[],a=[],o=[];r.codecs.forEach(l=>{const c=l.mimeType.toLowerCase();if(c==="audio/opus"){s.push(l);return}if(!(c==="video/".concat(i))){o.push(l);return}if(i==="h264"){l.sdpFmtpLine&&l.sdpFmtpLine.includes("profile-level-id=42e01f")?s.push(l):a.push(l);return}s.push(l)}),Zd(e)&&e.setCodecPreferences(s.concat(a,o))}createSender(e,t,i){return T(this,void 0,void 0,function*(){if(js())return yield this.createTransceiverRTCRtpSender(e,t,i);if(Fs())return y.warn("using add-track fallback"),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new re("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,i,r){return T(this,void 0,void 0,function*(){if(js())return this.createSimulcastTransceiverSender(e,t,i,r);if(Fs())return y.debug("using add-track fallback"),this.createRTCRtpSender(e.mediaStreamTrack);throw new re("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,i){return T(this,void 0,void 0,function*(){if(!this.publisher)throw new re("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream);const s={direction:"sendonly",streams:r};i&&(s.sendEncodings=i);const a=yield this.publisher.pc.addTransceiver(e.mediaStreamTrack,s);return e.kind===w.Kind.Video&&t.videoCodec&&(this.setPreferredCodec(a,e.kind,t.videoCodec),e.codec=t.videoCodec),a.sender})}createSimulcastTransceiverSender(e,t,i,r){return T(this,void 0,void 0,function*(){if(!this.publisher)throw new re("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const a=yield this.publisher.pc.addTransceiver(t.mediaStreamTrack,s);if(i.videoCodec)return this.setPreferredCodec(a,e.kind,i.videoCodec),e.setSimulcastTrackSender(i.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return T(this,void 0,void 0,function*(){if(!this.publisher)throw new re("publisher is closed");return this.publisher.pc.addTrack(e)})}attemptReconnect(e){var t,i,r;return T(this,void 0,void 0,function*(){if(!this._isClosed&&!this.attemptingReconnect){(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===$e.DISABLED||((r=(i=this.primaryPC)===null||i===void 0?void 0:i.signalingState)!==null&&r!==void 0?r:"closed")==="closed")&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let a=!0;s instanceof re?(y.debug("received unrecoverable error",{error:s}),a=!1):s instanceof ui||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",Ie.RR_UNKNOWN):(y.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up")),this.emit(A.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){y.warn("encountered error in reconnect policy",{error:t})}return null}restartConnection(e){var t,i,r;return T(this,void 0,void 0,function*(){try{if(!this.url||!this.token)throw new re("could not reconnect, url or token not saved");y.info("reconnecting, attempt: ".concat(this.reconnectAttempts)),this.emit(A.Restarting),this.client.isConnected&&(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw y.warn("attempted connection restart, without signal options present"),new ui;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof G&&a.reason===0?new re("could not reconnect, token might be expired"):new ui}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");this.client.setReconnected(),this.emit(A.SignalRestarted,s),yield this.waitForPCReconnected(),(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(A.Restarted)}catch(s){const a=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){var t;return T(this,void 0,void 0,function*(){if(!this.url||!this.token)throw new re("could not reconnect, url or token not saved");if(!this.publisher||!this.subscriber)throw new re("publisher and subscriber connections unset");y.info("resuming signal connection, attempt ".concat(this.reconnectAttempts)),this.emit(A.Resuming);try{this.setupSignalClientCallbacks();const i=yield this.client.reconnect(this.url,this.token,this.participantSid,e);if(i){const r=this.makeRTCConfiguration(i);this.publisher.pc.setConfiguration(r),this.subscriber.pc.setConfiguration(r)}}catch(i){let r="";throw i instanceof Error&&(r=i.message),i instanceof G&&i.reason===0?new re("could not reconnect, token might be expired"):new ui(r)}if(this.emit(A.SignalResumed),this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");this.subscriber.restartingIce=!0,this.hasPublished&&(yield this.publisher.createAndSendOffer({iceRestart:!0})),yield this.waitForPCReconnected(),this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(A.Resumed)})}waitForPCInitialConnection(e,t){return T(this,void 0,void 0,function*(){if(this.pcState!==Se.Connected){if(this.pcState!==Se.New)throw new re("Expected peer connection to be new on initial connection");return new Promise((i,r)=>{const s=()=>{y.warn("closing engine"),oe.clearTimeout(o),r(new G("room connection has been cancelled",3))};t!=null&&t.signal.aborted&&s(),t==null||t.signal.addEventListener("abort",s);const a=()=>{oe.clearTimeout(o),t==null||t.signal.removeEventListener("abort",s),i()},o=oe.setTimeout(()=>{this.off(A.Connected,a),r(new G("could not establish pc connection"))},e??this.peerConnectionTimeout);this.once(A.Connected,a)})}})}waitForPCReconnected(){var e;return T(this,void 0,void 0,function*(){const t=Date.now();let i=t;for(this.pcState=Se.Reconnecting,y.debug("waiting for peer connection to reconnect");i-t<this.peerConnectionTimeout&&this.primaryPC!==void 0;){if(i-t>Rh&&((e=this.primaryPC)===null||e===void 0?void 0:e.connectionState)==="connected"&&(this.pcState=Se.Connected),this.pcState===Se.Connected)return;yield mn(100),i=Date.now()}throw new G("could not establish PC connection")})}sendDataPacket(e,t){return T(this,void 0,void 0,function*(){const i=e.toBinary();yield this.ensurePublisherConnected(t);const r=this.dataChannelForKind(t);r&&r.send(i),this.updateAndEmitDCBufferStatus(t)})}ensureDataTransportConnected(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;var i,r,s;return T(this,void 0,void 0,function*(){const a=t?this.subscriber:this.publisher,o=t?"Subscriber":"Publisher";if(!a)throw new G("".concat(o," connection not set"));!t&&!(!((i=this.publisher)===null||i===void 0)&&i.isICEConnected)&&((r=this.publisher)===null||r===void 0?void 0:r.pc.iceConnectionState)!=="checking"&&this.negotiate();const l=this.dataChannelForKind(e,t);if((l==null?void 0:l.readyState)==="open")return;const c=new Date().getTime()+this.peerConnectionTimeout;for(;new Date().getTime()<c;){if(a.isICEConnected&&((s=this.dataChannelForKind(e,t))===null||s===void 0?void 0:s.readyState)==="open")return;yield mn(50)}throw new G("could not establish ".concat(o," connection, state: ").concat(a.pc.iceConnectionState))})}ensurePublisherConnected(e){return T(this,void 0,void 0,function*(){yield this.ensureDataTransportConnected(e,!1)})}verifyTransport(){return!(!this.primaryPC||this.primaryPC.connectionState==="closed"||this.primaryPC.connectionState==="failed"||this.hasPublished&&this.subscriberPrimary&&(!this.publisher||this.publisher.pc.connectionState==="closed"||this.publisher.pc.connectionState==="failed")||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return new Promise((e,t)=>{if(!this.publisher){t(new Pr("publisher is not defined"));return}this.hasPublished=!0;const i=()=>{y.debug("engine disconnected while negotiation was ongoing"),s(),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(A.Closing,i);const r=setTimeout(()=>{t("negotiation timed out"),this.handleDisconnect("negotiation",Ie.RR_SIGNAL_DISCONNECTED)},this.peerConnectionTimeout),s=()=>{clearTimeout(r),this.off(A.Closing,i)};this.publisher.once(Rn.NegotiationStarted,()=>{var a;(a=this.publisher)===null||a===void 0||a.once(Rn.NegotiationComplete,()=>{s(),e()})}),this.publisher.once(Rn.RTPVideoPayloadTypes,a=>{const o=new Map;a.forEach(l=>{const c=l.codec.toLowerCase();ih(c)&&o.set(l.payload,c)}),this.emit(A.RTPVideoMapUpdate,o)}),this.publisher.negotiate(a=>{s(),t(a),a instanceof Pr&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Ie.RR_UNKNOWN)})})}dataChannelForKind(e,t){if(t){if(e===Z.LOSSY)return this.lossyDCSub;if(e===Z.RELIABLE)return this.reliableDCSub}else{if(e===Z.LOSSY)return this.lossyDC;if(e===Z.RELIABLE)return this.reliableDC}}failNext(){this.shouldFailNext=!0}clearReconnectTimeout(){this.reconnectTimeout&&oe.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ye()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){ye()&&window.removeEventListener("online",this.handleBrowserOnLine)}}function Ih(n){var e;return T(this,void 0,void 0,function*(){let t="";const i=new Map,r=new Map;if((yield n.getStats()).forEach(o=>{switch(o.type){case"transport":t=o.selectedCandidatePairId;break;case"candidate-pair":t===""&&o.selected&&(t=o.id),i.set(o.id,o);break;case"remote-candidate":r.set(o.id,"".concat(o.address,":").concat(o.port));break}}),t==="")return;const a=(e=i.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return r.get(a)})}class ui extends Error{}class na{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Mr(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return T(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(t.length>0){const i=t[0];return this.attemptedRegions.push(i),y.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return T(this,void 0,void 0,function*(){const t=yield fetch("".concat(Mh(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const i=yield t.json();return this.lastUpdateAt=Date.now(),i}else throw new G("Could not fetch region settings: ".concat(t.statusText),t.status===401?0:void 0,t.status)})}}function Mh(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}const is=2e3;function Ji(n,e){if(!e)return 0;let t,i;return"bytesReceived"in n?(t=n.bytesReceived,i=e.bytesReceived):"bytesSent"in n&&(t=n.bytesSent,i=e.bytesSent),t===void 0||i===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(t-i)*8*1e3/(n.timestamp-e.timestamp)}class pe extends Dn{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,w.Kind.Audio,t,i),this.stopOnMute=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(a){y.error("could not get audio sender stats",{error:a});return}s&&this.prevStats&&(this._currentBitrate=Ji(s,this.prevStats)),this.prevStats=s}),this.audioContext=r,this.checkForSilence()}setDeviceId(e){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===e?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||gn(e)===this.mediaStreamTrack.getSettings().deviceId)})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===w.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(y.debug("stopping mic track"),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==gn(this._constraints.deviceId);return this.source===w.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(y.debug("reacquiring mic track"),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return T(this,void 0,void 0,function*(){let t;if(e){const i=Fi({audio:e});typeof i.audio!="boolean"&&(t=i.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return T(this,void 0,void 0,function*(){const i=yield t.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){ye()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},is)))}setProcessor(e){var t;return T(this,void 0,void 0,function*(){const i=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");if(this.processor&&(yield this.stopProcessor()),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};y.debug("setting up audio processor ".concat(e.name)),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack))}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){var e;return T(this,void 0,void 0,function*(){if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let i;return t.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return T(this,void 0,void 0,function*(){const e=yield zd(this);return e&&(this.isMuted||y.warn("silence detected on local audio track"),this.emit(M.AudioSilenceDetected)),e})}}function cc(n,e){switch(n.kind){case"audio":return new pe(n,e,!1);case"video":return new Te(n,e,!1);default:throw new Ze("unsupported track type: ".concat(n.kind))}}const _h=Object.values(Xn),Dh=Object.values(Rr),Ah=Object.values(es),Oh=[Xn.h180,Xn.h360],Lh=[Rr.h180,Rr.h360],Uh=n=>[{scaleResolutionDownBy:2,fps:3}].map(t=>{var i;return new W(Math.floor(n.width/t.scaleResolutionDownBy),Math.floor(n.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((i=n.encoding.maxFramerate)!==null&&i!==void 0?i:30)/t.fps)))),t.fps,n.encoding.priority)}),Dr=["q","h","f"];function lc(n,e,t,i){var r,s;let a=i==null?void 0:i.videoEncoding;n&&(a=i==null?void 0:i.screenShareEncoding);const o=i==null?void 0:i.simulcast,l=i==null?void 0:i.scalabilityMode,c=i==null?void 0:i.videoCodec;if(!a&&!o&&!l||!e||!t)return[{}];a||(a=jh(n,e,t,c),y.debug("using video encoding",a));const u=new W(e,t,a.maxBitrate,a.maxFramerate,a.priority);if(l&&Kn(c)){y.debug("using svc with scalabilityMode ".concat(l));const v=new uc(l),b=[];if(v.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));for(let g=0;g<v.spatial;g+=1)b.push({rid:Dr[2-g],maxBitrate:a.maxBitrate/Math.pow(3,g),maxFramerate:u.encoding.maxFramerate});return b[0].scalabilityMode=l,y.debug("encodings",b),b}if(!o)return[a];let h=[];n?h=(r=sa(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:ra(n,u):h=(s=sa(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:ra(n,u);let p;if(h.length>0){const v=h[0];h.length>1&&([,p]=h);const b=Math.max(e,t);if(b>=960&&p)return rr(e,t,[v,p,u]);if(b>=480)return rr(e,t,[v,u])}return rr(e,t,[u])}function ia(n,e,t){var i,r,s,a;if(!t.backupCodec||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&y.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const o=n.mediaStreamTrack.getSettings(),l=(i=o.width)!==null&&i!==void 0?i:(r=n.dimensions)===null||r===void 0?void 0:r.width,c=(s=o.height)!==null&&s!==void 0?s:(a=n.dimensions)===null||a===void 0?void 0:a.height;return lc(n.source===w.Source.ScreenShare,l,c,t)}function jh(n,e,t,i){const r=Fh(n,e,t);let{encoding:s}=r[0];const a=Math.max(e,t);for(let o=0;o<r.length;o+=1){const l=r[o];if(s=l.encoding,l.width>=a)break}if(i)switch(i){case"av1":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function Fh(n,e,t){if(n)return Ah;const i=e>t?e/t:t/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?_h:Dh}function ra(n,e){if(n)return Uh(e);const{width:t,height:i}=e,r=t>i?t/i:i/t;return Math.abs(r-16/9)<Math.abs(r-4/3)?Oh:Lh}function rr(n,e,t){const i=[];if(t.forEach((r,s)=>{if(s>=Dr.length)return;const a=Math.min(n,e),l={rid:Dr[s],scaleResolutionDownBy:Math.max(1,a/Math.min(r.width,r.height)),maxBitrate:r.encoding.maxBitrate};r.encoding.maxFramerate&&(l.maxFramerate=r.encoding.maxFramerate);const c=ei()||s===0;r.encoding.priority&&c&&(l.priority=r.encoding.priority,l.networkPriority=r.encoding.priority),i.push(l)}),kn()&&Xo()==="ios"){let r;i.forEach(a=>{r?a.maxFramerate&&a.maxFramerate>r&&(r=a.maxFramerate):r=a.maxFramerate});let s=!0;i.forEach(a=>{var o;a.maxFramerate!=r&&(s&&(s=!1,y.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),y.info('Setting framerate of encoding "'.concat((o=a.rid)!==null&&o!==void 0?o:"",'" to ').concat(r)),a.maxFramerate=r)})}return i}function sa(n){if(n)return n.sort((e,t)=>{const{encoding:i}=e,{encoding:r}=t;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class uc{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}const Bh=5e3;class Te extends Dn{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;super(e,w.Kind.Video,t,i),this.simulcastCodecs=new Map,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let r;try{r=yield this.getSenderStats()}catch(a){y.error("could not get audio sender stats",{error:a});return}const s=new Map(r.map(a=>[a.rid,a]));if(this.prevStats){let a=0;s.forEach((o,l)=>{var c;const u=(c=this.prevStats)===null||c===void 0?void 0:c.get(l);a+=Ji(o,u)}),this._currentBitrate=a}this.prevStats=s}),this.senderLock=new Ht}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!ye())return;const i=(t=this.sender)===null||t===void 0?void 0:t.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},is))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});var t,i,r,s,a;return T(this,void 0,void 0,function*(){yield e.pauseUpstream.call(this);try{for(var o=!0,l=Cn(this.simulcastCodecs.values()),c;c=yield l.next(),t=c.done,!t;o=!0)s=c.value,o=!1,yield(a=s.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(u){i={error:u}}finally{try{!o&&!t&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});var t,i,r,s,a;return T(this,void 0,void 0,function*(){yield e.resumeUpstream.call(this);try{for(var o=!0,l=Cn(this.simulcastCodecs.values()),c;c=yield l.next(),t=c.done,!t;o=!0){s=c.value,o=!1;const u=s;yield(a=u.sender)===null||a===void 0?void 0:a.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!o&&!t&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===w.Source.Camera&&!this.isUserProvided&&(y.debug("stopping camera track"),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===w.Source.Camera&&!this.isUserProvided&&(y.debug("reacquiring camera track"),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){var e;return T(this,void 0,void 0,function*(){if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const a={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,framesSent:r.framesSent,timestamp:r.timestamp,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges},o=i.get(r.remoteId);o&&(a.jitter=o.jitter,a.packetsLost=o.packetsLost,a.roundTripTime=o.roundTripTime),t.push(a)}}),t})}setPublishingQuality(e){const t=[];for(let i=X.LOW;i<=X.HIGH;i+=1)t.push(new He({quality:i,enabled:i<=e}));y.debug("setting publishing quality. max quality ".concat(e)),this.setPublishingLayers(t)}setDeviceId(e){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===gn(e)?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||gn(e)===this._mediaStreamTrack.getSettings().deviceId)})}restartTrack(e){var t,i,r,s;return T(this,void 0,void 0,function*(){let a;if(e){const u=Fi({video:e});typeof u.video!="boolean"&&(a=u.video)}yield this.restart(a);try{for(var o=!0,l=Cn(this.simulcastCodecs.values()),c;c=yield l.next(),t=c.done,!t;o=!0){s=c.value,o=!1;const u=s;u.sender&&(u.mediaStreamTrack=this.mediaStreamTrack.clone(),yield u.sender.replaceTrack(u.mediaStreamTrack))}}catch(u){i={error:u}}finally{try{!o&&!t&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const i=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});var r,s,a,o,l,c;return T(this,void 0,void 0,function*(){if(yield i.setProcessor.call(this,e,t),!((l=this.processor)===null||l===void 0)&&l.processedTrack)try{for(var u=!0,h=Cn(this.simulcastCodecs.values()),p;p=yield h.next(),r=p.done,!r;u=!0)o=p.value,u=!1,yield(c=o.sender)===null||c===void 0?void 0:c.replaceTrack(this.processor.processedTrack)}catch(v){s={error:v}}finally{try{!u&&!r&&(a=h.return)&&(yield a.call(h))}finally{if(s)throw s.error}}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))throw new Error("".concat(e," already added"));const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,t){const i=this.simulcastCodecs.get(e);i&&(i.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},Bh))}setPublishingCodecs(e){var t,i,r,s,a,o,l;return T(this,void 0,void 0,function*(){if(y.debug("setting publishing codecs",{codecs:e,currentCodec:this.codec}),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,i=Cn(e);r=yield i.next(),s=r.done,!s;t=!0){l=r.value,t=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(u.qualities);else{const h=this.simulcastCodecs.get(u.codec);if(y.debug("try setPublishingCodec for ".concat(u.codec),h),!h||!h.sender){for(const p of u.qualities)if(p.enabled){c.push(u.codec);break}}else h.encodings&&(y.debug("try setPublishingLayersForSender ".concat(u.codec)),yield aa(h.sender,h.encodings,u.qualities,this.senderLock))}}}catch(u){a={error:u}}finally{try{!t&&!s&&(o=i.return)&&(yield o.call(i))}finally{if(a)throw a.error}}return c})}setPublishingLayers(e){return T(this,void 0,void 0,function*(){y.debug("setting publishing layers",e),!(!this.sender||!this.encodings)&&(yield aa(this.sender,this.encodings,e,this.senderLock))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Yo()&&this.isInBackground&&this.source===w.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function aa(n,e,t,i){return T(this,void 0,void 0,function*(){const r=yield i.lock();y.debug("setPublishingLayersForSender",{sender:n,qualities:t,senderEncodings:e});try{const s=n.getParameters(),{encodings:a}=s;if(!a)return;if(a.length!==e.length){y.warn("cannot set publishing layers, encodings mismatch");return}let o=!1;!1&&a[0].scalabilityMode||a.forEach((c,u)=>{var h;let p=(h=c.rid)!==null&&h!==void 0?h:"";p===""&&(p="q");const v=dc(p),b=t.find(g=>g.quality===v);b&&c.active!==b.enabled&&(o=!0,c.active=b.enabled,y.debug("setting layer ".concat(b.quality," to ").concat(c.active?"enabled":"disabled")),ei()&&(b.enabled?(c.scaleResolutionDownBy=e[u].scaleResolutionDownBy,c.maxBitrate=e[u].maxBitrate,c.maxFrameRate=e[u].maxFrameRate):(c.scaleResolutionDownBy=4,c.maxBitrate=10,c.maxFrameRate=2)))}),o&&(s.encodings=a,y.debug("setting encodings",s.encodings),yield n.setParameters(s))}finally{r()}})}function dc(n){switch(n){case"f":return X.HIGH;case"h":return X.MEDIUM;case"q":return X.LOW;default:return X.HIGH}}function oa(n,e,t,i){if(!t)return[new he({quality:X.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(i){const r=t[0].scalabilityMode,s=new uc(r),a=[];for(let o=0;o<s.spatial;o+=1)a.push(new he({quality:X.HIGH-o,width:Math.ceil(n/Math.pow(2,o)),height:Math.ceil(e/Math.pow(2,o)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(3,o)):0,ssrc:0}));return a}return t.map(r=>{var s,a,o;const l=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let c=dc((a=r.rid)!==null&&a!==void 0?a:"");return new he({quality:c,width:Math.ceil(n/l),height:Math.ceil(e/l),bitrate:(o=r.maxBitrate)!==null&&o!==void 0?o:0,ssrc:0})})}class hc extends w{constructor(e,t,i,r){super(e,i),this.sid=t,this.receiver=r}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?M.Muted:M.Unmuted,this))}setMediaStream(e){this.mediaStream=e,e.onremovetrack=()=>{this.receiver=void 0,this._currentBitrate=0,this.emit(M.Ended,this)}}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),is))}}class Nn extends hc{constructor(e,t,i,r,s){super(e,t,w.Kind.Audio,i),this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Ji(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var t;for(const i of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):i.volume=e;kn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(kn())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return T(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(Ir(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.elementVolume&&(e.volume=this.elementVolume),this.sinkId&&Ir(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(y.debug("using audio context mapping"),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(M.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(M.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(i=>{i.type==="inbound-rtp"&&(t={type:"audio",timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),t})}}const sr=100;class Qn extends hc{constructor(e,t,i,r){super(e,t,w.Kind.Video,i),this.elementInfos=[],this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const s=yield this.getReceiverStats();s&&this.prevStats&&this.receiver&&(this._currentBitrate=Ji(s,this.prevStats)),this.prevStats=s}),this.debouncedHandleResize=ns(()=>{this.updateDimensions()},sr),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?Pn(this._mediaStreamTrack,t):wn(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new Jh(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):y.warn("visibility resize observer not triggered")}stopObservingElementInfo(e){if(!this.isAdaptiveStream){y.warn("stopObservingElementInfo ignored");return}const t=this.elementInfos.filter(i=>i===e);for(const i of t)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const i of t)this.stopObservingElement(i);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(i=>{i.type==="inbound-rtp"&&(t={type:"video",framesDecoded:i.framesDecoded,framesDropped:i.framesDropped,framesReceived:i.framesReceived,packetsReceived:i.packetsReceived,packetsLost:i.packetsLost,frameWidth:i.frameWidth,frameHeight:i.frameHeight,pliCount:i.pliCount,firCount:i.firCount,nackCount:i.nackCount,jitter:i.jitter,timestamp:i.timestamp,bytesReceived:i.bytesReceived,decoderImplementation:i.decoderImplementation})}),t})}stopObservingElement(e){const t=this.elementInfos.filter(i=>i.element===e);for(const i of t)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const i=this.elementInfos.reduce((o,l)=>Math.max(o,l.visibilityChangedAt||0),0),r=!((t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&t!==void 0)||t?this.isInBackground:!1,s=this.elementInfos.some(o=>o.pictureInPicture),a=this.elementInfos.some(o=>o.visible)&&!r||s;if(this.lastVisible!==a){if(!a&&Date.now()-i<sr){oe.setTimeout(()=>{this.updateVisibility()},sr);return}this.lastVisible=a,this.emit(M.VisibilityChanged,a,this)}}updateDimensions(){var e,t;let i=0,r=0;const s=this.getPixelDensity();for(const a of this.elementInfos){const o=a.width()*s,l=a.height()*s;o+l>i+r&&(i=o,r=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===r||(this.lastDimensions={width:i,height:r},this.emit(M.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?Bs():t||(Bs()>2?2:1)}}class Jh{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:a}=i;s===this.element&&(this.isIntersecting=a,this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i;this.isPiP=!0,(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=!1,(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=t??ca(e),this.isPiP=ye()&&document.pictureInPictureElement===e,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=ca(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var e;(e=this.handleResize)===null||e===void 0||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Vs().observe(this.element),Js().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var e,t;(e=Vs())===null||e===void 0||e.unobserve(this.element),(t=Js())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function ca(n){let e=n.offsetTop,t=n.offsetLeft;const i=n.offsetWidth,r=n.offsetHeight,{hidden:s}=n,{opacity:a,display:o}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,e+=n.offsetTop,t+=n.offsetLeft;return e<window.pageYOffset+window.innerHeight&&t<window.pageXOffset+window.innerWidth&&e+r>window.pageYOffset&&t+i>window.pageXOffset&&!s&&(a!==""?parseFloat(a)>0:!0)&&o!=="none"}class yt extends vt.EventEmitter{constructor(e,t,i){super(),this.metadataMuted=!1,this.encryption=de.NONE,this.handleMuted=()=>{this.emit(M.Muted)},this.handleUnmuted=()=>{this.emit(M.Unmuted)},this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=i,this.source=w.Source.Unknown}setTrack(e){this.track&&(this.track.off(M.Muted,this.handleMuted),this.track.off(M.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(M.Muted,this.handleMuted),e.on(M.Unmuted,this.handleUnmuted))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==de.NONE}get audioTrack(){if(this.track instanceof pe||this.track instanceof Nn)return this.track}get videoTrack(){if(this.track instanceof Te||this.track instanceof Qn)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=w.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===w.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,y.debug("update publication info",{info:e})}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(n.PermissionStatus||(n.PermissionStatus={}))})(yt||(yt={}));class ti extends yt{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,i){super(e,t.sid,t.name),this.track=void 0,this.handleTrackEnded=()=>{this.emit(M.Ended)},this.updateInfo(t),this.setTrack(i)}setTrack(e){this.track&&this.track.off(M.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(M.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){var e;return T(this,void 0,void 0,function*(){return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){var e;return T(this,void 0,void 0,function*(){return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){var e;return T(this,void 0,void 0,function*(){yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){var e;return T(this,void 0,void 0,function*(){yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}}var Ge;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Unknown="unknown"})(Ge||(Ge={}));function Vh(n){switch(n){case an.EXCELLENT:return Ge.Excellent;case an.GOOD:return Ge.Good;case an.POOR:return Ge.Poor;default:return Ge.Unknown}}class fc extends vt.EventEmitter{get isEncrypted(){return this.tracks.size>0&&Array.from(this.tracks.values()).every(e=>e.isEncrypted)}constructor(e,t,i,r){super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ge.Unknown,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=i,this.metadata=r,this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map}getTracks(){return Array.from(this.tracks.values())}getTrack(e){for(const[,t]of this.tracks)if(t.source===e)return t}getTrackByName(e){for(const[,t]of this.tracks)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrack(w.Source.Camera);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrack(w.Source.Microphone);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrack(w.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,y.trace("update participant info",{info:e}),!0)}_setMetadata(e){const t=this.metadata!==e,i=this.metadata;this.metadata=e,t&&this.emit(R.ParticipantMetadataChanged,i)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(R.ParticipantNameChanged,e)}setPermissions(e){var t,i,r,s,a;const o=this.permissions,l=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((c,u)=>{var h;return c!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[u])});return this.permissions=e,l&&this.emit(R.ParticipantPermissionsChanged,o),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(R.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=Vh(e),t!==this._connectionQuality&&this.emit(R.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTracks.forEach(t=>(t.track instanceof Nn||t.track instanceof pe)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(M.Muted,()=>{this.emit(R.TrackMuted,e)}),e.on(M.Unmuted,()=>{this.emit(R.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.tracks.set(e.trackSid,e),e.kind){case w.Kind.Audio:this.audioTracks.set(e.trackSid,e);break;case w.Kind.Video:this.videoTracks.set(e.trackSid,e);break}}}function qh(n){var e,t,i;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new ut({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=n.participantSid)!==null&&t!==void 0?t:"",allTracks:(i=n.allowAll)!==null&&i!==void 0?i:!1,trackSids:n.allowedTrackSids||[]})}class Ri extends yt{constructor(e,t,i){super(e,t.sid,t.name),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=X.HIGH,this.handleEnded=r=>{this.setTrack(void 0),this.emit(M.Ended,r)},this.handleVisibilityChange=r=>{y.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(r),{trackSid:this.trackSid}),this.disabled=!r,this.emitTrackUpdate()},this.handleVideoDimensionsChange=r=>{y.debug("adaptivestream video dimensions ".concat(r.width,"x").concat(r.height),{trackSid:this.trackSid}),this.videoDimensions=r,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new De({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new nt({participantSid:"",trackSids:[this.trackSid]})]});this.emit(M.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?yt.SubscriptionStatus.Unsubscribed:super.isSubscribed?yt.SubscriptionStatus.Subscribed:yt.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?yt.PermissionStatus.Allowed:yt.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,i;this.isManualOperationAllowed()&&(((t=this.videoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((i=this.videoDimensions)===null||i===void 0?void 0:i.height)===e.height||(this.track instanceof Qn&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof Qn&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(M.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(M.VisibilityChanged,this.handleVisibilityChange),r.off(M.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(M.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(M.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(M.VisibilityChanged,this.handleVisibilityChange),e.on(M.Ended,this.handleEnded),this.emit(M.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(M.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?M.Muted:M.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(M.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(M.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===w.Kind.Video&&this.isAdaptiveStream?(y.warn("adaptive stream is enabled, cannot change video track settings",{trackSid:this.trackSid}),!1):this.isDesired?!0:(y.warn("cannot update track settings when not subscribed",{trackSid:this.trackSid}),!1)}get isAdaptiveStream(){return this.track instanceof Qn&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new at({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=X.HIGH,this.emit(M.UpdateSettings,e)}}class ni extends fc{static fromParticipantInfo(e,t){return new ni(e,t.sid,t.identity,t.name,t.metadata)}constructor(e,t,i,r,s){super(t,i||"",r,s),this.signalClient=e,this.tracks=new Map,this.audioTracks=new Map,this.videoTracks=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(M.UpdateSettings,t=>{y.debug("send update settings",t),this.signalClient.sendUpdateTrackSettings(t)}),e.on(M.UpdateSubscription,t=>{t.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(M.SubscriptionPermissionChanged,t=>{this.emit(R.TrackSubscriptionPermissionChanged,e,t)}),e.on(M.SubscriptionStatusChanged,t=>{this.emit(R.TrackSubscriptionStatusChanged,e,t)}),e.on(M.Subscribed,t=>{this.emit(R.TrackSubscribed,t,e)}),e.on(M.Unsubscribed,t=>{this.emit(R.TrackUnsubscribed,t,e)}),e.on(M.SubscriptionFailed,t=>{this.emit(R.TrackSubscriptionFailed,e.trackSid,t)})}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w.Source.Microphone;this.volumeMap.set(t,e);const i=this.getTrack(t);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:w.Source.Microphone;const t=this.getTrack(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,i,r,s,a){let o=this.getTrackPublication(t);if(o||t.startsWith("TR")||this.tracks.forEach(u=>{!o&&e.kind===u.kind.toString()&&(o=u)}),!o){if(a===0){y.error("could not find published track",{participant:this.sid,trackSid:t}),this.emit(R.TrackSubscriptionFailed,t);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,i,r,s,a-1)},150);return}if(e.readyState==="ended"){y.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",{participant:this.sid,trackSid:t}),this.emit(R.TrackSubscriptionFailed,t);return}const l=e.kind==="video";let c;return l?c=new Qn(e,t,r,s):c=new Nn(e,t,r,this.audioContext,this.audioOutput),c.source=o.source,c.isMuted=o.isMuted,c.setMediaStream(i),c.start(),o.setTrack(c),this.volumeMap.has(o.source)&&c instanceof Nn&&c.setVolume(this.volumeMap.get(o.source)),o}get hasMetadata(){return!!this.participantInfo}getTrackPublication(e){return this.tracks.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,i=new Map;return e.tracks.forEach(r=>{var s;let a=this.getTrackPublication(r.sid);if(a)a.updateInfo(r);else{const o=w.kindFromProto(r.type);if(!o)return;a=new Ri(o,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.tracks.values()).find(c=>c.source===(a==null?void 0:a.source));l&&a.source!==w.Source.Unknown&&y.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),{oldTrack:l,newTrack:a,participant:this,participantInfo:e}),this.addTrackPublication(a)}t.set(r.sid,a)}),this.tracks.forEach(r=>{t.has(r.trackSid)||(y.trace("detected removed track on remote participant, unpublishing",{publication:r,participantSid:this.sid}),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(R.TrackPublished,r)}),!0}unpublishTrack(e,t){const i=this.tracks.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.tracks.delete(e),i.kind){case w.Kind.Audio:this.audioTracks.delete(e);break;case w.Kind.Video:this.videoTracks.delete(e);break}t&&this.emit(R.TrackUnpublished,i)}setAudioOutput(e){return T(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTracks.forEach(i=>{var r;i.track instanceof Nn&&t.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return y.trace("participant event",{participant:this.sid,event:e,args:i}),super.emit(e,...i)}}class ii extends fc{constructor(e,t,i,r){super(e,t),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=de.NONE,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new tc)},this.handleReconnected=()=>{var s,a;(a=(s=this.reconnectFuture)===null||s===void 0?void 0:s.resolve)===null||a===void 0||a.call(s),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var s,a;this.reconnectFuture&&(this.reconnectFuture.promise.catch(o=>y.warn(o)),(a=(s=this.reconnectFuture)===null||s===void 0?void 0:s.reject)===null||a===void 0||a.call(s,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.updateTrackSubscriptionPermissions=()=>{y.debug("updating track subscription permissions",{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions}),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(s=>qh(s)))},this.onTrackUnmuted=s=>{this.onTrackMuted(s,s.isUpstreamPaused)},this.onTrackMuted=(s,a)=>{if(a===void 0&&(a=!0),!s.sid){y.error("could not update mute status for unpublished track",s);return}this.engine.updateMuteStatus(s.sid,a)},this.onTrackUpstreamPaused=s=>{y.debug("upstream paused"),this.onTrackMuted(s,!0)},this.onTrackUpstreamResumed=s=>{y.debug("upstream resumed"),this.onTrackMuted(s,s.isMuted)},this.handleSubscribedQualityUpdate=s=>T(this,void 0,void 0,function*(){var a,o,l,c,u,h;if(!(!((u=this.roomOptions)===null||u===void 0)&&u.dynacast))return;const p=this.videoTracks.get(s.trackSid);if(!p){y.warn("received subscribed quality update for unknown track",{method:"handleSubscribedQualityUpdate",sid:s.trackSid});return}if(s.subscribedCodecs.length>0){if(!p.videoTrack)return;const S=yield p.videoTrack.setPublishingCodecs(s.subscribedCodecs);try{for(var v=!0,b=Cn(S),g;g=yield b.next(),a=g.done,!a;v=!0){c=g.value,v=!1;const k=c;Vd(k)&&(y.debug("publish ".concat(k," for ").concat(p.videoTrack.sid)),yield this.publishAdditionalCodecForTrack(p.videoTrack,k,p.options))}}catch(k){o={error:k}}finally{try{!v&&!a&&(l=b.return)&&(yield l.call(b))}finally{if(o)throw o.error}}}else s.subscribedQualities.length>0&&(yield(h=p.videoTrack)===null||h===void 0?void 0:h.setPublishingLayers(s.subscribedQualities))}),this.handleLocalTrackUnpublished=s=>{const a=this.tracks.get(s.trackSid);if(!a){y.warn("received unpublished event for unknown track",{method:"handleLocalTrackUnpublished",trackSid:s.trackSid});return}this.unpublishTrack(a.track)},this.handleTrackEnded=s=>T(this,void 0,void 0,function*(){if(s.source===w.Source.ScreenShare||s.source===w.Source.ScreenShareAudio)y.debug("unpublishing local track due to TrackEnded",{track:s.sid}),this.unpublishTrack(s);else if(s.isUserProvided)yield s.mute();else if(s instanceof pe||s instanceof Te)try{if(ye())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:s.source===w.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw y.warn("user has revoked access to ".concat(s.source)),a.onchange=()=>{a.state!=="denied"&&(s.isMuted||s.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}s.isMuted||(y.debug("track ended, attempting to use a different device"),yield s.restartTrack())}catch{y.warn("could not restart track, muting instead"),yield s.mute()}}),this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==de.NONE}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.client.onRemoteMuteChanged=(t,i)=>{const r=this.tracks.get(t);!r||!r.track||(i?r.mute():r.unmute())},this.engine.client.onSubscribedQualityUpdate=this.handleSubscribedQualityUpdate,this.engine.client.onLocalTrackUnpublished=this.handleLocalTrackUnpublished,this.engine.on(A.Connected,this.handleReconnected).on(A.Restarted,this.handleReconnected).on(A.Resumed,this.handleReconnected).on(A.Restarting,this.handleReconnecting).on(A.Resuming,this.handleReconnecting).on(A.Disconnected,this.handleDisconnected)}setMetadata(e){var t;this.engine.client.sendUpdateLocalMetadata(e,(t=this.name)!==null&&t!==void 0?t:"")}setName(e){var t;this.engine.client.sendUpdateLocalMetadata((t=this.metadata)!==null&&t!==void 0?t:"",e)}setCameraEnabled(e,t,i){return this.setTrackEnabled(w.Source.Camera,e,t,i)}setMicrophoneEnabled(e,t,i){return this.setTrackEnabled(w.Source.Microphone,e,t,i)}setScreenShareEnabled(e,t,i){return this.setTrackEnabled(w.Source.ScreenShare,e,t,i)}setPermissions(e){const t=this.permissions,i=super.setPermissions(e);return i&&t&&this.emit(R.ParticipantPermissionsChanged,t),i}setE2EEEnabled(e){return T(this,void 0,void 0,function*(){this.encryptionType=e?de.GCM:de.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,i,r){var s,a;return T(this,void 0,void 0,function*(){y.debug("setTrackEnabled",{source:e,enabled:t});let o=this.getTrack(e);if(t)if(o)yield o.unmute();else{let l;if(this.pendingPublishing.has(e)){y.info("skipping duplicate published source",{source:e});return}this.pendingPublishing.add(e);try{switch(e){case w.Source.Camera:l=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case w.Source.Microphone:l=yield this.createTracks({audio:(a=i)!==null&&a!==void 0?a:!0});break;case w.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Ze(e)}const c=[];for(const h of l)y.info("publishing track",{localTrack:h}),c.push(this.publishTrack(h,r));[o]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&!(c instanceof Ze)&&this.emit(R.MediaDevicesError,c),c}finally{this.pendingPublishing.delete(e)}}else if(o&&o.track)if(e===w.Source.ScreenShare){o=yield this.unpublishTrack(o.track);const l=this.getTrack(w.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield o.mute();return o})}enableCameraAndMicrophone(){return T(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(w.Source.Camera)||this.pendingPublishing.has(w.Source.Microphone))){this.pendingPublishing.add(w.Source.Camera),this.pendingPublishing.add(w.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(w.Source.Camera),this.pendingPublishing.delete(w.Source.Microphone)}}})}createTracks(e){var t,i;return T(this,void 0,void 0,function*(){const r=$o(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults),s=Fi(r);let a;try{a=yield navigator.mediaDevices.getUserMedia(s)}catch(o){throw o instanceof Error&&(s.audio&&(this.microphoneError=o),s.video&&(this.cameraError=o)),o}return s.audio&&(this.microphoneError=void 0),s.video&&(this.cameraError=void 0),a.getTracks().map(o=>{const l=o.kind==="audio";l?e.audio:e.video;let c;const u=l?s.audio:s.video;typeof u!="boolean"&&(c=u);const h=cc(o,c);return h.kind===w.Kind.Video?h.source=w.Source.Camera:h.kind===w.Kind.Audio&&(h.source=w.Source.Microphone),h.mediaStream=a,h})})}createScreenTracks(e){return T(this,void 0,void 0,function*(){if(e===void 0&&(e={}),e.resolution===void 0&&(e.resolution=es.h1080fps15.resolution),navigator.mediaDevices.getDisplayMedia===void 0)throw new Xr("getDisplayMedia not supported");const t=Hd(e),i=yield navigator.mediaDevices.getDisplayMedia(t),r=i.getVideoTracks();if(r.length===0)throw new Ze("no video track found");const s=new Te(r[0],void 0,!1);s.source=w.Source.ScreenShare;const a=[s];if(i.getAudioTracks().length>0){const o=new pe(i.getAudioTracks()[0],void 0,!1,this.audioContext);o.source=w.Source.ScreenShareAudio,a.push(o)}return a})}publishTrack(e,t){var i,r,s,a;return T(this,void 0,void 0,function*(){yield(i=this.reconnectFuture)===null||i===void 0?void 0:i.promise,e instanceof Dn&&this.pendingPublishPromises.has(e)&&(yield this.pendingPublishPromises.get(e));let o;if(e instanceof MediaStreamTrack)o=e.getConstraints();else{o=e.constraints;let v;switch(e.source){case w.Source.Microphone:v="audioinput";break;case w.Source.Camera:v="videoinput"}v&&this.activeDeviceMap.has(v)&&(o=Object.assign(Object.assign({},o),{deviceId:this.activeDeviceMap.get(v)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new pe(e,o,!0,this.audioContext);break;case"video":e=new Te(e,o,!0);break;default:throw new Ze("unsupported MediaStreamTrack kind ".concat(e.kind))}e instanceof pe&&e.setAudioContext(this.audioContext);let l;if(this.tracks.forEach(v=>{v.track&&v.track===e&&(l=v)}),l)return y.warn("track has already been published, skipping"),l;const c="channelCount"in e.mediaStreamTrack.getSettings()&&e.mediaStreamTrack.getSettings().channelCount===2||e.mediaStreamTrack.getConstraints().channelCount===2,u=(r=t==null?void 0:t.forceStereo)!==null&&r!==void 0?r:c;u&&(t||(t={}),t.dtx===void 0&&y.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work."),t.red===void 0&&y.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(s=t.dtx)!==null&&s!==void 0||(t.dtx=!1),(a=t.red)!==null&&a!==void 0||(t.red=!1));const h=Object.assign(Object.assign({},this.roomOptions.publishDefaults),t);Bi()&&this.roomOptions.e2ee&&(y.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari"),h.simulcast=!1),h.source&&(e.source=h.source);const p=this.publish(e,h,u);this.pendingPublishPromises.set(e,p);try{return yield p}catch(v){throw v}finally{this.pendingPublishPromises.delete(e)}})}publish(e,t,i){var r,s,a,o,l,c,u,h,p,v,b,g,S,k;return T(this,void 0,void 0,function*(){const C=Array.from(this.tracks.values()).find(U=>e instanceof Dn&&U.source===e.source);if(C&&e.source!==w.Source.Unknown)try{throw Error("publishing a second track with the same source: ".concat(e.source))}catch(U){U instanceof Error&&y.warn(U.message,{oldTrack:C,newTrack:e,trace:U.stack})}t.stopMicTrackOnMute&&e instanceof pe&&(e.stopOnMute=!0),e.source===w.Source.ScreenShare&&ei()&&(t.simulcast=!1),t.videoCodec==="av1"&&!$d()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!Qd()&&(t.videoCodec=void 0),e.on(M.Muted,this.onTrackMuted),e.on(M.Unmuted,this.onTrackUnmuted),e.on(M.Ended,this.handleTrackEnded),e.on(M.UpstreamPaused,this.onTrackUpstreamPaused),e.on(M.UpstreamResumed,this.onTrackUpstreamResumed);const I=new Ve({cid:e.mediaStreamTrack.id,name:t.name,type:w.kindToProto(e.kind),muted:e.isMuted,source:w.sourceToProto(e.source),disableDtx:!(!((r=t.dtx)!==null&&r!==void 0)||r),encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=t.red)!==null&&s!==void 0)||s)});let E,D;if(e.kind===w.Kind.Video){let U={width:0,height:0};try{U=yield e.waitForDimensions()}catch{const ke=(o=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&o!==void 0?o:Xn.h720.resolution;U={width:ke.width,height:ke.height},y.error("could not determine track dimensions, using defaults",U)}if(I.width=U.width,I.height=U.height,e instanceof Te)if(Kn(t.videoCodec)&&(t.scalabilityMode=(l=t.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),t.videoCodec&&t.backupCodec&&t.videoCodec!==t.backupCodec.codec){this.roomOptions.dynacast||(this.roomOptions.dynacast=!0);const q=Object.assign({},t);q.simulcast=!0,D=ia(e,t.backupCodec.codec,q),I.simulcastCodecs=[new _e({codec:t.videoCodec,cid:e.mediaStreamTrack.id,enableSimulcastLayers:!0}),new _e({codec:t.backupCodec.codec,cid:"",enableSimulcastLayers:!0})]}else t.videoCodec&&(I.simulcastCodecs=[new _e({codec:t.videoCodec,cid:e.mediaStreamTrack.id,enableSimulcastLayers:(c=t.simulcast)!==null&&c!==void 0?c:!1})]);E=lc(e.source===w.Source.ScreenShare,U.width,U.height,t),I.layers=oa(I.width,I.height,E,Kn(t.videoCodec))}else e.kind===w.Kind.Audio&&(E=[{maxBitrate:(h=(u=t.audioPreset)===null||u===void 0?void 0:u.maxBitrate)!==null&&h!==void 0?h:t.audioBitrate,priority:(v=(p=t.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&v!==void 0?v:"high",networkPriority:(g=(b=t.audioPreset)===null||b===void 0?void 0:b.priority)!==null&&g!==void 0?g:"high"}]);if(!this.engine||this.engine.isClosed)throw new re("cannot publish track when not connected");const L=yield this.engine.addTrack(I);let V=!1,B=!1;if(L.codecs.forEach(U=>{Ls(U.mimeType,t.videoCodec)?V=!0:t.backupCodec&&Ls(U.mimeType,t.backupCodec.codec)&&(B=!0)}),I.simulcastCodecs.length>0){if(!V&&!B)throw Error("cannot publish track, codec not supported by server");if(!V&&t.backupCodec){const U=t.backupCodec;t=Object.assign({},t),y.debug("primary codec ".concat(t.videoCodec," not supported, fallback to ").concat(U.codec)),t.videoCodec=U.codec,t.videoEncoding=U.encoding,E=D}}const N=new ti(e.kind,L,e);if(N.options=t,e.sid=L.sid,!this.engine.publisher)throw new re("publisher is closed");if(y.debug("publishing ".concat(e.kind," with encodings"),{encodings:E,trackInfo:L}),e.sender=yield this.engine.createSender(e,t,E),E)if(ei()&&e.kind===w.Kind.Audio){let U;for(const q of this.engine.publisher.pc.getTransceivers())if(q.sender===e.sender){U=q;break}U&&this.engine.publisher.setTrackCodecBitrate({transceiver:U,codec:"opus",maxbr:!((S=E[0])===null||S===void 0)&&S.maxBitrate?E[0].maxBitrate/1e3:0})}else e.codec&&Kn(e.codec)&&(!((k=E[0])===null||k===void 0)&&k.maxBitrate)&&this.engine.publisher.setTrackCodecBitrate({cid:I.cid,codec:e.codec,maxbr:E[0].maxBitrate/1e3});return yield this.engine.negotiate(),e instanceof Te?e.startMonitor(this.engine.client):e instanceof pe&&e.startMonitor(),this.addTrackPublication(N),this.emit(R.LocalTrackPublished,N),N})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,i){var r;return T(this,void 0,void 0,function*(){let s;if(this.tracks.forEach(h=>{h.track&&h.track===e&&(s=h)}),!s)throw new Ze("track is not published");if(!(e instanceof Te))throw new Ze("track is not a video track");const a=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),o=ia(e,t,a);if(!o){y.info("backup codec has been disabled, ignoring request to add additional codec for track");return}const l=e.addSimulcastTrack(t,o),c=new Ve({cid:l.mediaStreamTrack.id,type:w.kindToProto(e.kind),muted:e.isMuted,source:w.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:l.mediaStreamTrack.id,enableSimulcastLayers:a.simulcast}]});if(c.layers=oa(c.width,c.height,o),!this.engine||this.engine.isClosed)throw new re("cannot publish track when not connected");const u=yield this.engine.addTrack(c);yield this.engine.createSimulcastSender(e,l,a,o),yield this.engine.negotiate(),y.debug("published ".concat(t," for track ").concat(e.sid),{encodings:o,trackInfo:u})})}unpublishTrack(e,t){var i,r;return T(this,void 0,void 0,function*(){const s=this.getPublicationForTrack(e);if(y.debug("unpublishing track",{track:e,method:"unpublishTrack"}),!s||!s.track){y.warn("track was not unpublished because no publication was found",{track:e,method:"unpublishTrack"});return}e=s.track,e.off(M.Muted,this.onTrackMuted),e.off(M.Unmuted,this.onTrackUnmuted),e.off(M.Ended,this.handleTrackEnded),e.off(M.UpstreamPaused,this.onTrackUpstreamPaused),e.off(M.UpstreamResumed,this.onTrackUpstreamResumed),t===void 0&&(t=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),t&&e.stop();let a=!1;const o=e.sender;if(e.sender=void 0,this.engine.publisher&&this.engine.publisher.pc.connectionState!=="closed"&&o)try{for(const l of this.engine.publisher.pc.getTransceivers())l.sender===o&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(o)&&(a=!0),e instanceof Te){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){y.warn("failed to unpublish track",{error:l,method:"unpublishTrack"})}switch(this.tracks.delete(s.trackSid),s.kind){case w.Kind.Audio:this.audioTracks.delete(s.trackSid);break;case w.Kind.Video:this.videoTracks.delete(s.trackSid);break}return this.emit(R.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return T(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>i instanceof ti)})}republishAllTracks(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return T(this,void 0,void 0,function*(){const i=[];this.tracks.forEach(r=>{r.track&&(e&&(r.options=Object.assign(Object.assign({},r.options),e)),i.push(r))}),yield Promise.all(i.map(r=>T(this,void 0,void 0,function*(){const s=r.track;yield this.unpublishTrack(s,!1),t&&!s.isMuted&&(s instanceof pe||s instanceof Te)&&!s.isUserProvided&&(y.debug("restarting existing track",{track:r.trackSid}),yield s.restartTrack()),yield this.publishTrack(s,r.options)})))})}publishData(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return T(this,void 0,void 0,function*(){const r=Array.isArray(i)?i:i==null?void 0:i.destination,s=[],a=Array.isArray(i)?void 0:i.topic;r!==void 0&&r.forEach(l=>{l instanceof ni?s.push(l.sid):s.push(l)});const o=new Xe({kind:t,value:{case:"user",value:new tt({participantSid:this.sid,payload:e,destinationSids:s,topic:a})}});yield this.engine.sendDataPacket(o,t)})}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isConnected&&this.updateTrackSubscriptionPermissions()}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(t=>{var i,r;const s=this.tracks.get(t.sid);if(s){const a=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);a!==t.muted&&(y.debug("updating server mute state after reconcile",{sid:t.sid,muted:a}),this.engine.client.sendMuteTrack(t.sid,a))}}),!0)}getPublicationForTrack(e){let t;return this.tracks.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(r instanceof pe||r instanceof Te)&&r.mediaStreamTrack===e&&(t=i):e===r&&(t=i))}),t}publishedTracksInfo(){const e=[];return this.tracks.forEach(t=>{t.track!==void 0&&e.push(new We({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}dataChannelsInfo(){const e=[],t=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new ft({label:i.label,id:i.id,target:r}))};return t(this.engine.dataChannelForKind(Z.LOSSY),be.PUBLISHER),t(this.engine.dataChannelForKind(Z.RELIABLE),be.PUBLISHER),t(this.engine.dataChannelForKind(Z.LOSSY,!0),be.SUBSCRIBER),t(this.engine.dataChannelForKind(Z.RELIABLE,!0),be.SUBSCRIBER),e}}var F;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting"})(F||(F={}));const zh=2*1e3;class Ni extends vt.EventEmitter{constructor(e){var t,i;super(),t=this,this.state=F.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.connect=(r,s,a)=>T(this,void 0,void 0,function*(){var o;const l=yield this.disconnectLock.lock();if(this.state===F.Connected)return y.info("already connected to room ".concat(this.name)),l(),Promise.resolve();if(this.connectFuture)return l(),this.connectFuture.promise;this.setAndEmitConnectionState(F.Connecting),((o=this.regionUrlProvider)===null||o===void 0?void 0:o.getServerUrl().toString())!==r&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Mr(new URL(r))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new na(r,s):this.regionUrlProvider.updateToken(s),this.regionUrlProvider.fetchRegionSettings().catch(h=>{y.warn("could not fetch region settings",{error:h})}));const c=(h,p,v)=>T(this,void 0,void 0,function*(){var b;this.abortController&&this.abortController.abort();const g=new AbortController;this.abortController=g,l==null||l();try{yield this.attemptConnection(v??r,s,a,g),this.abortController=void 0,h()}catch(S){if(this.regionUrlProvider&&S instanceof G&&S.reason!==3&&S.reason!==0){let k=null;try{k=yield this.regionUrlProvider.getNextBestRegionUrl((b=this.abortController)===null||b===void 0?void 0:b.signal)}catch(C){if(C instanceof G&&(C.status===401||C.reason===3)){p(C);return}}k?(y.info("initial connection failed, retrying with another region",{nextUrl:k}),yield c(h,p,k)):p(S)}else p(S)}}),u=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new tc((h,p)=>{c(h,p,u)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(r,s,a,o,l,c)=>T(this,void 0,void 0,function*(){const u=yield a.join(r,s,{autoSubscribe:o.autoSubscribe,publishOnly:o.publishOnly,adaptiveStream:typeof l.adaptiveStream=="object"?!0:l.adaptiveStream,maxRetries:o.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:o.websocketTimeout},c.signal);let h=u.serverInfo;if(h||(h={version:u.serverVersion,region:u.serverRegion}),y.debug("connected to Livekit Server ".concat(Object.entries(h).map(p=>{let[v,b]=p;return"".concat(v,": ").concat(b)}).join(", "))),!u.serverVersion)throw new Od("unknown server version");return u.serverVersion==="0.15.1"&&this.options.dynacast&&(y.debug("disabling dynacast due to server version"),l.dynacast=!1),u}),this.applyJoinResponse=r=>{const s=r.participant;this.localParticipant.sid=s.sid,this.localParticipant.identity=s.identity,this.handleParticipantUpdates([s,...r.otherParticipants]),r.room&&this.handleRoomUpdate(r.room),this.options.e2ee&&this.e2eeManager&&this.e2eeManager.setSifTrailer(r.sifTrailer)},this.attemptConnection=(r,s,a,o)=>T(this,void 0,void 0,function*(){var l,c;this.state===F.Reconnecting?(y.info("Reconnection attempt replaced by new connection attempt"),this.recreateEngine()):this.maybeCreateEngine(),!((l=this.regionUrlProvider)===null||l===void 0)&&l.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},oc),a),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const u=yield this.connectSignal(r,s,this.engine,this.connOptions,this.options,o);this.applyJoinResponse(u),this.setupLocalParticipantEvents(),this.emit(x.SignalConnected)}catch(u){this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish);const h=new G("could not establish signal connection");throw u instanceof Error&&(h.message="".concat(h.message,": ").concat(u.message)),u instanceof G&&(h.reason=u.reason,h.status=u.status),y.debug("error trying to establish signal connection",{error:u}),h}if(o.signal.aborted)throw this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),new G("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,o)}catch(u){throw this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),u}ye()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ye()&&(document.addEventListener("freeze",this.onPageLeave),(c=navigator.mediaDevices)===null||c===void 0||c.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(F.Connected),this.emit(x.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return T(t,void 0,void 0,function*(){var s,a,o,l;const c=yield this.disconnectLock.lock();try{if(this.state===F.Disconnected){y.debug("already disconnected");return}y.info("disconnect from room",{identity:this.localParticipant.identity}),(this.state===F.Connecting||this.state===F.Reconnecting)&&(y.warn("abort connection attempt"),(s=this.abortController)===null||s===void 0||s.abort(),(o=(a=this.connectFuture)===null||a===void 0?void 0:a.reject)===null||o===void 0||o.call(a,new G("Client initiated disconnect")),this.connectFuture=void 0),!((l=this.engine)===null||l===void 0)&&l.client.isConnected&&(yield this.engine.client.sendLeave()),this.engine&&(yield this.engine.close()),this.handleDisconnect(r,Wt.CLIENT_INITIATED),this.engine=void 0}finally{c()}})},this.onPageLeave=()=>T(this,void 0,void 0,function*(){yield this.disconnect()}),this.handleRestarting=()=>{this.clearConnectionReconcile();for(const r of this.participants.values())this.handleParticipantDisconnected(r.sid,r);this.setAndEmitConnectionState(F.Reconnecting)&&this.emit(x.Reconnecting)},this.handleSignalRestarted=r=>T(this,void 0,void 0,function*(){y.debug("signal reconnected to server",{region:r.serverRegion}),this.cachedParticipantSids=[],this.applyJoinResponse(r);try{const s=[];this.localParticipant.tracks.forEach(a=>{a.track&&s.push(a)}),yield Promise.all(s.map(a=>T(this,void 0,void 0,function*(){const o=a.track;this.localParticipant.unpublishTrack(o,!1),o.isMuted||((o instanceof pe||o instanceof Te)&&o.source!==w.Source.ScreenShare&&o.source!==w.Source.ScreenShareAudio&&!o.isUserProvided&&(y.debug("restarting existing track",{track:a.trackSid}),yield o.restartTrack()),y.debug("publishing new track",{track:a.trackSid}),yield this.localParticipant.publishTrack(o,a.options))})))}catch(s){y.error("error trying to re-publish tracks after reconnection",{error:s})}try{yield this.engine.waitForRestarted(),y.debug("fully reconnected to server",{region:r.serverRegion})}catch{return}this.setAndEmitConnectionState(F.Connected),this.emit(x.Reconnected),this.registerConnectionReconcile(),this.participants.forEach(s=>{this.emit(x.ParticipantConnected,s)})}),this.handleParticipantUpdates=r=>{r.forEach(s=>{if(s.identity===this.localParticipant.identity){this.localParticipant.updateInfo(s);return}const a=this.identityToSid.get(s.identity);a&&a!==s.sid&&this.handleParticipantDisconnected(a,this.participants.get(a));let o=this.participants.get(s.sid);const l=!o;s.state===bn.DISCONNECTED?this.handleParticipantDisconnected(s.sid,o):(o=this.getOrCreateParticipant(s.sid,s),l||o.updateInfo(s))})},this.handleActiveSpeakersUpdate=r=>{const s=[],a={};r.forEach(o=>{if(a[o.sid]=!0,o.sid===this.localParticipant.sid)this.localParticipant.audioLevel=o.level,this.localParticipant.setIsSpeaking(!0),s.push(this.localParticipant);else{const l=this.participants.get(o.sid);l&&(l.audioLevel=o.level,l.setIsSpeaking(!0),s.push(l))}}),a[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.participants.forEach(o=>{a[o.sid]||(o.audioLevel=0,o.setIsSpeaking(!1))}),this.activeSpeakers=s,this.emitWhenConnected(x.ActiveSpeakersChanged,s)},this.handleSpeakersChanged=r=>{const s=new Map;this.activeSpeakers.forEach(o=>{s.set(o.sid,o)}),r.forEach(o=>{let l=this.participants.get(o.sid);o.sid===this.localParticipant.sid&&(l=this.localParticipant),l&&(l.audioLevel=o.level,l.setIsSpeaking(o.active),o.active?s.set(o.sid,l):s.delete(o.sid))});const a=Array.from(s.values());a.sort((o,l)=>l.audioLevel-o.audioLevel),this.activeSpeakers=a,this.emitWhenConnected(x.ActiveSpeakersChanged,a)},this.handleStreamStateUpdate=r=>{r.streamStates.forEach(s=>{const a=this.participants.get(s.participantSid);if(!a)return;const o=a.getTrackPublication(s.trackSid);!o||!o.track||(o.track.streamState=w.streamStateFromProto(s.state),a.emit(R.TrackStreamStateChanged,o,o.track.streamState),this.emitWhenConnected(x.TrackStreamStateChanged,o,o.track.streamState,a))})},this.handleSubscriptionPermissionUpdate=r=>{const s=this.participants.get(r.participantSid);if(!s)return;const a=s.getTrackPublication(r.trackSid);a&&a.setAllowed(r.allowed)},this.handleSubscriptionError=r=>{const s=Array.from(this.participants.values()).find(o=>o.tracks.has(r.trackSid));if(!s)return;const a=s.getTrackPublication(r.trackSid);a&&a.setSubscriptionError(r.err)},this.handleDataPacket=(r,s)=>{const a=this.participants.get(r.participantSid);this.emit(x.DataReceived,r.payload,a,s,r.topic),a==null||a.emit(R.DataReceived,r.payload,s)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(x.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=r=>{y.warn("could not playback audio",r),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(x.AudioPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>T(this,void 0,void 0,function*(){this.emit(x.MediaDevicesChanged)}),this.handleRoomUpdate=r=>{const s=this.roomInfo;this.roomInfo=r,s&&s.metadata!==r.metadata&&this.emitWhenConnected(x.RoomMetadataChanged,r.metadata),(s==null?void 0:s.activeRecording)!==r.activeRecording&&this.emitWhenConnected(x.RecordingStatusChanged,r.activeRecording)},this.handleConnectionQualityUpdate=r=>{r.updates.forEach(s=>{if(s.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(s.quality);return}const a=this.participants.get(s.participantSid);a&&a.setConnectionQuality(s.quality)})},this.onLocalParticipantMetadataChanged=r=>{this.emit(x.ParticipantMetadataChanged,r,this.localParticipant)},this.onLocalParticipantNameChanged=r=>{this.emit(x.ParticipantNameChanged,r,this.localParticipant)},this.onLocalTrackMuted=r=>{this.emit(x.TrackMuted,r,this.localParticipant)},this.onLocalTrackUnmuted=r=>{this.emit(x.TrackUnmuted,r,this.localParticipant)},this.onLocalTrackPublished=r=>T(this,void 0,void 0,function*(){var s;this.emit(x.LocalTrackPublished,r,this.localParticipant),r.track instanceof pe&&(yield r.track.checkForSilence())&&this.emit(x.LocalAudioSilenceDetected,r);const a=yield(s=r.track)===null||s===void 0?void 0:s.getDeviceId(),o=Wd(r.source);o&&a&&a!==this.localParticipant.activeDeviceMap.get(o)&&(this.localParticipant.activeDeviceMap.set(o,a),this.emit(x.ActiveDeviceChanged,o,a))}),this.onLocalTrackUnpublished=r=>{this.emit(x.LocalTrackUnpublished,r,this.localParticipant)},this.onLocalConnectionQualityChanged=r=>{this.emit(x.ConnectionQualityChanged,r,this.localParticipant)},this.onMediaDevicesError=r=>{this.emit(x.MediaDevicesError,r)},this.onLocalParticipantPermissionsChanged=r=>{this.emit(x.ParticipantPermissionsChanged,r,this.localParticipant)},this.setMaxListeners(100),this.participants=new Map,this.cachedParticipantSids=[],this.identityToSid=new Map,this.options=Object.assign(Object.assign({},Ph),e),this.options.audioCaptureDefaults=Object.assign(Object.assign({},sc),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},ac),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},xh),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Ht,this.localParticipant=new ii("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",gn(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",gn(this.options.audioCaptureDefaults.deviceId)),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&this.switchActiveDevice("audiooutput",gn(this.options.audioOutput.deviceId)),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return T(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&(this.e2eeManager=new gh(this.options.e2ee),this.e2eeManager.on(sn.ParticipantEncryptionStatusChanged,(t,i)=>{i instanceof ii&&(this.isE2EEEnabled=t),this.emit(x.ParticipantEncryptionStatusChanged,t,i)}),this.e2eeManager.on(sn.EncryptionError,t=>this.emit(x.EncryptionError,t)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}get sid(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.sid)!==null&&t!==void 0?t:""}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Nh(this.options),this.engine.on(A.ParticipantUpdate,this.handleParticipantUpdates).on(A.RoomUpdate,this.handleRoomUpdate).on(A.SpeakersChanged,this.handleSpeakersChanged).on(A.StreamStateChanged,this.handleStreamStateUpdate).on(A.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(A.SubscriptionError,this.handleSubscriptionError).on(A.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(A.MediaTrackAdded,(e,t,i)=>{this.onTrackAdded(e,t,i)}).on(A.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(A.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(A.DataPacketReceived,this.handleDataPacket).on(A.Resuming,()=>{this.clearConnectionReconcile(),this.setAndEmitConnectionState(F.Reconnecting)&&this.emit(x.Reconnecting),this.cachedParticipantSids=Array.from(this.participants.keys())}).on(A.Resumed,()=>{this.setAndEmitConnectionState(F.Connected),this.emit(x.Reconnected),this.registerConnectionReconcile(),this.updateSubscriptions(),Array.from(this.participants.values()).filter(t=>!this.cachedParticipantSids.includes(t.sid)).forEach(t=>this.emit(x.ParticipantConnected,t)),this.cachedParticipantSids=[]}).on(A.SignalResumed,()=>{this.state===F.Reconnecting&&this.sendSyncState()}).on(A.Restarting,this.handleRestarting).on(A.SignalRestarted,this.handleSignalRestarted).on(A.DCBufferStatusChanged,(e,t)=>{this.emit(x.DCBufferStatusChanged,e,t)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return ue.getInstance().getDevices(e,t)}prepareConnection(e,t){return T(this,void 0,void 0,function*(){if(this.state===F.Disconnected){y.debug("prepareConnection to ".concat(e));try{if(Mr(new URL(e))&&t){this.regionUrlProvider=new na(e,t);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===F.Disconnected&&(this.regionUrl=i,yield fetch(zs(i),{method:"HEAD"}),y.debug("prepared connection to ".concat(i)))}else yield fetch(zs(e),{method:"HEAD"})}catch(i){y.warn("could not prepare connection",{error:i})}}})}getParticipantByIdentity(e){if(this.localParticipant.identity===e)return this.localParticipant;const t=this.identityToSid.get(e);if(t)return this.participants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return T(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new le({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new le({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new le({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new le({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new le({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>T(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new Ae({reason:Wt.CLIENT_INITIATED,canReconnect:!0}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new le({scenario:{case:"subscriberBandwidth",value:BigInt(t)}});break}r&&(this.engine.client.sendSimulateScenario(r),i())})}startAudio(){return T(this,void 0,void 0,function*(){const e=[],t=Ln();if(t&&t.os==="iOS"){const i="livekit-dummy-audio-el";let r=document.getElementById(i);if(!r){r=document.createElement("audio"),r.id=i,r.autoplay=!0,r.hidden=!0;const s=tr();s.enabled=!0;const a=new MediaStream([s]);r.srcObject=a,document.addEventListener("visibilitychange",()=>{r&&(r.srcObject=document.hidden?null:a)}),document.body.append(r),this.once(x.Disconnected,()=>{r==null||r.remove()})}e.push(r)}this.participants.forEach(i=>{i.audioTracks.forEach(r=>{r.track&&r.track.attachedElements.forEach(s=>{e.push(s)})})});try{yield Promise.all([this.acquireAudioContext(),...e.map(i=>(i.muted=!1,i.play()))]),this.handleAudioPlaybackStarted()}catch(i){throw this.handleAudioPlaybackFailed(i),i}})}get canPlaybackAudio(){return this.audioEnabled}getActiveAudioOutputDevice(){var e,t;return(t=(e=this.options.audioOutput)===null||e===void 0?void 0:e.deviceId)!==null&&t!==void 0?t:""}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;var r,s,a;return T(this,void 0,void 0,function*(){let o=!1,l=!0;const c=i?{exact:t}:t;if(e==="audioinput"){const u=this.options.audioCaptureDefaults.deviceId;this.options.audioCaptureDefaults.deviceId=c,o=u!==c;const h=Array.from(this.localParticipant.audioTracks.values()).filter(p=>p.source===w.Source.Microphone);try{l=(yield Promise.all(h.map(p=>{var v;return(v=p.audioTrack)===null||v===void 0?void 0:v.setDeviceId(c)}))).every(p=>p===!0)}catch(p){throw this.options.audioCaptureDefaults.deviceId=u,p}}else if(e==="videoinput"){const u=this.options.videoCaptureDefaults.deviceId;this.options.videoCaptureDefaults.deviceId=c,o=u!==c;const h=Array.from(this.localParticipant.videoTracks.values()).filter(p=>p.source===w.Source.Camera);try{l=(yield Promise.all(h.map(p=>{var v;return(v=p.videoTrack)===null||v===void 0?void 0:v.setDeviceId(c)}))).every(p=>p===!0)}catch(p){throw this.options.videoCaptureDefaults.deviceId=u,p}}else if(e==="audiooutput"){if(!Ir()&&!this.options.expWebAudioMix||this.options.expWebAudioMix&&this.audioContext&&!("setSinkId"in this.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");(r=(a=this.options).audioOutput)!==null&&r!==void 0||(a.audioOutput={});const u=this.options.audioOutput.deviceId;this.options.audioOutput.deviceId=t,o=u!==c;try{this.options.expWebAudioMix?(s=this.audioContext)===null||s===void 0||s.setSinkId(t):yield Promise.all(Array.from(this.participants.values()).map(h=>h.setAudioOutput({deviceId:t})))}catch(h){throw this.options.audioOutput.deviceId=u,h}}return o&&l&&(this.localParticipant.activeDeviceMap.set(e,t),this.emit(x.ActiveDeviceChanged,e,t)),l})}setupLocalParticipantEvents(){this.localParticipant.on(R.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(R.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(R.TrackMuted,this.onLocalTrackMuted).on(R.TrackUnmuted,this.onLocalTrackUnmuted).on(R.LocalTrackPublished,this.onLocalTrackPublished).on(R.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(R.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(R.MediaDevicesError,this.onMediaDevicesError).on(R.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.participants.clear(),this.maybeCreateEngine()}onTrackAdded(e,t,i){if(this.state===F.Connecting||this.state===F.Reconnecting){const c=()=>{this.onTrackAdded(e,t,i),u()},u=()=>{this.off(x.Reconnected,c),this.off(x.Connected,c),this.off(x.Disconnected,u)};this.once(x.Reconnected,c),this.once(x.Connected,c),this.once(x.Disconnected,u);return}if(this.state===F.Disconnected){y.warn("skipping incoming track after Room disconnected");return}const r=Kd(t.id),s=r[0];let a=r[1];if((!a||a==="")&&(a=e.id),s===this.localParticipant.sid){y.warn("tried to create RemoteParticipant for local participant");return}const o=this.participants.get(s);if(!o){y.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s));return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),o.addSubscribedMediaTrack(e,a,t,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.state!==F.Disconnected){this.regionUrl=void 0;try{this.participants.forEach(r=>{r.tracks.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.tracks.forEach(r=>{var s,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e&&((s=r.track)===null||s===void 0||s.detach(),(a=r.track)===null||a===void 0||a.stop())}),this.localParticipant.off(R.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(R.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(R.TrackMuted,this.onLocalTrackMuted).off(R.TrackUnmuted,this.onLocalTrackUnmuted).off(R.LocalTrackPublished,this.onLocalTrackPublished).off(R.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(R.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(R.MediaDevicesError,this.onMediaDevicesError).off(R.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.expWebAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ye()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(F.Disconnected),this.emit(x.Disconnected,t)}}}handleParticipantDisconnected(e,t){this.participants.delete(e),t&&(this.identityToSid.delete(t.identity),t.tracks.forEach(i=>{t.unpublishTrack(i.trackSid,!0)}),this.emit(x.ParticipantDisconnected,t))}acquireAudioContext(){var e,t;return T(this,void 0,void 0,function*(){if(typeof this.options.expWebAudioMix!="boolean"&&this.options.expWebAudioMix.audioContext?this.audioContext=this.options.expWebAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Qo())!==null&&e!==void 0?e:void 0),this.audioContext&&this.audioContext.state==="suspended")try{yield this.audioContext.resume()}catch(r){y.warn(r)}this.options.expWebAudioMix&&this.participants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext);const i=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(x.AudioPlaybackStatusChanged,i))})}createParticipant(e,t){let i;return t?i=ni.fromParticipantInfo(this.engine.client,t):i=new ni(this.engine.client,e,"",void 0,void 0),this.options.expWebAudioMix&&i.setAudioContext(this.audioContext),i}getOrCreateParticipant(e,t){if(this.participants.has(e))return this.participants.get(e);const i=this.createParticipant(e,t);return this.participants.set(e,i),this.identityToSid.set(t.identity,t.sid),this.emitWhenConnected(x.ParticipantConnected,i),i.on(R.TrackPublished,r=>{this.emitWhenConnected(x.TrackPublished,r,i)}).on(R.TrackSubscribed,(r,s)=>{r.kind===w.Kind.Audio&&(r.on(M.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(M.AudioPlaybackFailed,this.handleAudioPlaybackFailed)),this.emit(x.TrackSubscribed,r,s,i)}).on(R.TrackUnpublished,r=>{this.emit(x.TrackUnpublished,r,i)}).on(R.TrackUnsubscribed,(r,s)=>{this.emit(x.TrackUnsubscribed,r,s,i)}).on(R.TrackSubscriptionFailed,r=>{this.emit(x.TrackSubscriptionFailed,r,i)}).on(R.TrackMuted,r=>{this.emitWhenConnected(x.TrackMuted,r,i)}).on(R.TrackUnmuted,r=>{this.emitWhenConnected(x.TrackUnmuted,r,i)}).on(R.ParticipantMetadataChanged,r=>{this.emitWhenConnected(x.ParticipantMetadataChanged,r,i)}).on(R.ParticipantNameChanged,r=>{this.emitWhenConnected(x.ParticipantNameChanged,r,i)}).on(R.ConnectionQualityChanged,r=>{this.emitWhenConnected(x.ConnectionQualityChanged,r,i)}).on(R.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(x.ParticipantPermissionsChanged,r,i)}).on(R.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(x.TrackSubscriptionStatusChanged,r,s,i)}).on(R.TrackSubscriptionFailed,(r,s)=>{this.emit(x.TrackSubscriptionFailed,r,i,s)}).on(R.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(x.TrackSubscriptionPermissionChanged,r,s,i)}),t&&i.updateInfo(t),i}sendSyncState(){var e,t;if(this.engine.subscriber===void 0||this.engine.subscriber.pc.localDescription===null)return;const i=this.engine.subscriber.pc.localDescription,r=this.engine.subscriber.pc.remoteDescription,s=(t=(e=this.connOptions)===null||e===void 0?void 0:e.autoSubscribe)!==null&&t!==void 0?t:!0,a=new Array;this.participants.forEach(o=>{o.tracks.forEach(l=>{l.isDesired!==s&&a.push(l.trackSid)})}),this.engine.client.sendSyncState(new ht({answer:Pi({sdp:i.sdp,type:i.type}),offer:r?Pi({sdp:r.sdp,type:r.type}):void 0,subscription:new De({trackSids:a,subscribe:!s,participantTracks:[]}),publishTracks:this.localParticipant.publishedTracksInfo(),dataChannels:this.localParticipant.dataChannelsInfo()}))}updateSubscriptions(){for(const e of this.participants.values())for(const t of e.videoTracks.values())t.isSubscribed&&t instanceof Ri&&t.emitTrackUpdate()}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=oe.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,y.warn("detected connection state mismatch",{numFailures:e}),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Wt.STATE_MISMATCH))):e=0},zh)}clearConnectionReconcile(){this.connectionReconcileInterval&&oe.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(x.ConnectionStateChanged,this.state),!0)}emitWhenConnected(e){if(this.state===F.Connected){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return this.emit(e,...i)}return!1}simulateParticipants(e){var t,i;return T(this,void 0,void 0,function*(){const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new An({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:j.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ce({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(x.SignalConnected),this.emit(x.Connected),this.setAndEmitConnectionState(F.Connected),r.video){const a=new ti(w.Kind.Video,new ve({source:$.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ae.AUDIO,name:"video-dummy"}),new Te(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:qs((t=160*s.aspectRatios[0])!==null&&t!==void 0?t:1,160,!0,!0)));this.localParticipant.addTrackPublication(a),this.localParticipant.emit(R.LocalTrackPublished,a)}if(r.audio){const a=new ti(w.Kind.Audio,new ve({source:$.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ae.AUDIO}),new pe(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:tr()));this.localParticipant.addTrackPublication(a),this.localParticipant.emit(R.LocalTrackPublished,a)}for(let a=0;a<s.count-1;a+=1){let o=new Ce({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:bn.ACTIVE,tracks:[],joinedAt:j.parse(Date.now())});const l=this.getOrCreateParticipant(o.identity,o);if(s.video){const c=qs((i=160*s.aspectRatios[a%s.aspectRatios.length])!==null&&i!==void 0?i:1,160,!1,!0),u=new ve({source:$.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:ae.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c])),o.tracks=[...o.tracks,u]}if(s.audio){const c=tr(),u=new ve({source:$.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:ae.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c])),o.tracks=[...o.tracks,u]}l.updateInfo(o)}})}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return e!==x.ActiveSpeakersChanged&&y.debug("room event ".concat(e),{event:e,args:i}),super.emit(e,...i)}}var Be;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(Be||(Be={}));class Un extends vt.EventEmitter{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Be.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=e,this.token=t,this.name=this.constructor.name,this.room=new Ni(i.roomOptions),this.connectOptions=i.connectOptions,i.errorsAsWarnings&&(this.errorsAsWarnings=i.errorsAsWarnings)}run(e){return T(this,void 0,void 0,function*(){if(this.status!==Be.IDLE)throw Error("check is running already");this.setStatus(Be.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==Be.SKIPPED&&this.setStatus(this.isSuccess()?Be.SUCCESS:Be.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(){return T(this,void 0,void 0,function*(){return this.room.state===F.Connected?this.room:(yield this.room.connect(this.url,this.token),this.room)})}disconnect(){return T(this,void 0,void 0,function*(){this.room&&this.room.state!==F.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Be.SKIPPED)}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function pc(n){var e,t;return T(this,void 0,void 0,function*(){n??(n={}),(e=n.audio)!==null&&e!==void 0||(n.audio=!0),(t=n.video)!==null&&t!==void 0||(n.video=!0);const i=$o(n,sc,ac),r=Fi(i),s=navigator.mediaDevices.getUserMedia(r);n.audio&&(ue.userMediaPromiseMap.set("audioinput",s),s.catch(()=>ue.userMediaPromiseMap.delete("audioinput"))),n.video&&(ue.userMediaPromiseMap.set("videoinput",s),s.catch(()=>ue.userMediaPromiseMap.delete("videoinput")));const a=yield s;return a.getTracks().map(o=>{const l=o.kind==="audio";l?n.audio:n.video;let c;const u=l?r.audio:r.video;typeof u!="boolean"&&(c=u),c?c.deviceId=o.getSettings().deviceId:c={deviceId:o.getSettings().deviceId};const h=cc(o,c);return h.kind===w.Kind.Video?h.source=w.Source.Camera:h.kind===w.Kind.Audio&&(h.source=w.Source.Microphone),h.mediaStream=a,h})})}function Wh(n){return T(this,void 0,void 0,function*(){return(yield pc({audio:!1,video:n}))[0]})}function Hh(n){return T(this,void 0,void 0,function*(){return(yield pc({audio:n,video:!1}))[0]})}class Gh extends Un{get description(){return"Can publish audio"}perform(){var e;return T(this,void 0,void 0,function*(){const t=yield this.connect(),i=yield Hh();t.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(a=>{a.type==="outbound-rtp"&&a.mediaType==="audio"&&(s=a.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," audio packets"))})}}class Kh extends Un{get description(){return"Can publish video"}perform(){var e;return T(this,void 0,void 0,function*(){const t=yield this.connect(),i=yield Wh();t.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(a=>{a.type==="outbound-rtp"&&a.mediaType==="video"&&(s=a.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}}class $h extends Un{get description(){return"Resuming connection after interruption"}perform(){var e;return T(this,void 0,void 0,function*(){const t=yield this.connect();let i=!1,r=!1,s;const a=new Promise(l=>{setTimeout(l,5e3),s=l});t.on(x.Reconnecting,()=>{i=!0}).on(x.Reconnected,()=>{r=!0,s(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const o=t.engine.client.onClose;if(o&&o(""),yield a,i){if(!r||t.state!==F.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class Qh extends Un{get description(){return"Can connect via TURN"}perform(){var e,t;return T(this,void 0,void 0,function*(){const i=new ts,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,a=!1,o=!1;for(let l of r.iceServers)for(let c of l.urls)c.startsWith("turn:")?(a=!0,o=!0):c.startsWith("turns:")&&(a=!0,o=!0,s=!0),c.startsWith("stun:")&&(o=!0);o?a&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((t=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||t===void 0)&&t.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(l=>setTimeout(l,0)))})}}class Yh extends Un{get description(){return"Establishing WebRTC connection"}perform(){return T(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on(x.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const a=new RTCIceCandidate(r);let o="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(Zh(a.address)?o+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,o+=" (passive)"):a.protocol==="udp"&&(t=!0)),this.appendMessage(o)}i&&i(r,s)},this.room.engine.subscriber&&(this.room.engine.subscriber.pc.onicecandidateerror=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),y.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function Zh(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class Xh extends Un{get description(){return"Connecting to signal connection via WebSocket"}perform(){var e,t,i;return T(this,void 0,void 0,function*(){(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new ts;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===Mn.Cloud&&(!((t=s.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class Tv extends vt.EventEmitter{constructor(e,t){super(),this.checkResults=new Map,this.url=e,this.token=t}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Be.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Be.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return T(this,void 0,void 0,function*(){const t=this.getNextCheckId(),i=new e(this.url,this.token),r=a=>{this.updateCheck(t,a)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Xh)})}checkWebRTC(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Yh)})}checkTURN(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Qh)})}checkReconnect(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck($h)})}checkPublishAudio(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Gh)})}checkPublishVideo(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(Kh)})}}function ef(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var t;const i=n instanceof Dn?n.mediaStreamTrack:n,r=i.getSettings();let s={facingMode:(t=e.defaultFacingMode)!==null&&t!==void 0?t:"user",confidence:"low"};if("facingMode"in r){const a=r.facingMode;y.debug("rawFacingMode",{rawFacingMode:a}),a&&typeof a=="string"&&rf(a)&&(s={facingMode:a,confidence:"high"})}if(["low","medium"].includes(s.confidence)){y.debug("Try to get facing mode from device label: (".concat(i.label,")"));const a=nf(i.label);a!==void 0&&(s=a)}return s}const la=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),tf=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function nf(n){var e;const t=n.trim().toLowerCase();if(t!=="")return la.has(t)?la.get(t):(e=Array.from(tf.entries()).find(i=>{let[r]=i;return t.includes(r)}))===null||e===void 0?void 0:e[1]}function rf(n){return n===void 0||["user","environment","left","right"].includes(n)}var rs={};Object.defineProperty(rs,"__esModule",{value:!0});rs.TLDs=void 0;rs.TLDs=["aaa","aarp","abb","abbott","abbvie","abc","able","abogado","abudhabi","ac","academy","accenture","accountant","accountants","aco","actor","ad","ads","adult","ae","aeg","aero","aetna","af","afl","africa","ag","agakhan","agency","ai","aig","airbus","airforce","airtel","akdn","al","alibaba","alipay","allfinanz","allstate","ally","alsace","alstom","am","amazon","americanexpress","americanfamily","amex","amfam","amica","amsterdam","analytics","android","anquan","anz","ao","aol","apartments","app","apple","aq","aquarelle","ar","arab","aramco","archi","army","arpa","art","arte","as","asda","asia","associates","at","athleta","attorney","au","auction","audi","audible","audio","auspost","author","auto","autos","avianca","aw","aws","ax","axa","az","azure","ba","baby","baidu","banamex","bananarepublic","band","bank","bar","barcelona","barclaycard","barclays","barefoot","bargains","baseball","basketball","bauhaus","bayern","bb","bbc","bbt","bbva","bcg","bcn","bd","be","beats","beauty","beer","bentley","berlin","best","bestbuy","bet","bf","bg","bh","bharti","bi","bible","bid","bike","bing","bingo","bio","biz","bj","black","blackfriday","blockbuster","blog","bloomberg","blue","bm","bms","bmw","bn","bnpparibas","bo","boats","boehringer","bofa","bom","bond","boo","book","booking","bosch","bostik","boston","bot","boutique","box","br","bradesco","bridgestone","broadway","broker","brother","brussels","bs","bt","build","builders","business","buy","buzz","bv","bw","by","bz","bzh","ca","cab","cafe","cal","call","calvinklein","cam","camera","camp","canon","capetown","capital","capitalone","car","caravan","cards","care","career","careers","cars","casa","case","cash","casino","cat","catering","catholic","cba","cbn","cbre","cbs","cc","cd","center","ceo","cern","cf","cfa","cfd","cg","ch","chanel","channel","charity","chase","chat","cheap","chintai","christmas","chrome","church","ci","cipriani","circle","cisco","citadel","citi","citic","city","cityeats","ck","cl","claims","cleaning","click","clinic","clinique","clothing","cloud","club","clubmed","cm","cn","co","coach","codes","coffee","college","cologne","com","comcast","commbank","community","company","compare","computer","comsec","condos","construction","consulting","contact","contractors","cooking","cool","coop","corsica","country","coupon","coupons","courses","cpa","cr","credit","creditcard","creditunion","cricket","crown","crs","cruise","cruises","cu","cuisinella","cv","cw","cx","cy","cymru","cyou","cz","dabur","dad","dance","data","date","dating","datsun","day","dclk","dds","de","deal","dealer","deals","degree","delivery","dell","deloitte","delta","democrat","dental","dentist","desi","design","dev","dhl","diamonds","diet","digital","direct","directory","discount","discover","dish","diy","dj","dk","dm","dnp","do","docs","doctor","dog","domains","dot","download","drive","dtv","dubai","dunlop","dupont","durban","dvag","dvr","dz","earth","eat","ec","eco","edeka","edu","education","ee","eg","email","emerck","energy","engineer","engineering","enterprises","epson","equipment","er","ericsson","erni","es","esq","estate","et","etisalat","eu","eurovision","eus","events","exchange","expert","exposed","express","extraspace","fage","fail","fairwinds","faith","family","fan","fans","farm","farmers","fashion","fast","fedex","feedback","ferrari","ferrero","fi","fidelity","fido","film","final","finance","financial","fire","firestone","firmdale","fish","fishing","fit","fitness","fj","fk","flickr","flights","flir","florist","flowers","fly","fm","fo","foo","food","football","ford","forex","forsale","forum","foundation","fox","fr","free","fresenius","frl","frogans","frontdoor","frontier","ftr","fujitsu","fun","fund","furniture","futbol","fyi","ga","gal","gallery","gallo","gallup","game","games","gap","garden","gay","gb","gbiz","gd","gdn","ge","gea","gent","genting","george","gf","gg","ggee","gh","gi","gift","gifts","gives","giving","gl","glass","gle","global","globo","gm","gmail","gmbh","gmo","gmx","gn","godaddy","gold","goldpoint","golf","goo","goodyear","goog","google","gop","got","gov","gp","gq","gr","grainger","graphics","gratis","green","gripe","grocery","group","gs","gt","gu","guardian","gucci","guge","guide","guitars","guru","gw","gy","hair","hamburg","hangout","haus","hbo","hdfc","hdfcbank","health","healthcare","help","helsinki","here","hermes","hiphop","hisamitsu","hitachi","hiv","hk","hkt","hm","hn","hockey","holdings","holiday","homedepot","homegoods","homes","homesense","honda","horse","hospital","host","hosting","hot","hoteles","hotels","hotmail","house","how","hr","hsbc","ht","hu","hughes","hyatt","hyundai","ibm","icbc","ice","icu","id","ie","ieee","ifm","ikano","il","im","imamat","imdb","immo","immobilien","in","inc","industries","infiniti","info","ing","ink","institute","insurance","insure","int","international","intuit","investments","io","ipiranga","iq","ir","irish","is","ismaili","ist","istanbul","it","itau","itv","jaguar","java","jcb","je","jeep","jetzt","jewelry","jio","jll","jm","jmp","jnj","jo","jobs","joburg","jot","joy","jp","jpmorgan","jprs","juegos","juniper","kaufen","kddi","ke","kerryhotels","kerrylogistics","kerryproperties","kfh","kg","kh","ki","kia","kids","kim","kinder","kindle","kitchen","kiwi","km","kn","koeln","komatsu","kosher","kp","kpmg","kpn","kr","krd","kred","kuokgroup","kw","ky","kyoto","kz","la","lacaixa","lamborghini","lamer","lancaster","land","landrover","lanxess","lasalle","lat","latino","latrobe","law","lawyer","lb","lc","lds","lease","leclerc","lefrak","legal","lego","lexus","lgbt","li","lidl","life","lifeinsurance","lifestyle","lighting","like","lilly","limited","limo","lincoln","link","lipsy","live","living","lk","llc","llp","loan","loans","locker","locus","lol","london","lotte","lotto","love","lpl","lplfinancial","lr","ls","lt","ltd","ltda","lu","lundbeck","luxe","luxury","lv","ly","ma","madrid","maif","maison","makeup","man","management","mango","map","market","marketing","markets","marriott","marshalls","mattel","mba","mc","mckinsey","md","me","med","media","meet","melbourne","meme","memorial","men","menu","merckmsd","mg","mh","miami","microsoft","mil","mini","mint","mit","mitsubishi","mk","ml","mlb","mls","mm","mma","mn","mo","mobi","mobile","moda","moe","moi","mom","monash","money","monster","mormon","mortgage","moscow","moto","motorcycles","mov","movie","mp","mq","mr","ms","msd","mt","mtn","mtr","mu","museum","music","mutual","mv","mw","mx","my","mz","na","nab","nagoya","name","natura","navy","nba","nc","ne","nec","net","netbank","netflix","network","neustar","new","news","next","nextdirect","nexus","nf","nfl","ng","ngo","nhk","ni","nico","nike","nikon","ninja","nissan","nissay","nl","no","nokia","northwesternmutual","norton","now","nowruz","nowtv","np","nr","nra","nrw","ntt","nu","nyc","nz","obi","observer","office","okinawa","olayan","olayangroup","oldnavy","ollo","om","omega","one","ong","onl","online","ooo","open","oracle","orange","org","organic","origins","osaka","otsuka","ott","ovh","pa","page","panasonic","paris","pars","partners","parts","party","passagens","pay","pccw","pe","pet","pf","pfizer","pg","ph","pharmacy","phd","philips","phone","photo","photography","photos","physio","pics","pictet","pictures","pid","pin","ping","pink","pioneer","pizza","pk","pl","place","play","playstation","plumbing","plus","pm","pn","pnc","pohl","poker","politie","porn","post","pr","pramerica","praxi","press","prime","pro","prod","productions","prof","progressive","promo","properties","property","protection","pru","prudential","ps","pt","pub","pw","pwc","py","qa","qpon","quebec","quest","racing","radio","re","read","realestate","realtor","realty","recipes","red","redstone","redumbrella","rehab","reise","reisen","reit","reliance","ren","rent","rentals","repair","report","republican","rest","restaurant","review","reviews","rexroth","rich","richardli","ricoh","ril","rio","rip","ro","rocher","rocks","rodeo","rogers","room","rs","rsvp","ru","rugby","ruhr","run","rw","rwe","ryukyu","sa","saarland","safe","safety","sakura","sale","salon","samsclub","samsung","sandvik","sandvikcoromant","sanofi","sap","sarl","sas","save","saxo","sb","sbi","sbs","sc","sca","scb","schaeffler","schmidt","scholarships","school","schule","schwarz","science","scot","sd","se","search","seat","secure","security","seek","select","sener","services","seven","sew","sex","sexy","sfr","sg","sh","shangrila","sharp","shaw","shell","shia","shiksha","shoes","shop","shopping","shouji","show","showtime","si","silk","sina","singles","site","sj","sk","ski","skin","sky","skype","sl","sling","sm","smart","smile","sn","sncf","so","soccer","social","softbank","software","sohu","solar","solutions","song","sony","soy","spa","space","sport","spot","sr","srl","ss","st","stada","staples","star","statebank","statefarm","stc","stcgroup","stockholm","storage","store","stream","studio","study","style","su","sucks","supplies","supply","support","surf","surgery","suzuki","sv","swatch","swiss","sx","sy","sydney","systems","sz","tab","taipei","talk","taobao","target","tatamotors","tatar","tattoo","tax","taxi","tc","tci","td","tdk","team","tech","technology","tel","temasek","tennis","teva","tf","tg","th","thd","theater","theatre","tiaa","tickets","tienda","tiffany","tips","tires","tirol","tj","tjmaxx","tjx","tk","tkmaxx","tl","tm","tmall","tn","to","today","tokyo","tools","top","toray","toshiba","total","tours","town","toyota","toys","tr","trade","trading","training","travel","travelers","travelersinsurance","trust","trv","tt","tube","tui","tunes","tushu","tv","tvs","tw","tz","ua","ubank","ubs","ug","uk","unicom","university","uno","uol","ups","us","uy","uz","va","vacations","vana","vanguard","vc","ve","vegas","ventures","verisign","versicherung","vet","vg","vi","viajes","video","vig","viking","villas","vin","vip","virgin","visa","vision","viva","vivo","vlaanderen","vn","vodka","volkswagen","volvo","vote","voting","voto","voyage","vu","vuelos","wales","walmart","walter","wang","wanggou","watch","watches","weather","weatherchannel","webcam","weber","website","wed","wedding","weibo","weir","wf","whoswho","wien","wiki","williamhill","win","windows","wine","winners","wme","wolterskluwer","woodside","work","works","world","wow","ws","wtc","wtf","xbox","xerox","xfinity","xihuan","xin","कॉम","セール","佛山","ಭಾರತ","慈善","集团","在线","한국","ଭାରତ","点看","คอม","ভাৰত","ভারত","八卦","ישראל","موقع","বাংলা","公益","公司","香格里拉","网站","移动","我爱你","москва","қаз","католик","онлайн","сайт","联通","срб","бг","бел","קום","时尚","微博","淡马锡","ファッション","орг","नेट","ストア","アマゾン","삼성","சிங்கப்பூர்","商标","商店","商城","дети","мкд","ею","ポイント","新闻","家電","كوم","中文网","中信","中国","中國","娱乐","谷歌","భారత్","ලංකා","電訊盈科","购物","クラウド","ભારત","通販","भारतम्","भारत","भारोत","网店","संगठन","餐厅","网络","ком","укр","香港","亚马逊","食品","飞利浦","台湾","台灣","手机","мон","الجزائر","عمان","ارامكو","ایران","العليان","اتصالات","امارات","بازار","موريتانيا","پاکستان","الاردن","بارت","بھارت","المغرب","ابوظبي","البحرين","السعودية","ڀارت","كاثوليك","سودان","همراه","عراق","مليسيا","澳門","닷컴","政府","شبكة","بيتك","عرب","გე","机构","组织机构","健康","ไทย","سورية","招聘","рус","рф","تونس","大拿","ລາວ","みんな","グーグル","ευ","ελ","世界","書籍","ഭാരതം","ਭਾਰਤ","网址","닷넷","コム","天主教","游戏","vermögensberater","vermögensberatung","企业","信息","嘉里大酒店","嘉里","مصر","قطر","广东","இலங்கை","இந்தியா","հայ","新加坡","فلسطين","政务","xxx","xyz","yachts","yahoo","yamaxun","yandex","ye","yodobashi","yoga","yokohama","you","youtube","yt","yun","za","zappos","zara","zero","zip","zm","zone","zuerich","zw"];var mc={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(ml,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function s(g,S){var k=g[S];if(typeof k.bind=="function")return k.bind(g);try{return Function.prototype.bind.call(k,g)}catch{return function(){return Function.prototype.apply.apply(k,[g,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(g){return g==="debug"&&(g="log"),typeof console===t?!1:g==="trace"&&i?a:console[g]!==void 0?s(console,g):console.log!==void 0?s(console,"log"):e}function l(g,S){for(var k=0;k<r.length;k++){var C=r[k];this[C]=k<g?e:this.methodFactory(C,g,S)}this.log=this.debug}function c(g,S,k){return function(){typeof console!==t&&(l.call(this,S,k),this[g].apply(this,arguments))}}function u(g,S,k){return o(g)||c.apply(this,arguments)}function h(g,S,k){var C=this,I;S=S??"WARN";var E="loglevel";typeof g=="string"?E+=":"+g:typeof g=="symbol"&&(E=void 0);function D(N){var U=(r[N]||"silent").toUpperCase();if(!(typeof window===t||!E)){try{window.localStorage[E]=U;return}catch{}try{window.document.cookie=encodeURIComponent(E)+"="+U+";"}catch{}}}function L(){var N;if(!(typeof window===t||!E)){try{N=window.localStorage[E]}catch{}if(typeof N===t)try{var U=window.document.cookie,q=U.indexOf(encodeURIComponent(E)+"=");q!==-1&&(N=/^([^;]+)/.exec(U.slice(q))[1])}catch{}return C.levels[N]===void 0&&(N=void 0),N}}function V(){if(!(typeof window===t||!E)){try{window.localStorage.removeItem(E);return}catch{}try{window.document.cookie=encodeURIComponent(E)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}C.name=g,C.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},C.methodFactory=k||u,C.getLevel=function(){return I},C.setLevel=function(N,U){if(typeof N=="string"&&C.levels[N.toUpperCase()]!==void 0&&(N=C.levels[N.toUpperCase()]),typeof N=="number"&&N>=0&&N<=C.levels.SILENT){if(I=N,U!==!1&&D(N),l.call(C,N,g),typeof console===t&&N<C.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+N},C.setDefaultLevel=function(N){S=N,L()||C.setLevel(N,!1)},C.resetLevel=function(){C.setLevel(S,!1),V()},C.enableAll=function(N){C.setLevel(C.levels.TRACE,N)},C.disableAll=function(N){C.setLevel(C.levels.SILENT,N)};var B=L();B==null&&(B=S),C.setLevel(B,!1)}var p=new h,v={};p.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var k=v[S];return k||(k=v[S]=new h(S,p.getLevel(),p.methodFactory)),k};var b=typeof window!==t?window.log:void 0;return p.noConflict=function(){return typeof window!==t&&window.log===p&&(window.log=b),p},p.getLoggers=function(){return v},p.default=p,p})})(mc);var sf=mc.exports;const af=gl(sf);function H(n){return typeof n=="function"}function ss(n){var e=function(i){Error.call(i),i.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ar=ss(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(i,r){return r+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function Ii(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var ai=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,i,r,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=Ci(a),l=o.next();!l.done;l=o.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(H(u))try{u()}catch(g){s=g instanceof ar?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var p=Ci(h),v=p.next();!v.done;v=p.next()){var b=v.value;try{ua(b)}catch(g){s=s??[],g instanceof ar?s=vn(vn([],cn(s)),cn(g.errors)):s.push(g)}}}catch(g){i={error:g}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(i)throw i.error}}}if(s)throw new ar(s)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)ua(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Ii(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&Ii(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),gc=ai.EMPTY;function vc(n){return n instanceof ai||n&&"closed"in n&&H(n.remove)&&H(n.add)&&H(n.unsubscribe)}function ua(n){H(n)?n():n.unsubscribe()}var bc={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ar={setTimeout:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var r=Ar.delegate;return r!=null&&r.setTimeout?r.setTimeout.apply(r,vn([n,e],cn(t))):setTimeout.apply(void 0,vn([n,e],cn(t)))},clearTimeout:function(n){var e=Ar.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(n)},delegate:void 0};function yc(n){Ar.setTimeout(function(){throw n})}function Mi(){}function Ti(n){n()}var as=function(n){Kt(e,n);function e(t){var i=n.call(this)||this;return i.isStopped=!1,t?(i.destination=t,vc(t)&&t.add(i)):i.destination=uf,i}return e.create=function(t,i,r){return new Or(t,i,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ai),of=Function.prototype.bind;function or(n,e){return of.call(n,e)}var cf=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(i){di(i)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(i){di(i)}else di(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){di(t)}},n}(),Or=function(n){Kt(e,n);function e(t,i,r){var s=n.call(this)||this,a;if(H(t)||!t)a={next:t??void 0,error:i??void 0,complete:r??void 0};else{var o;s&&bc.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=function(){return s.unsubscribe()},a={next:t.next&&or(t.next,o),error:t.error&&or(t.error,o),complete:t.complete&&or(t.complete,o)}):a=t}return s.destination=new cf(a),s}return e}(as);function di(n){yc(n)}function lf(n){throw n}var uf={closed:!0,next:Mi,error:lf,complete:Mi},os=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function cs(n){return n}function df(n){return n.length===0?cs:n.length===1?n[0]:function(t){return n.reduce(function(i,r){return r(i)},t)}}var ie=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,i){var r=this,s=ff(e)?e:new Or(e,t,i);return Ti(function(){var a=r,o=a.operator,l=a.source;s.add(o?o.call(s,l):l?r._subscribe(s):r._trySubscribe(s))}),s},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var i=this;return t=da(t),new t(function(r,s){var a=new Or({next:function(o){try{e(o)}catch(l){s(l),a.unsubscribe()}},error:s,complete:r});i.subscribe(a)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[os]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return df(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=da(e),new e(function(i,r){var s;t.subscribe(function(a){return s=a},function(a){return r(a)},function(){return i(s)})})},n.create=function(e){return new n(e)},n}();function da(n){var e;return(e=n??bc.Promise)!==null&&e!==void 0?e:Promise}function hf(n){return n&&H(n.next)&&H(n.error)&&H(n.complete)}function ff(n){return n&&n instanceof as||hf(n)&&vc(n)}function pf(n){return H(n==null?void 0:n.lift)}function Ue(n){return function(e){if(pf(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Qe(n,e,t,i,r){return new mf(n,e,t,i,r)}var mf=function(n){Kt(e,n);function e(t,i,r,s,a,o){var l=n.call(this,t)||this;return l.onFinalize=a,l.shouldUnsubscribe=o,l._next=i?function(c){try{i(c)}catch(u){t.error(u)}}:n.prototype._next,l._error=s?function(c){try{s(c)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,l._complete=r?function(){try{r()}catch(c){t.error(c)}finally{this.unsubscribe()}}:n.prototype._complete,l}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;n.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(as),gf=ss(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ln=function(n){Kt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new ha(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new gf},e.prototype.next=function(t){var i=this;Ti(function(){var r,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var a=Ci(i.currentObservers),o=a.next();!o.done;o=a.next()){var l=o.value;l.next(t)}}catch(c){r={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}}})},e.prototype.error=function(t){var i=this;Ti(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var r=i.observers;r.length;)r.shift().error(t)}})},e.prototype.complete=function(){var t=this;Ti(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,r=this,s=r.hasError,a=r.isStopped,o=r.observers;return s||a?gc:(this.currentObservers=null,o.push(t),new ai(function(){i.currentObservers=null,Ii(o,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,r=i.hasError,s=i.thrownError,a=i.isStopped;r?t.error(s):a&&t.complete()},e.prototype.asObservable=function(){var t=new ie;return t.source=this,t},e.create=function(t,i){return new ha(t,i)},e}(ie),ha=function(n){Kt(e,n);function e(t,i){var r=n.call(this)||this;return r.destination=t,r.source=i,r}return e.prototype.next=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,t)},e.prototype.error=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&r!==void 0?r:gc},e}(ln),kc=function(n){Kt(e,n);function e(t){var i=n.call(this)||this;return i._value=t,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var i=n.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},e.prototype.getValue=function(){var t=this,i=t.hasError,r=t.thrownError,s=t._value;if(i)throw r;return this._throwIfClosed(),s},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(ln),Sc={now:function(){return(Sc.delegate||Date).now()},delegate:void 0},vf=function(n){Kt(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e}(ai),_i={setInterval:function(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var r=_i.delegate;return r!=null&&r.setInterval?r.setInterval.apply(r,vn([n,e],cn(t))):setInterval.apply(void 0,vn([n,e],cn(t)))},clearInterval:function(n){var e=_i.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},bf=function(n){Kt(e,n);function e(t,i){var r=n.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(t,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=t;var s=this.id,a=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(a,s,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(a,this.id,i),this},e.prototype.requestAsyncId=function(t,i,r){return r===void 0&&(r=0),_i.setInterval(t.flush.bind(t,this),r)},e.prototype.recycleAsyncId=function(t,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&_i.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var r=!1,s;try{this.work(t)}catch(a){r=!0,s=a||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,r=t.scheduler,s=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Ii(s,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(vf),fa=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=Sc.now,n}(),yf=function(n){Kt(e,n);function e(t,i){i===void 0&&(i=fa.now);var r=n.call(this,t,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var r;this._active=!0;do if(r=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,r){for(;t=i.shift();)t.unsubscribe();throw r}},e}(fa),kf=new yf(bf);function Sf(n){return n&&H(n.schedule)}function Tf(n){return n[n.length-1]}function ls(n){return Sf(Tf(n))?n.pop():void 0}var us=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function Tc(n){return H(n==null?void 0:n.then)}function Cc(n){return H(n[os])}function wc(n){return Symbol.asyncIterator&&H(n==null?void 0:n[Symbol.asyncIterator])}function Ec(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Cf(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var xc=Cf();function Pc(n){return H(n==null?void 0:n[xc])}function Rc(n){return bl(this,arguments,function(){var t,i,r,s;return Ia(this,function(a){switch(a.label){case 0:t=n.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,Ki(t.read())];case 3:return i=a.sent(),r=i.value,s=i.done,s?[4,Ki(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,Ki(r)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Nc(n){return H(n==null?void 0:n.getReader)}function Qt(n){if(n instanceof ie)return n;if(n!=null){if(Cc(n))return wf(n);if(us(n))return Ef(n);if(Tc(n))return xf(n);if(wc(n))return Ic(n);if(Pc(n))return Pf(n);if(Nc(n))return Rf(n)}throw Ec(n)}function wf(n){return new ie(function(e){var t=n[os]();if(H(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Ef(n){return new ie(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function xf(n){return new ie(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,yc)})}function Pf(n){return new ie(function(e){var t,i;try{for(var r=Ci(n),s=r.next();!s.done;s=r.next()){var a=s.value;if(e.next(a),e.closed)return}}catch(o){t={error:o}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}e.complete()})}function Ic(n){return new ie(function(e){Nf(n,e).catch(function(t){return e.error(t)})})}function Rf(n){return Ic(Rc(n))}function Nf(n,e){var t,i,r,s;return yl(this,void 0,void 0,function(){var a,o;return Ia(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),t=kl(n),l.label=1;case 1:return[4,t.next()];case 2:if(i=l.sent(),!!i.done)return[3,4];if(a=i.value,e.next(a),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),r={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),i&&!i.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Gt(n,e,t,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Mc(n,e){return e===void 0&&(e=0),Ue(function(t,i){t.subscribe(Qe(i,function(r){return Gt(i,n,function(){return i.next(r)},e)},function(){return Gt(i,n,function(){return i.complete()},e)},function(r){return Gt(i,n,function(){return i.error(r)},e)}))})}function _c(n,e){return e===void 0&&(e=0),Ue(function(t,i){i.add(n.schedule(function(){return t.subscribe(i)},e))})}function If(n,e){return Qt(n).pipe(_c(e),Mc(e))}function Mf(n,e){return Qt(n).pipe(_c(e),Mc(e))}function _f(n,e){return new ie(function(t){var i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function Df(n,e){return new ie(function(t){var i;return Gt(t,e,function(){i=n[xc](),Gt(t,e,function(){var r,s,a;try{r=i.next(),s=r.value,a=r.done}catch(o){t.error(o);return}a?t.complete():t.next(s)},0,!0)}),function(){return H(i==null?void 0:i.return)&&i.return()}})}function Dc(n,e){if(!n)throw new Error("Iterable cannot be null");return new ie(function(t){Gt(t,e,function(){var i=n[Symbol.asyncIterator]();Gt(t,e,function(){i.next().then(function(r){r.done?t.complete():t.next(r.value)})},0,!0)})})}function Af(n,e){return Dc(Rc(n),e)}function Of(n,e){if(n!=null){if(Cc(n))return If(n,e);if(us(n))return _f(n,e);if(Tc(n))return Mf(n,e);if(wc(n))return Dc(n,e);if(Pc(n))return Df(n,e);if(Nc(n))return Af(n,e)}throw Ec(n)}function Ac(n,e){return e?Of(n,e):Qt(n)}function pa(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ls(n);return Ac(n,t)}function Lf(n){return n instanceof Date&&!isNaN(n)}var Uf=ss(function(n){return function(t){t===void 0&&(t=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function jf(n,e){var t=Lf(n)?{first:n}:typeof n=="number"?{each:n}:n,i=t.first,r=t.each,s=t.with,a=s===void 0?Ff:s,o=t.scheduler,l=o===void 0?e??kf:o,c=t.meta,u=c===void 0?null:c;if(i==null&&r==null)throw new TypeError("No timeout provided.");return Ue(function(h,p){var v,b,g=null,S=0,k=function(C){b=Gt(p,l,function(){try{v.unsubscribe(),Qt(a({meta:u,lastValue:g,seen:S})).subscribe(p)}catch(I){p.error(I)}},C)};v=h.subscribe(Qe(p,function(C){b==null||b.unsubscribe(),S++,p.next(g=C),r>0&&k(r)},void 0,void 0,function(){b!=null&&b.closed||b==null||b.unsubscribe(),g=null})),!S&&k(i!=null?typeof i=="number"?i:+i-l.now():r)})}function Ff(n){throw new Uf(n)}function ne(n,e){return Ue(function(t,i){var r=0;t.subscribe(Qe(i,function(s){i.next(n.call(e,s,r++))}))})}var Bf=Array.isArray;function Jf(n,e){return Bf(e)?n.apply(void 0,vn([],cn(e))):n(e)}function Vf(n){return ne(function(e){return Jf(n,e)})}function qf(n,e,t,i,r,s,a,o){var l=[],c=0,u=0,h=!1,p=function(){h&&!l.length&&!c&&e.complete()},v=function(g){return c<i?b(g):l.push(g)},b=function(g){s&&e.next(g),c++;var S=!1;Qt(t(g,u++)).subscribe(Qe(e,function(k){r==null||r(k),s?v(k):e.next(k)},function(){S=!0},void 0,function(){if(S)try{c--;for(var k=function(){var C=l.shift();a?Gt(e,a,function(){return b(C)}):b(C)};l.length&&c<i;)k();p()}catch(C){e.error(C)}}))};return n.subscribe(Qe(e,v,function(){h=!0,p()})),function(){o==null||o()}}function ds(n,e,t){return t===void 0&&(t=1/0),H(e)?ds(function(i,r){return ne(function(s,a){return e(i,s,r,a)})(Qt(n(i,r)))},t):(typeof e=="number"&&(t=e),Ue(function(i,r){return qf(i,r,n,t)}))}function zf(n){return n===void 0&&(n=1/0),ds(cs,n)}function Wf(){return zf(1)}function Di(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Wf()(Ac(n,ls(n)))}var Hf=["addListener","removeListener"],Gf=["addEventListener","removeEventListener"],Kf=["on","off"];function Lr(n,e,t,i){if(H(t)&&(i=t,t=void 0),i)return Lr(n,e,t).pipe(Vf(i));var r=cn(Yf(n)?Gf.map(function(o){return function(l){return n[o](e,l,t)}}):$f(n)?Hf.map(ma(n,e)):Qf(n)?Kf.map(ma(n,e)):[],2),s=r[0],a=r[1];if(!s&&us(n))return ds(function(o){return Lr(o,e,t)})(Qt(n));if(!s)throw new TypeError("Invalid event target");return new ie(function(o){var l=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];return o.next(1<c.length?c:c[0])};return s(l),function(){return a(l)}})}function ma(n,e){return function(t){return function(i){return n[t](e,i)}}}function $f(n){return H(n.addListener)&&H(n.removeListener)}function Qf(n){return H(n.on)&&H(n.off)}function Yf(n){return H(n.addEventListener)&&H(n.removeEventListener)}function hs(n,e){return Ue(function(t,i){var r=0;t.subscribe(Qe(i,function(s){return n.call(e,s,r++)&&i.next(s)}))})}function Zf(n,e,t,i,r){return function(s,a){var o=t,l=e,c=0;s.subscribe(Qe(a,function(u){var h=c++;l=o?n(l,u,h):(o=!0,u),i&&a.next(l)},r&&function(){o&&a.next(l),a.complete()}))}}function Xf(n,e){return e===void 0&&(e=cs),n=n??ep,Ue(function(t,i){var r,s=!0;t.subscribe(Qe(i,function(a){var o=e(a);(s||!n(r,o))&&(s=!1,r=o,i.next(a))}))})}function ep(n,e){return n===e}function tp(n){return Ue(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function np(n,e){return Ue(Zf(n,e,arguments.length>=2,!0))}function ip(n){return Ue(function(e,t){var i=!1,r=Qe(t,function(){r==null||r.unsubscribe(),i=!0},Mi);Qt(n).subscribe(r),e.subscribe(Qe(t,function(s){return i&&t.next(s)}))})}function je(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ls(n);return Ue(function(i,r){(t?Di(n,i,t):Di(n,i)).subscribe(r)})}function ga(n){return Ue(function(e,t){Qt(n).subscribe(Qe(t,function(){return t.complete()},Mi)),!t.closed&&e.subscribe(t)})}var rp=Object.defineProperty,sp=Object.defineProperties,ap=Object.getOwnPropertyDescriptors,va=Object.getOwnPropertySymbols,op=Object.prototype.hasOwnProperty,cp=Object.prototype.propertyIsEnumerable,ba=(n,e,t)=>e in n?rp(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,lp=(n,e)=>{for(var t in e||(e={}))op.call(e,t)&&ba(n,t,e[t]);if(va)for(var t of va(e))cp.call(e,t)&&ba(n,t,e[t]);return n},up=(n,e)=>sp(n,ap(e)),dn=(n,e,t)=>new Promise((i,r)=>{var s=l=>{try{o(t.next(l))}catch(c){r(c)}},a=l=>{try{o(t.throw(l))}catch(c){r(c)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,a);o((t=t.apply(n,e)).next())}),dp="lk";function te(n){return typeof n>"u"?!1:hp(n)||fp(n)}function hp(n){var e;return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("track")&&typeof((e=n.publication)==null?void 0:e.track)<"u":!1}function fp(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&n.hasOwnProperty("publication")&&typeof n.publication<"u":!1}function ri(n){return n?n.hasOwnProperty("participant")&&n.hasOwnProperty("source")&&typeof n.publication>"u":!1}function ee(n){if(typeof n=="string"||typeof n=="number")return`${n}`;if(ri(n))return`${n.participant.identity}_${n.source}_placeholder`;if(te(n))return`${n.participant.identity}_${n.publication.source}_${n.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${n}`)}function pp(n,e){return n===void 0||e===void 0?!1:te(n)&&te(e)?n.publication.trackSid===e.publication.trackSid:ee(n)===ee(e)}function Ur(n,e){return typeof e>"u"?!1:te(n)?e.some(t=>t.participant.identity===n.participant.identity&&te(t)&&t.publication.trackSid===n.publication.trackSid):ri(n)?e.some(t=>t.participant.identity===n.participant.identity&&ri(t)&&t.source===n.source):!1}function mp(n,e){return ri(n)&&te(e)&&e.participant.identity===n.participant.identity&&e.source===n.source}function Oc(n){return n instanceof ii}function gp(){const n=document.createElement("p");n.style.width="100%",n.style.height="200px";const e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.overflow="hidden",e.appendChild(n),document.body.appendChild(e);const t=n.offsetWidth;e.style.overflow="scroll";let i=n.offsetWidth;return t===i&&(i=e.clientWidth),document.body.removeChild(e),t-i}function vp(){return typeof document<"u"}function bp(n,e){return dn(this,null,function*(){const{x:t,y:i}=yield Ml(n,e,{placement:"top",middleware:[_l(6),Dl(),Al({padding:5})]});return{x:t,y:i}})}function yp(n,e){return!n.contains(e.target)}var kp=[x.ConnectionStateChanged,x.RoomMetadataChanged,x.ActiveSpeakersChanged,x.ConnectionQualityChanged,x.ParticipantConnected,x.ParticipantDisconnected,x.ParticipantPermissionsChanged,x.ParticipantMetadataChanged,x.TrackMuted,x.TrackUnmuted,x.TrackPublished,x.TrackUnpublished,x.TrackStreamStateChanged,x.TrackSubscriptionFailed,x.TrackSubscriptionPermissionChanged,x.TrackSubscriptionStatusChanged],Sp=[...kp,x.LocalTrackPublished,x.LocalTrackUnpublished],Tp=[R.ConnectionQualityChanged,R.IsSpeakingChanged,R.ParticipantMetadataChanged,R.ParticipantPermissionsChanged,R.TrackMuted,R.TrackUnmuted,R.TrackPublished,R.TrackUnpublished,R.TrackStreamStateChanged,R.TrackSubscriptionFailed,R.TrackSubscriptionPermissionChanged,R.TrackSubscriptionStatusChanged];[...Tp,R.LocalTrackPublished,R.LocalTrackUnpublished];var J=af.getLogger("lk-components-js");J.setDefaultLevel("WARN");var ya=[{columns:1,rows:1,name:"1x1",minTiles:1,maxTiles:1,minWidth:0,minHeight:0},{columns:1,rows:2,name:"1x2",minTiles:2,maxTiles:2,minWidth:0,minHeight:0},{columns:2,rows:1,name:"2x1",minTiles:2,maxTiles:2,minWidth:900,minHeight:0},{columns:2,rows:2,name:"2x2",minTiles:3,maxTiles:4,minWidth:560,minHeight:0},{columns:3,rows:3,name:"3x3",minTiles:5,maxTiles:9,minWidth:700,minHeight:0},{columns:4,rows:4,name:"4x4",minTiles:10,maxTiles:16,minWidth:960,minHeight:0},{columns:5,rows:5,name:"5x5",minTiles:17,maxTiles:25,minWidth:1100,minHeight:0}];function Lc(n,e,t,i){let r=0,s=n.find((a,o,l)=>{r=o;const c=l.findIndex((u,h)=>{const p=h>o,v=u.maxTiles===a.maxTiles;return p&&v})!==-1;return a.maxTiles>=e&&!c});if(s===void 0)if(s=n[n.length-1],s)J.warn(`No layout found for: participantCount: ${e}, width/height: ${t}/${i} fallback to biggest available layout (${s.name}).`);else throw new Error("No layout or fallback layout found.");if((t<s.minWidth||i<s.minHeight)&&r>0){const a=n[r-1];s=Lc(n.slice(0,r),a.maxTiles,t,i)}return s}function Cp(){return typeof navigator<"u"&&navigator.mediaDevices&&!!navigator.mediaDevices.getDisplayMedia}var Uc=[],jc={showChat:!1,unreadMessages:0};function Fc(n){return typeof n=="object"}function Bc(n){return Array.isArray(n)&&n.filter(Fc).length>0}function wp(n,e){return e.audioLevel-n.audioLevel}function Ep(n,e){return n.isSpeaking===e.isSpeaking?0:n.isSpeaking?-1:1}function xp(n,e){var t,i,r,s;return n.lastSpokeAt!==void 0||e.lastSpokeAt!==void 0?((i=(t=e.lastSpokeAt)==null?void 0:t.getTime())!=null?i:0)-((s=(r=n.lastSpokeAt)==null?void 0:r.getTime())!=null?s:0):0}function jr(n,e){var t,i,r,s;return((i=(t=n.joinedAt)==null?void 0:t.getTime())!=null?i:0)-((s=(r=e.joinedAt)==null?void 0:r.getTime())!=null?s:0)}function Pp(n,e){return te(n)?te(e)?0:-1:te(e)?1:0}function Rp(n,e){const t=n.participant.isCameraEnabled,i=e.participant.isCameraEnabled;return t!==i?t?-1:1:0}function Np(n){const e=[],t=[],i=[],r=[];n.forEach(o=>{o.participant.isLocal&&o.source===w.Source.Camera?e.push(o):o.source===w.Source.ScreenShare?t.push(o):o.source===w.Source.Camera?i.push(o):r.push(o)});const s=Ip(t),a=Mp(i);return[...e,...s,...a,...r]}function Ip(n){const e=[],t=[];return n.forEach(r=>{r.participant.isLocal?e.push(r):t.push(r)}),e.sort((r,s)=>jr(r.participant,s.participant)),t.sort((r,s)=>jr(r.participant,s.participant)),[...t,...e]}function Mp(n){const e=[],t=[];return n.forEach(i=>{i.participant.isLocal?e.push(i):t.push(i)}),t.sort((i,r)=>i.participant.isSpeaking&&r.participant.isSpeaking?wp(i.participant,r.participant):i.participant.isSpeaking!==r.participant.isSpeaking?Ep(i.participant,r.participant):i.participant.lastSpokeAt!==r.participant.lastSpokeAt?xp(i.participant,r.participant):te(i)!==te(r)?Pp(i,r):i.participant.isCameraEnabled!==r.participant.isCameraEnabled?Rp(i,r):jr(i.participant,r.participant)),[...e,...t]}function _p(n,e){return n.reduce((t,i,r)=>r%e===0?[...t,[i]]:[...t.slice(0,-1),[...t.slice(-1)[0],i]],[])}function ka(n,e){const t=Math.max(n.length,e.length);return new Array(t).fill([]).map((i,r)=>[n[r],e[r]])}function Ai(n,e,t){return n.filter(i=>!e.map(r=>t(r)).includes(t(i)))}function Fr(n){return n.map(e=>typeof e=="string"||typeof e=="number"?`${e}`:ee(e))}function Dp(n,e){return{dropped:Ai(n,e,ee),added:Ai(e,n,ee)}}function Ap(n){return n.added.length!==0||n.dropped.length!==0}function Br(n,e){const t=e.findIndex(i=>ee(i)===ee(n));if(t===-1)throw new Error(`Element not part of the array: ${ee(n)} not in ${Fr(e)}`);return t}function Op(n,e,t){const i=Br(n,t),r=Br(e,t);return t.splice(i,1,e),t.splice(r,1,n),t}function Lp(n,e){const t=Br(n,e);return e.splice(t,1),e}function Up(n,e){return[...e,n]}function cr(n,e){return _p(n,e)}function jp(n,e,t){let i=Fp(n,e);if(i.length<e.length){const a=Ai(e,i,ee);i=[...i,...a]}const r=cr(i,t),s=cr(e,t);if(ka(r,s).forEach(([a,o],l)=>{if(a&&o){const c=cr(i,t)[l],u=Dp(c,o);Ap(u)&&(J.debug(`Detected visual changes on page: ${l}, current: ${Fr(a)}, next: ${Fr(o)}`,{changes:u}),u.added.length===u.dropped.length&&ka(u.added,u.dropped).forEach(([h,p])=>{if(h&&p)i=Op(h,p,i);else throw new Error(`For a swap action we need a addition and a removal one is missing: ${h}, ${p}`)}),u.added.length===0&&u.dropped.length>0&&u.dropped.forEach(h=>{i=Lp(h,i)}),u.added.length>0&&u.dropped.length===0&&u.added.forEach(h=>{i=Up(h,i)}))}}),i.length>e.length){const a=Ai(i,e,ee);i=i.filter(o=>!a.map(ee).includes(ee(o)))}return i}function Fp(n,e){return n.map(t=>{const i=e.find(r=>ee(t)===ee(r)||typeof t!="number"&&ri(t)&&te(r)&&mp(t,r));return i??t})}function Jc(n,...e){return new ie(i=>{const r=()=>{i.next(n)};return e.forEach(a=>{n.on(a,r)}),()=>{e.forEach(a=>{n.off(a,r)})}}).pipe(je(n))}function Vi(n,e){return new ie(i=>{const r=(...a)=>{i.next(a)};return n.on(e,r),()=>{n.off(e,r)}})}function Bp(n){return Vi(n,x.ConnectionStateChanged).pipe(ne(([e])=>e),je(n.state))}function Jp(n,e=!0){var t;const i=()=>dn(this,null,function*(){const a=yield Ni.getLocalDevices(n,e);r.next(a)}),r=new ln,s=r.pipe(tp(()=>{var a;(a=navigator==null?void 0:navigator.mediaDevices)==null||a.removeEventListener("devicechange",i)}));if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(t=navigator==null?void 0:navigator.mediaDevices)==null||t.addEventListener("devicechange",i)}return Di(Ni.getLocalDevices(n,e),s)}function Vp(n){return Vi(n,x.DataReceived)}function qp(n){return Jc(n,x.AudioPlaybackStatusChanged).pipe(ne(t=>({canPlayAudio:t.canPlaybackAudio})))}function zp(n,e){return Vi(n,x.ActiveDeviceChanged).pipe(hs(([t])=>t===e),ne(([t,i])=>(J.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:t,deviceId:i}),i)),je(n.getActiveDevice(e)))}function Wp(n,e){return Vi(n,x.ParticipantEncryptionStatusChanged).pipe(hs(([,t])=>e.identity===(t==null?void 0:t.identity)||!t&&e.identity===n.localParticipant.identity),ne(([t])=>t),je(e instanceof ii?e.isE2EEEnabled:e.isEncrypted))}function we(n){return`${dp}-${n}`}function Hp(n){const e=Jr(n),t=Vc(n.participant).pipe(ne(()=>Jr(n)),je(e));return{className:we(n.source===w.Source.Camera||n.source===w.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:t}}function Jr(n){if(te(n))return n.publication;{const{source:e,name:t,participant:i}=n;if(e&&t)return i.getTracks().find(r=>r.source===e&&r.trackName===t);if(t)return i.getTrackByName(t);if(e)return i.getTrack(e);throw new Error("At least one of source and name needs to be defined")}}function fs(n,...e){return new ie(i=>{const r=()=>{i.next(n)};return e.forEach(a=>{n.on(a,r)}),()=>{e.forEach(a=>{n.off(a,r)})}}).pipe(je(n))}function Vc(n){return fs(n,R.TrackMuted,R.TrackUnmuted,R.ParticipantPermissionsChanged,R.TrackPublished,R.TrackUnpublished,R.LocalTrackPublished,R.LocalTrackUnpublished,R.MediaDevicesError,R.TrackSubscriptionStatusChanged).pipe(ne(t=>{const{isMicrophoneEnabled:i,isCameraEnabled:r,isScreenShareEnabled:s}=t,a=t.getTrack(w.Source.Microphone),o=t.getTrack(w.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:i,isScreenShareEnabled:s,cameraTrack:o,microphoneTrack:a,participant:t}}))}function Gp(n){return fs(n,R.ParticipantMetadataChanged).pipe(ne(({name:t,identity:i,metadata:r})=>({name:t,identity:i,metadata:r})),je({name:n.name,identity:n.identity,metadata:n.metadata}))}function Kp(n){return ps(n,R.ConnectionQualityChanged).pipe(ne(([t])=>t),je(n.connectionQuality))}function ps(n,e){return new ie(i=>{const r=(...a)=>{i.next(a)};return n.on(e,r),()=>{n.off(e,r)}})}function qc(n){var e,t,i,r;return fs(n.participant,R.TrackMuted,R.TrackUnmuted,R.TrackSubscribed,R.TrackUnsubscribed,R.LocalTrackPublished,R.LocalTrackUnpublished).pipe(ne(s=>{var a,o;const l=(a=n.publication)!=null?a:s.getTrack(n.source);return(o=l==null?void 0:l.isMuted)!=null?o:!0}),je((r=(i=(e=n.publication)==null?void 0:e.isMuted)!=null?i:(t=n.participant.getTrack(n.source))==null?void 0:t.isMuted)!=null?r:!0))}function $p(n){return ps(n,R.IsSpeakingChanged).pipe(ne(([e])=>e))}function Qp(n){return ps(n,R.ParticipantPermissionsChanged).pipe(ne(()=>n.permissions),je(n.permissions))}function Yp(n,e,t){const{localParticipant:i}=e,r=(c,u)=>{let h=!1;switch(c){case w.Source.Camera:h=u.isCameraEnabled;break;case w.Source.Microphone:h=u.isMicrophoneEnabled;break;case w.Source.ScreenShare:h=u.isScreenShareEnabled;break}return h},s=Vc(i).pipe(ne(c=>r(n,c.participant)),je(r(n,i))),a=new ln,o=(c,u)=>dn(this,null,function*(){try{switch(u??(u=t),a.next(!0),n){case w.Source.Camera:yield i.setCameraEnabled(c??!i.isCameraEnabled,u);break;case w.Source.Microphone:yield i.setMicrophoneEnabled(c??!i.isMicrophoneEnabled,u);break;case w.Source.ScreenShare:yield i.setScreenShareEnabled(c??!i.isScreenShareEnabled,u);break;default:break}}finally{a.next(!1)}});return{className:we("button"),toggle:o,enabledObserver:s,pendingObserver:a.asObservable()}}function Zp(){let n=!1;const e=new ln,t=new ln,i=s=>{t.next(!0),n=s??!n,e.next(n),t.next(!1)};return{className:we("button"),toggle:i,enabledObserver:e.asObservable(),pendingObserver:t.asObservable()}}function Xp(n,e,t){const i=new kc(void 0),r=e?zp(e,n):i.asObservable(),s=(o,...l)=>dn(this,[o,...l],function*(c,u={}){var h,p,v;if(e){J.debug(`Switching active device of kind "${n}" with id ${c}.`),yield e.switchActiveDevice(n,c,u.exact);const b=(h=e.getActiveDevice(n))!=null?h:c;b!==c&&c!=="default"&&J.info(`We tried to select the device with id (${c}), but the browser decided to select the device with id (${b}) instead.`);let g;n==="audioinput"?g=(p=e.localParticipant.getTrack(w.Source.Microphone))==null?void 0:p.track:n==="videoinput"&&(g=(v=e.localParticipant.getTrack(w.Source.Camera))==null?void 0:v.track);const S=c==="default"&&!g||c==="default"&&(g==null?void 0:g.mediaStreamTrack.label.startsWith("Default"));i.next(S?c:b)}else if(t){yield t.setDeviceId(u.exact?{exact:c}:c);const b=yield t.getDeviceId();i.next(c==="default"&&t.mediaStreamTrack.label.startsWith("Default")?c:b)}else i.value!==c&&(J.warn("device switch skipped, please provide either a room or a local track to switch on. "),i.next(c))});return{className:we("media-device-select"),activeDeviceObservable:r,setActiveMediaDevice:s}}function em(n){const e=i=>{n.disconnect(i)};return{className:we("disconnect-button"),disconnect:e}}function tm(n){const e=we("connection-quality"),t=Kp(n);return{className:e,connectionQualityObserver:t}}function nm(n){let e="track-muted-indicator-camera";switch(n.source){case w.Source.Camera:e="track-muted-indicator-camera";break;case w.Source.Microphone:e="track-muted-indicator-microphone";break}const t=we(e),i=qc(n);return{className:t,mediaMutedObserver:i}}function im(n){return{className:"lk-participant-name",infoObserver:Gp(n)}}function rm(){return{className:we("participant-tile")}}var lr={CHAT:"lk-chat-topic"};function zc(n,e,t){return dn(this,arguments,function*(i,r,s,a={}){const{kind:o,destination:l}=a;yield i.publishData(r,o??Z.RELIABLE,{destination:l,topic:s})})}function sm(n,e,t){const i=Vp(n).pipe(hs(([,,,o])=>e===void 0||o===e),ne(([o,l,,c])=>{const u={payload:o,topic:c,from:l};return t==null||t(u),u}));let r;const s=new ie(o=>{r=o});return{messageObservable:i,isSendingObservable:s,send:(o,...l)=>dn(this,[o,...l],function*(c,u={}){r.next(!0);try{yield zc(n.localParticipant,c,e,u)}finally{r.next(!1)}})}}var am=new TextEncoder,om=new TextDecoder,cm=n=>am.encode(JSON.stringify({message:n.message,timestamp:n.timestamp})),lm=n=>JSON.parse(om.decode(n));function um(n,e){const t=new ln,i=new ln,{messageObservable:r}=sm(n,lr.CHAT);r.pipe(ga(t)).subscribe(i);const{messageDecoder:s,messageEncoder:a}=e??{},o=s??lm,l=i.pipe(ne(v=>{const b=o(v.payload);return up(lp({},b),{from:v.from})}),np((v,b)=>[...v,b],[]),ga(t)),c=new kc(!1),u=a??cm,h=v=>dn(this,null,function*(){const b=Date.now(),g=u({message:v,timestamp:b});c.next(!0);try{yield zc(n.localParticipant,g,lr.CHAT,{kind:Z.RELIABLE}),i.next({payload:g,topic:lr.CHAT,from:n.localParticipant})}finally{c.next(!1)}});function p(){t.next(),t.complete()}return{messageObservable:l,isSendingObservable:c,send:h,destroy:p}}function dm(){const n=t=>dn(this,null,function*(){J.info("Start Audio for room: ",t),yield t.startAudio()});return{className:we("start-audio-button"),roomAudioPlaybackAllowedObservable:qp,handleStartAudioPlayback:n}}function hm(){return{className:[we("button"),we("chat-toggle")].join(" ")}}function fm(){return{className:[we("button"),we("focus-toggle-button")].join(" ")}}function pm(){return{className:"lk-room-container"}}function Sa(n,e,t=!0){const r=[n.localParticipant,...Array.from(n.participants.values())],s=[];return r.forEach(a=>{e.forEach(o=>{const l=Array.from(a.tracks.values()).filter(c=>c.source===o&&(!t||c.track)).map(c=>({participant:a,publication:c,source:c.source}));s.push(...l)})}),{trackReferences:s,participants:r}}function mm(n,e,t){var i,r;const s=(i=t.additionalRoomEvents)!=null?i:Sp,a=(r=t.onlySubscribed)!=null?r:!0,o=Array.from(new Set([x.ParticipantConnected,x.ParticipantDisconnected,x.ConnectionStateChanged,x.LocalTrackPublished,x.LocalTrackUnpublished,x.TrackPublished,x.TrackUnpublished,x.TrackSubscriptionStatusChanged,...s]).values());return Jc(n,...o).pipe(ne(c=>{const u=Sa(c,e,a);return J.debug(`TrackReference[] was updated. (length ${u.trackReferences.length})`,u),u}),je(Sa(n,e,a)))}function gm(n,e=1e3){if(n===null)return pa(!1);const t=Lr(n,"mousemove",{passive:!0}).pipe(ne(()=>!0)),i=t.pipe(jf({each:e,with:()=>Di(pa(!1),i.pipe(ip(t)))}),Xf());return i}globalThis&&globalThis.__awaiter;function vm(n,e){const[t,i]=d.useState(n);return d.useEffect(()=>{const r=setTimeout(()=>i(n),e||500);return()=>{clearTimeout(r)}},[n,e]),t}globalThis&&globalThis.__awaiter;function bm(n,{threshold:e=0,root:t=null,rootMargin:i="0%",freezeOnceVisible:r=!1}){const[s,a]=d.useState(),o=(s==null?void 0:s.isIntersecting)&&r,l=([c])=>{a(c)};return d.useEffect(()=>{const c=n==null?void 0:n.current;if(!!!window.IntersectionObserver||o||!c)return;const h={threshold:e,root:t,rootMargin:i},p=new IntersectionObserver(l,h);return p.observe(c),()=>p.disconnect()},[n==null?void 0:n.current,JSON.stringify(e),t,i,o]),s}var ym=Object.defineProperty,km=Object.defineProperties,Sm=Object.getOwnPropertyDescriptors,Oi=Object.getOwnPropertySymbols,Wc=Object.prototype.hasOwnProperty,Hc=Object.prototype.propertyIsEnumerable,Ta=(n,e,t)=>e in n?ym(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,O=(n,e)=>{for(var t in e||(e={}))Wc.call(e,t)&&Ta(n,t,e[t]);if(Oi)for(var t of Oi(e))Hc.call(e,t)&&Ta(n,t,e[t]);return n},Ke=(n,e)=>km(n,Sm(e)),Y=(n,e)=>{var t={};for(var i in n)Wc.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&Oi)for(var i of Oi(n))e.indexOf(i)<0&&Hc.call(n,i)&&(t[i]=n[i]);return t},Gc=(n,e,t)=>new Promise((i,r)=>{var s=l=>{try{o(t.next(l))}catch(c){r(c)}},a=l=>{try{o(t.throw(l))}catch(c){r(c)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,a);o((t=t.apply(n,e)).next())});function Tm(n,e){const t=wm(),i=Mu(e);return d.useLayoutEffect(()=>{let r=!1;const s=n.current;if(!s)return;function a(o,l){r||i.current(o,l)}return t==null||t.subscribe(s,a),()=>{r=!0,t==null||t.unsubscribe(s,a)}},[n.current,t,i]),t==null?void 0:t.observer}function Cm(){let n=!1,e=[];const t=new Map;if(typeof window>"u")return;const i=new ResizeObserver((r,s)=>{e=e.concat(r),n||window.requestAnimationFrame(()=>{const a=new Set;for(let o=0;o<e.length;o++){if(a.has(e[o].target))continue;a.add(e[o].target);const l=t.get(e[o].target);l==null||l.forEach(c=>c(e[o],s))}e=[],n=!1}),n=!0});return{observer:i,subscribe(r,s){var a;i.observe(r);const o=(a=t.get(r))!=null?a:[];o.push(s),t.set(r,o)},unsubscribe(r,s){var a;const o=(a=t.get(r))!=null?a:[];if(o.length===1){i.unobserve(r),t.delete(r);return}const l=o.indexOf(s);l!==-1&&o.splice(l,1),t.set(r,o)}}}var ur,wm=()=>ur||(ur=Cm()),Kc=n=>{const[e,t]=d.useState({width:0,height:0});d.useLayoutEffect(()=>{if(n.current){const{width:r,height:s}=n.current.getBoundingClientRect();t({width:r,height:s})}},[n.current]);const i=d.useCallback(r=>t(r.contentRect),[]);return Tm(n,i),e};function Ee(n,e){const[t,i]=d.useState(e);return d.useEffect(()=>{if(typeof window>"u"||!n)return;const r=n.subscribe(i);return()=>r.unsubscribe()},[n]),t}function Em(n){const e=s=>typeof window<"u"?window.matchMedia(s).matches:!1,[t,i]=d.useState(e(n));function r(){i(e(n))}return d.useEffect(()=>{const s=window.matchMedia(n);return r(),s.addListener?s.addListener(r):s.addEventListener("change",r),()=>{s.removeListener?s.removeListener(r):s.removeEventListener("change",r)}},[n]),t}function $c(n,e){if(e.msg==="show_chat")return Ke(O({},n),{showChat:!0,unreadMessages:0});if(e.msg==="hide_chat")return Ke(O({},n),{showChat:!1});if(e.msg==="toggle_chat"){const t=Ke(O({},n),{showChat:!n.showChat});return t.showChat===!0&&(t.unreadMessages=0),t}else return e.msg==="unread_msg"?Ke(O({},n),{unreadMessages:e.count}):O({},n)}function Qc(n,e){return e.msg==="set_pin"?[e.trackReference]:e.msg==="clear_pin"?[]:O({},n)}var qi=d.createContext(void 0);function xm(){const n=d.useContext(qi);if(!n)throw Error("Tried to access LayoutContext context outside a LayoutContextProvider provider.");return n}function Pm(n){const e=oi();if(n??(n=e),!n)throw Error("Tried to access LayoutContext context outside a LayoutContextProvider provider.");return n}function Rm(){const[n,e]=d.useReducer(Qc,Uc),[t,i]=d.useReducer($c,jc);return{pin:{dispatch:e,state:n},widget:{dispatch:i,state:t}}}function Nm(n){const[e,t]=d.useReducer(Qc,Uc),[i,r]=d.useReducer($c,jc);return n??{pin:{dispatch:t,state:e},widget:{dispatch:r,state:i}}}function oi(){return d.useContext(qi)}var ms=d.createContext(void 0);function hn(){return d.useContext(ms)}var Yc=d.createContext(void 0);function gs(){return d.useContext(Yc)}function bt(n){var e;const t=gs(),i=hn(),r=(e=n??t)!=null?e:i==null?void 0:i.participant;if(!r)throw new Error("No participant provided, make sure you are inside a participant context or pass the participant explicitly");return r}var vs=d.createContext(void 0);function zi(){const n=d.useContext(vs);if(!n)throw Error("tried to access room context outside of livekit room component");return n}function Wi(){return d.useContext(vs)}function Hi(n){const e=Wi(),t=n??e;if(!t)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return t}var Zc=d.createContext(void 0);function Im(n){const e=d.useContext(Zc);if(n===!0){if(e)return e;throw Error("tried to access feature context, but none is present")}return e}function Mm(...n){return(...e)=>{for(const t of n)typeof t=="function"&&t(...e)}}function fn(...n){const e=O({},n[0]);for(let t=1;t<n.length;t++){const i=n[t];for(const r in i){const s=e[r],a=i[r];typeof s=="function"&&typeof a=="function"&&r[0]==="o"&&r[1]==="n"&&r.charCodeAt(2)>=65&&r.charCodeAt(2)<=90?e[r]=Mm(s,a):(r==="className"||r==="UNSAFE_className")&&typeof s=="string"&&typeof a=="string"?e[r]=vl(s,a):e[r]=a!==void 0?a:s}}return e}function _m(n={}){const e=bt(n.participant),{className:t,connectionQualityObserver:i}=d.useMemo(()=>tm(e),[e]),r=Ee(i,Ge.Unknown);return{className:t,quality:r}}function Xc(n){const e=Hi(n),t=d.useMemo(()=>Bp(e),[e]);return Ee(t,e.state)}function Dm(n){const e=zi(),t=Xc(e);return{buttonProps:d.useMemo(()=>{const{className:r,disconnect:s}=em(e);return fn(n,{className:r,onClick:()=>{var o;return s((o=n.stopTracks)!=null?o:!0)},disabled:t===F.Disconnected})},[e,n,t])}}function Am(n){if(n.publication instanceof ti){const e=n.publication.track;if(e){const{facingMode:t}=ef(e);return t}}return"undefined"}function Om({trackRef:n,trackSource:e,participant:t,props:i}){const r=bt(t);if(!n&&!e)throw new Error("trackRef or trackSource must be defined.");const s=oi(),{className:a}=d.useMemo(()=>fm(),[]),o=d.useMemo(()=>{if(n)return Ur(n,s==null?void 0:s.pin.state);if(e){const c=r.getTrack(e);return s!=null&&s.pin.state&&c?Ur({participant:r,source:e,publication:c},s.pin.state):!1}else throw new Error("trackRef or trackSource and participant must be defined.")},[n,s==null?void 0:s.pin.state,r,e]);return{mergedProps:d.useMemo(()=>fn(i,{className:a,onClick:c=>{var u,h,p,v,b;if((u=i.onClick)==null||u.call(i,c),n&&te(n))o?(p=s==null?void 0:(h=s.pin).dispatch)==null||p.call(h,{msg:"clear_pin"}):(b=s==null?void 0:(v=s.pin).dispatch)==null||b.call(v,{msg:"set_pin",trackReference:n});else if(e){const g=r.getTrack(e);s!=null&&s.pin.dispatch&&g&&(o?s.pin.dispatch({msg:"clear_pin"}):s.pin.dispatch({msg:"set_pin",trackReference:{participant:r,publication:g,source:g.source}}))}}}),[i,a,n,e,o,s==null?void 0:s.pin,r]),inFocus:o}}function Lm(n,e){const{width:t,height:i}=Kc(n),r=t>0&&i>0?Lc(ya,e,t,i):ya[0];return d.useEffect(()=>{n.current&&r&&(n.current.style.setProperty("--lk-col-count",r==null?void 0:r.columns.toString()),n.current.style.setProperty("--lk-row-count",r==null?void 0:r.rows.toString()))},[n,r]),{layout:r}}function Ca(n,e={}){var t,i;const r=typeof n=="string"?e.participant:n.participant,s=bt(r),a=typeof n=="string"?{participant:s,source:n}:n,[o,l]=d.useState(!!((t=a.publication)!=null&&t.isMuted||(i=s.getTrack(a.source))!=null&&i.isMuted));return d.useEffect(()=>{const c=qc(a).subscribe(l);return()=>c.unsubscribe()},[ee(a)]),o}function Um(n){const e=bt(n),t=d.useMemo(()=>$p(e),[e]);return Ee(t,e.isSpeaking)}var jm={connect:!0,audio:!1,video:!1};function Fm(n){const e=O(O({},jm),n),{token:t,serverUrl:i,options:r,room:s,connectOptions:a,connect:o,audio:l,video:c,screen:u,onConnected:h,onDisconnected:p,onError:v,onMediaDeviceFailure:b,simulateParticipants:g}=e,S=Y(e,["token","serverUrl","options","room","connectOptions","connect","audio","video","screen","onConnected","onDisconnected","onError","onMediaDeviceFailure","simulateParticipants"]);r&&s&&J.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[k,C]=d.useState();d.useEffect(()=>{C(s??new Ni(r))},[s]);const I=d.useMemo(()=>{const{className:E}=pm();return fn(S,{className:E})},[S]);return d.useEffect(()=>{if(!k)return;const E=()=>{const L=k.localParticipant;J.debug("trying to publish local tracks"),Promise.all([L.setMicrophoneEnabled(!!l,typeof l!="boolean"?l:void 0),L.setCameraEnabled(!!c,typeof c!="boolean"?c:void 0),L.setScreenShareEnabled(!!u,typeof u!="boolean"?u:void 0)]).catch(V=>{J.warn(V),v==null||v(V)})},D=L=>{const V=Zn.getFailure(L);b==null||b(V)};return k.on(x.SignalConnected,E),k.on(x.MediaDevicesError,D),()=>{k.off(x.SignalConnected,E),k.off(x.MediaDevicesError,D)}},[k,l,c,u,v]),d.useEffect(()=>{if(k){if(g){k.simulateParticipants({participants:{count:g},publish:{audio:!0,useRealTracks:!0}});return}if(!t){J.debug("no token yet");return}if(!i){J.warn("no livekit url provided"),v==null||v(Error("no livekit url provided"));return}o?(J.debug("connecting"),k.connect(i,t,a).catch(E=>{J.warn(E),v==null||v(E)})):(J.debug("disconnecting because connect is false"),k.disconnect())}},[o,t,JSON.stringify(a),k,v,i,g]),d.useEffect(()=>{if(!k)return;const E=D=>{switch(D){case F.Disconnected:p&&p();break;case F.Connected:h&&h();break}};return k.on(x.ConnectionStateChanged,E),()=>{k.off(x.ConnectionStateChanged,E)}},[t,h,p,k]),d.useEffect(()=>{if(k)return()=>{J.info("disconnecting on onmount"),k.disconnect()}},[k]),{room:k,htmlProps:I}}function Bm(){const n=zi(),e=d.useMemo(()=>Qp(n.localParticipant),[n]);return Ee(e,n.localParticipant.permissions)}function Jm({kind:n,room:e,track:t,requestPermissions:i}){const r=Wi(),s=d.useMemo(()=>Jp(n,i),[n,i]),a=Ee(s,[]),[o,l]=d.useState(""),{className:c,activeDeviceObservable:u,setActiveMediaDevice:h}=d.useMemo(()=>Xp(n,e??r,t),[n,e,r,t]);return d.useEffect(()=>{const p=u.subscribe(v=>{J.info("setCurrentDeviceId",v),v&&l(v)});return()=>{p==null||p.unsubscribe()}},[u]),{devices:a,className:c,activeDeviceId:o,setActiveMediaDevice:h}}function Vm(n){return n!==void 0}function Yt(...n){return fn(...n.filter(Vm))}function el(n,e,t){return d.Children.map(n,i=>d.isValidElement(i)&&d.Children.only(n)?d.cloneElement(i,Ke(O({},e),{key:t})):i)}function tl(n,e={}){var t;const[i,r]=d.useState(Jr(n)),[s,a]=d.useState(i==null?void 0:i.isMuted),[o,l]=d.useState(i==null?void 0:i.isSubscribed),[c,u]=d.useState(i==null?void 0:i.track),[h,p]=d.useState("landscape"),v=d.useRef(),{className:b,trackObserver:g}=d.useMemo(()=>Hp(n),[(t=n.participant.sid)!=null?t:n.participant.identity,n.source,te(n)&&n.publication.trackSid]);return d.useEffect(()=>{const S=g.subscribe(k=>{J.debug("update track",k),r(k),a(k==null?void 0:k.isMuted),l(k==null?void 0:k.isSubscribed),u(k==null?void 0:k.track)});return()=>S==null?void 0:S.unsubscribe()},[g]),d.useEffect(()=>{var S,k;return c&&(v.current&&c.detach(v.current),(S=e.element)!=null&&S.current&&!(Oc(n.participant)&&(c==null?void 0:c.kind)==="audio")&&c.attach(e.element.current)),v.current=(k=e.element)==null?void 0:k.current,()=>{v.current&&(c==null||c.detach(v.current))}},[c,e.element]),d.useEffect(()=>{var S,k;if(typeof((S=i==null?void 0:i.dimensions)==null?void 0:S.width)=="number"&&typeof((k=i==null?void 0:i.dimensions)==null?void 0:k.height)=="number"){const C=i.dimensions.width>i.dimensions.height?"landscape":"portrait";p(C)}},[i]),{publication:i,isMuted:s,isSubscribed:o,track:c,elementProps:Yt(e.props,O({className:b,"data-lk-local-participant":n.participant.isLocal,"data-lk-source":i==null?void 0:i.source},(i==null?void 0:i.kind)==="video"&&{"data-lk-orientation":h}))}}function nl(n,e,t={}){const i=d.useRef([]),r=d.useRef(-1),s=e!==r.current,a=typeof t.customSortFunction=="function"?t.customSortFunction(n):Np(n);let o=[...a];if(s===!1)try{o=jp(i.current,a,e)}catch(l){J.error("Error while running updatePages(): ",l)}return s?i.current=a:i.current=o,r.current=e,o}function qm(n,e){const[t,i]=d.useState(1),r=Math.max(Math.ceil(e.length/n),1);t>r&&i(r);const s=t*n,a=s-n,o=h=>{i(p=>h==="next"?p===r?p:p+1:p===1?p:p-1)},l=h=>{h>r?i(r):h<1?i(1):i(h)},u=nl(e,n).slice(a,s);return{totalPageCount:r,nextPage:()=>o("next"),prevPage:()=>o("previous"),setPage:l,firstItemIndex:a,lastItemIndex:s,tracks:u,currentPage:t}}function zm({trackRef:n,participant:e,source:t,publication:i,onParticipantClick:r,disableSpeakingIndicator:s,htmlProps:a}){const o=hn(),l=bt(e),c=d.useMemo(()=>{var g,S,k,C,I,E;const D=(S=(g=n==null?void 0:n.source)!=null?g:o==null?void 0:o.source)!=null?S:t;if(D===void 0)throw new Error("Missing track `source`, provided it via `trackRef`, `source` property or via `TrackRefContext`.");return{participant:(C=(k=n==null?void 0:n.participant)!=null?k:o==null?void 0:o.participant)!=null?C:l,publication:(E=(I=n==null?void 0:n.publication)!=null?I:o==null?void 0:o.publication)!=null?E:i,source:D}},[n==null?void 0:n.participant,n==null?void 0:n.source,n==null?void 0:n.publication,o==null?void 0:o.participant,o==null?void 0:o.source,o==null?void 0:o.publication,l,t,i]),u=d.useMemo(()=>{const{className:g}=rm();return fn(a,{className:g,onClick:S=>{var k,C;if((k=a.onClick)==null||k.call(a,S),typeof r=="function"){const I=(C=c.publication)!=null?C:c.participant.getTrack(c.source);r({participant:c.participant,track:I})}}})},[a,r,c.publication,c.source,c.participant]),h=Ca(w.Source.Camera,{participant:c.participant}),p=Ca(w.Source.Microphone,{participant:c.participant}),v=Um(c.participant),b=Am(c);return{elementProps:O({"data-lk-audio-muted":p,"data-lk-video-muted":h,"data-lk-speaking":s===!0?!1:v,"data-lk-local-participant":c.participant.isLocal,"data-lk-source":c.source,"data-lk-facing-mode":b},u)}}function Wm(n){return n=Pm(n),d.useMemo(()=>(n==null?void 0:n.pin.state)!==void 0&&n.pin.state.length>=1?n.pin.state:[],[n.pin.state])}function Hm({room:n,props:e}){const t=Hi(n),{className:i,roomAudioPlaybackAllowedObservable:r,handleStartAudioPlayback:s}=d.useMemo(()=>dm(),[]),a=d.useMemo(()=>r(t),[t,r]),{canPlayAudio:o}=Ee(a,{canPlayAudio:!1});return{mergedProps:d.useMemo(()=>fn(e,{className:i,onClick:()=>{s(t)},style:{display:o?"none":"block"}}),[e,i,o,s,t]),canPlayAudio:o}}function Gm(n,e={}){var t;const i=d.useRef(null),r=d.useRef(null),s=(t=e.minSwipeDistance)!=null?t:50,a=c=>{r.current=null,i.current=c.targetTouches[0].clientX},o=c=>{r.current=c.targetTouches[0].clientX},l=d.useCallback(()=>{if(!i.current||!r.current)return;const c=i.current-r.current,u=c>s,h=c<-s;u&&e.onLeftSwipe&&e.onLeftSwipe(),h&&e.onRightSwipe&&e.onRightSwipe()},[s,e]);d.useEffect(()=>{const c=n.current;return c&&(c.addEventListener("touchstart",a,{passive:!0}),c.addEventListener("touchmove",o,{passive:!0}),c.addEventListener("touchend",l,{passive:!0})),()=>{c&&(c.removeEventListener("touchstart",a),c.removeEventListener("touchmove",o),c.removeEventListener("touchend",l))}},[n,l])}function Km({props:n}){const{dispatch:e,state:t}=xm().widget,{className:i}=d.useMemo(()=>hm(),[]);return{mergedProps:d.useMemo(()=>fn(n,{className:i,onClick:()=>{e&&e({msg:"toggle_chat"})},"aria-pressed":t!=null&&t.showChat?"true":"false","data-lk-unread-msgs":t?t.unreadMessages<10?t.unreadMessages.toFixed(0):"9+":"0"}),[n,i,e,t])}}function $m(n,e={}){var t,i,r;let s=hn();const a=(t=gs())!=null?t:e.participant;if(typeof n=="string"){if(!a)throw Error("Participant missing, either provide it via context or pass it in directly");s={participant:a,source:n}}else if(n)s=n;else throw Error("No track reference found, either provide it via context or pass it in directly");const{className:o,mediaMutedObserver:l}=d.useMemo(()=>nm(s),[ee(s)]);return{isMuted:Ee(l,!!((i=s.publication)!=null&&i.isMuted||(r=s.participant.getTrack(s.source))!=null&&r.isMuted)),className:o}}function Qm(n){var e=n,{source:t,onChange:i,initialState:r,captureOptions:s}=e,a=Y(e,["source","onChange","initialState","captureOptions"]),o;const l=Wi(),c=(o=l==null?void 0:l.localParticipant)==null?void 0:o.getTrack(t),{toggle:u,className:h,pendingObserver:p,enabledObserver:v}=d.useMemo(()=>l?Yp(t,l,s):Zp(),[l,t,JSON.stringify(s)]),b=Ee(p,!1),g=Ee(v,r??!!(c!=null&&c.isEnabled));d.useEffect(()=>{i==null||i(g)},[g,i]),d.useEffect(()=>{r!==void 0&&(J.debug("forcing initial toggle state",t,r),u(r))},[]);const S=d.useMemo(()=>fn(a,{className:h}),[a,h]),k=d.useCallback(C=>{var I;u(),(I=a.onClick)==null||I.call(a,C)},[a,u]);return{toggle:u,enabled:g,pending:b,track:c,buttonProps:Ke(O({},S),{"aria-pressed":g,"data-lk-source":t,"data-lk-enabled":g,disabled:b,onClick:k})}}function il(n=[w.Source.Camera,w.Source.Microphone,w.Source.ScreenShare,w.Source.ScreenShareAudio,w.Source.Unknown],e={}){const t=Hi(e.room),[i,r]=d.useState([]),[s,a]=d.useState([]),o=d.useMemo(()=>n.map(c=>Fc(c)?c.source:c),[JSON.stringify(n)]);return d.useEffect(()=>{const c=mm(t,o,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:u,participants:h})=>{J.debug("setting track bundles",u,h),r(u),a(h)});return()=>c.unsubscribe()},[t,JSON.stringify(e.updateOnlyOn),JSON.stringify(n)]),d.useMemo(()=>{if(Bc(n)){const c=Zm(n,s),u=Array.from(i);return s.forEach(h=>{var p;c.has(h.identity)&&((p=c.get(h.identity))!=null?p:[]).forEach(b=>{if(i.find(({participant:S,publication:k})=>h.identity===S.identity&&k.source===b))return;J.debug(`Add ${b} placeholder for participant ${h.identity}.`);const g={participant:h,source:b};u.push(g)})}),u}else return i},[i,s,n])}function Ym(n,e){const t=new Set(n);for(const i of e)t.delete(i);return t}function Zm(n,e){const t=new Map;if(Bc(n)){const i=n.filter(r=>r.withPlaceholder).map(r=>r.source);e.forEach(r=>{const s=r.getTracks().map(o=>{var l;return(l=o.track)==null?void 0:l.source}).filter(o=>o!==void 0),a=Array.from(Ym(new Set(i),new Set(s)));a.length>0&&t.set(r.identity,a)})}return t}function Xm(n){const e=zi(),[t,i]=d.useState(),r=Ee(t==null?void 0:t.isSendingObservable,!1),s=Ee(t==null?void 0:t.messageObservable,[]);return d.useEffect(()=>{const a=um(e,n);return i(a),a.destroy},[e,n]),{send:t==null?void 0:t.send,chatMessages:s,isSending:r}}function eg(n){const{mergedProps:e}=Km({props:n});return d.createElement("button",O({},e),n.children)}function tg(n){const{buttonProps:e}=Dm(n);return d.createElement("button",O({},e),n.children)}var ng=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},n),d.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),d.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),ig=ng,rg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},n),d.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),sg=rg,ag=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:18,fill:"none"},n),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h10.5A2.75 2.75 0 0 1 16 2.75v13.594a.75.75 0 0 1-1.234.572l-3.691-3.12a1.25 1.25 0 0 0-.807-.296H2.75A2.75 2.75 0 0 1 0 10.75v-8ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v8c0 .69.56 1.25 1.25 1.25h7.518c.65 0 1.279.23 1.775.65l2.457 2.077V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M3 4.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Z",clipRule:"evenodd"})),og=ag,cg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},n),d.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M5.293 2.293a1 1 0 0 1 1.414 0l4.823 4.823a1.25 1.25 0 0 1 0 1.768l-4.823 4.823a1 1 0 0 1-1.414-1.414L9.586 8 5.293 3.707a1 1 0 0 1 0-1.414z",clipRule:"evenodd"})),wa=cg,lg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},n),d.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},d.createElement("path",{d:"M10 1.75h4.25m0 0V6m0-4.25L9 7M6 14.25H1.75m0 0V10m0 4.25L7 9"}))),ug=lg,dg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},n),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M2 2.75A2.75 2.75 0 0 1 4.75 0h6.5A2.75 2.75 0 0 1 14 2.75v10.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-.5a.75.75 0 0 1 1.5 0v.5c0 .69.56 1.25 1.25 1.25h6.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25h-6.5c-.69 0-1.25.56-1.25 1.25v.5a.75.75 0 0 1-1.5 0v-.5Z",clipRule:"evenodd"}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8.78 7.47a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H1.75a.75.75 0 0 1 0-1.5h4.69l-.97-.97a.75.75 0 0 1 1.06-1.06l2.25 2.25Z",clipRule:"evenodd"})),hg=dg,fg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},n),d.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M4 6.104V4a4 4 0 1 1 8 0v2.104c1.154.326 2 1.387 2 2.646v4.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-4.5c0-1.259.846-2.32 2-2.646ZM5.5 4a2.5 2.5 0 0 1 5 0v2h-5V4Z",clipRule:"evenodd"})),pg=fg,mg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},n),d.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),d.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),gg=mg,vg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},n),d.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),d.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),bg=vg,yg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},n),d.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),d.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"})),kg=yg,Sg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},n),d.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),d.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),d.createElement("g",{opacity:.25},d.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),d.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),Tg=Sg,Cg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentcolor"},n),d.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),d.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),d.createElement("g",{opacity:.25},d.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),d.createElement("path",{d:"M6 6.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}),d.createElement("path",{d:"M12 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5z"}))),wg=Cg,Eg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},n),d.createElement("g",{opacity:.25},d.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}),d.createElement("path",{d:"M0 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-4Zm6-5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-9Zm6-6a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V.5Z"}))),xg=Eg,Pg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},n),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),rl=Pg,Rg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},n),d.createElement("g",{fill:"currentColor"},d.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),d.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),Ng=Rg,Ig=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},n),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 0a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0Z",clipRule:"evenodd"}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 12a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-1.5 0v-2.5A.75.75 0 0 1 8 12Z",clipRule:"evenodd",opacity:.7}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M12 1.072a.75.75 0 0 1 .274 1.024l-1.25 2.165a.75.75 0 0 1-1.299-.75l1.25-2.165A.75.75 0 0 1 12 1.072Z",clipRule:"evenodd"}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M6 11.464a.75.75 0 0 1 .274 1.025l-1.25 2.165a.75.75 0 0 1-1.299-.75l1.25-2.165A.75.75 0 0 1 6 11.464Z",clipRule:"evenodd",opacity:.6}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M14.928 4a.75.75 0 0 1-.274 1.025l-2.165 1.25a.75.75 0 1 1-.75-1.3l2.165-1.25A.75.75 0 0 1 14.928 4Z",clipRule:"evenodd"}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.536 10a.75.75 0 0 1-.275 1.024l-2.165 1.25a.75.75 0 0 1-.75-1.298l2.165-1.25A.75.75 0 0 1 4.536 10Z",clipRule:"evenodd",opacity:.5}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M16 8a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h2.5A.75.75 0 0 1 16 8Z",clipRule:"evenodd"}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M4 8a.75.75 0 0 1-.75.75H.75a.75.75 0 0 1 0-1.5h2.5A.75.75 0 0 1 4 8Z",clipRule:"evenodd",opacity:.4}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M14.928 12a.75.75 0 0 1-1.024.274l-2.165-1.25a.75.75 0 0 1 .75-1.299l2.165 1.25A.75.75 0 0 1 14.928 12Z",clipRule:"evenodd",opacity:.9}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.536 6a.75.75 0 0 1-1.025.275l-2.165-1.25a.75.75 0 1 1 .75-1.3l2.165 1.25A.75.75 0 0 1 4.536 6Z",clipRule:"evenodd",opacity:.3}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M12 14.928a.75.75 0 0 1-1.024-.274l-1.25-2.165a.75.75 0 0 1 1.298-.75l1.25 2.165A.75.75 0 0 1 12 14.928Z",clipRule:"evenodd",opacity:.8}),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M6 4.536a.75.75 0 0 1-1.024-.275l-1.25-2.165a.75.75 0 1 1 1.299-.75l1.25 2.165A.75.75 0 0 1 6 4.536Z",clipRule:"evenodd",opacity:.2})),Ea=Ig,Mg=n=>d.createElement("svg",O({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},n),d.createElement("g",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},d.createElement("path",{d:"M13.25 7H9m0 0V2.75M9 7l5.25-5.25M2.75 9H7m0 0v4.25M7 9l-5.25 5.25"}))),_g=Mg;function Dg(n){var e=n,{trackRef:t,trackSource:i,participant:r}=e,s=Y(e,["trackRef","trackSource","participant"]);const a=hn(),{mergedProps:o,inFocus:l}=Om({trackRef:t??a,trackSource:i,participant:r,props:s});return d.createElement(qi.Consumer,null,c=>c!==void 0&&d.createElement("button",O({},o),s.children?s.children:l?d.createElement(_g,null):d.createElement(ug,null)))}function dr(n){var e=n,{kind:t,initialSelection:i,onActiveDeviceChange:r,onDeviceListChange:s,onDeviceSelectError:a,exactMatch:o,track:l,requestPermissions:c}=e,u=Y(e,["kind","initialSelection","onActiveDeviceChange","onDeviceListChange","onDeviceSelectError","exactMatch","track","requestPermissions"]);const h=Wi(),{devices:p,activeDeviceId:v,setActiveMediaDevice:b,className:g}=Jm({kind:t,room:h,track:l,requestPermissions:c});d.useEffect(()=>{i!==void 0&&b(i)},[b]),d.useEffect(()=>{typeof s=="function"&&s(p)},[s,p]),d.useEffect(()=>{v&&v!==""&&(r==null||r(v))},[v]);const S=I=>Gc(this,null,function*(){try{yield b(I,{exact:o})}catch(E){if(E instanceof Error)a==null||a(E);else throw E}}),k=d.useMemo(()=>Yt(u,{className:g},{className:"lk-list"}),[g,u]);function C(I,E,D){return I===E||D===0&&E==="default"}return d.createElement("ul",O({},k),p.map((I,E)=>d.createElement("li",{key:I.deviceId,id:I.deviceId,"data-lk-active":C(I.deviceId,v,E),"aria-selected":C(I.deviceId,v,E),role:"option"},d.createElement("button",{className:"lk-button",onClick:()=>S(I.deviceId)},I.label))))}function Ag(n){var e=n,{label:t="Allow Audio"}=e,i=Y(e,["label"]);const r=zi(),{mergedProps:s}=Hm({room:r,props:i});return d.createElement("button",O({},s),t)}function sl(n,e){switch(n){case w.Source.Microphone:return e?d.createElement(bg,null):d.createElement(gg,null);case w.Source.Camera:return e?d.createElement(sg,null):d.createElement(ig,null);case w.Source.ScreenShare:return e?d.createElement(Ng,null):d.createElement(rl,null);default:return}}function Og(n){switch(n){case Ge.Excellent:return d.createElement(kg,null);case Ge.Good:return d.createElement(Tg,null);case Ge.Poor:return d.createElement(wg,null);default:return d.createElement(xg,null)}}function hr(n){var e=n,{showIcon:t}=e,i=Y(e,["showIcon"]);const{buttonProps:r,enabled:s}=Qm(i);return d.createElement("button",O({},r),(t??!0)&&sl(i.source,s),i.children)}function Lg(n){var e;const{className:t,quality:i}=_m(n),r=d.useMemo(()=>Ke(O({},Yt(n,{className:t})),{"data-lk-quality":i}),[i,n,t]);return d.createElement("div",O({},r),(e=n.children)!=null?e:Og(i))}function xa(n){var e=n,{participant:t}=e,i=Y(e,["participant"]);const r=bt(t),{className:s,infoObserver:a}=d.useMemo(()=>im(r),[r]),{identity:o,name:l}=Ee(a,{name:r.name,identity:r.identity,metadata:r.metadata}),c=d.useMemo(()=>Yt(i,{className:s,"data-lk-participant-name":l}),[i,s,l]);return d.createElement("span",O({},c),l!==""?l:o,i.children)}function Ug(n){var e=n,{source:t,participant:i,trackRef:r,show:s="always"}=e,a=Y(e,["source","participant","trackRef","show"]),o,l;const{className:c,isMuted:u}=$m(r??t,{participant:i}),h=s==="always"||s==="muted"&&u||s==="unmuted"&&!u,p=d.useMemo(()=>Yt(a,{className:c}),[c,a]);return h?d.createElement("div",Ke(O({},p),{"data-lk-muted":u}),(l=a.children)!=null?l:sl((o=r==null?void 0:r.source)!=null?o:t,!u)):null}var jg=n=>d.createElement("svg",O({width:320,height:320,viewBox:"0 0 320 320",preserveAspectRatio:"xMidYMid meet",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),d.createElement("path",{d:"M160 180C204.182 180 240 144.183 240 100C240 55.8172 204.182 20 160 20C115.817 20 79.9997 55.8172 79.9997 100C79.9997 144.183 115.817 180 160 180Z",fill:"white",fillOpacity:.25}),d.createElement("path",{d:"M97.6542 194.614C103.267 191.818 109.841 192.481 115.519 195.141C129.025 201.466 144.1 205 159.999 205C175.899 205 190.973 201.466 204.48 195.141C210.158 192.481 216.732 191.818 222.345 194.614C262.703 214.719 291.985 253.736 298.591 300.062C300.15 310.997 291.045 320 280 320H39.9997C28.954 320 19.8495 310.997 21.4087 300.062C28.014 253.736 57.2966 214.72 97.6542 194.614Z",fill:"white",fillOpacity:.25})),Fg=jg;function Bg(n){var e=n,{onTrackClick:t,onClick:i,onSubscriptionStatusChanged:r,trackRef:s,name:a,publication:o,source:l,participant:c,manageSubscription:u}=e,h=Y(e,["onTrackClick","onClick","onSubscriptionStatusChanged","trackRef","name","publication","source","participant","manageSubscription"]),p,v,b,g,S,k,C,I,E,D;const L=hn(),V=(g=(b=(p=s==null?void 0:s.publication)==null?void 0:p.trackName)!=null?b:(v=L==null?void 0:L.publication)==null?void 0:v.trackName)!=null?g:a,B=(k=(S=s==null?void 0:s.source)!=null?S:L==null?void 0:L.source)!=null?k:l,N=(I=(C=s==null?void 0:s.publication)!=null?C:L==null?void 0:L.publication)!=null?I:o,U=(D=(E=s==null?void 0:s.participant)!=null?E:L==null?void 0:L.participant)!=null?D:c;if(B===void 0)throw new Error("VideoTrack: You must provide a trackRef or source property.");const q=bt(U),ke=d.useRef(null),Fe=bm(ke,{}),Gi=vm(Fe,3e3);d.useEffect(()=>{u&&N instanceof Ri&&(Gi==null?void 0:Gi.isIntersecting)===!1&&(Fe==null?void 0:Fe.isIntersecting)===!1&&N.setSubscribed(!1)},[Gi,N,u]),d.useEffect(()=>{u&&N instanceof Ri&&(Fe==null?void 0:Fe.isIntersecting)===!0&&N.setSubscribed(!0)},[Fe,N,u]);const{elementProps:ll,publication:ul,isSubscribed:bs}=tl({participant:q,name:V,source:B,publication:N},{element:ke,props:h});d.useEffect(()=>{r==null||r(!!bs)},[bs,r]);const dl=hl=>{i==null||i(hl),t==null||t({participant:q,track:ul})};return d.createElement("video",Ke(O({ref:ke},ll),{muted:!0,onClick:dl}))}function al(n){var e=n,{trackRef:t,onSubscriptionStatusChanged:i,volume:r,source:s,name:a,publication:o,participant:l}=e,c=Y(e,["trackRef","onSubscriptionStatusChanged","volume","source","name","publication","participant"]),u,h,p,v,b,g,S,k,C,I;const E=hn(),D=(v=(p=(u=t==null?void 0:t.publication)==null?void 0:u.trackName)!=null?p:(h=E==null?void 0:E.publication)==null?void 0:h.trackName)!=null?v:a,L=(g=(b=t==null?void 0:t.source)!=null?b:E==null?void 0:E.source)!=null?g:s,V=(k=(S=t==null?void 0:t.publication)!=null?S:E==null?void 0:E.publication)!=null?k:o,B=(I=(C=t==null?void 0:t.participant)!=null?C:E==null?void 0:E.participant)!=null?I:l;if(L===void 0)throw new Error("The AudioTrack component expects a trackRef or source property.");const N=d.useRef(null),U=bt(B),{elementProps:q,isSubscribed:ke,track:Fe}=tl({source:L,name:D,participant:U,publication:V},{element:N,props:c});return d.useEffect(()=>{i==null||i(!!ke)},[ke,i]),d.useEffect(()=>{Fe===void 0||r===void 0||(Fe instanceof Nn?Fe.setVolume(r):J.warn("volume can only be set on remote audio tracks"))},[r,Fe]),d.createElement("audio",O({ref:N},q))}function Jg(n){const e=bt(n),t=Hi(),i=d.useMemo(()=>Wp(t,e),[t,e]);return Ee(i,e instanceof ii?e.isE2EEEnabled:e.isEncrypted)}function Vg(n){const e=!!gs();return n.participant&&!e?d.createElement(Yc.Provider,{value:n.participant},n.children):d.createElement(d.Fragment,null,n.children)}function qg(n){const e=!!hn();return n.trackRef&&!e?d.createElement(ms.Provider,{value:n.trackRef},n.children):d.createElement(d.Fragment,null,n.children)}function Vr(n){var e=n,{trackRef:t,participant:i,children:r,source:s=w.Source.Camera,onParticipantClick:a,publication:o,disableSpeakingIndicator:l}=e,c=Y(e,["trackRef","participant","children","source","onParticipantClick","publication","disableSpeakingIndicator"]),u,h;const p=hn(),v=bt(i),b=d.useMemo(()=>{var E,D,L,V,B,N;return{participant:(D=(E=t==null?void 0:t.participant)!=null?E:p==null?void 0:p.participant)!=null?D:v,source:(V=(L=t==null?void 0:t.source)!=null?L:p==null?void 0:p.source)!=null?V:s,publication:(N=(B=t==null?void 0:t.publication)!=null?B:p==null?void 0:p.publication)!=null?N:o}},[p,v,o,s,t]),{elementProps:g}=zm({participant:b.participant,htmlProps:c,source:b.source,publication:b.publication,disableSpeakingIndicator:l,onParticipantClick:a}),S=Jg(v),k=oi(),C=(u=Im())==null?void 0:u.autoSubscription,I=d.useCallback(E=>{b.source&&!E&&k&&k.pin.dispatch&&Ur(b,k.pin.state)&&k.pin.dispatch({msg:"clear_pin"})},[b,k]);return d.createElement("div",O({style:{position:"relative"}},g),d.createElement(qg,{trackRef:b},d.createElement(Vg,{participant:b.participant},r??d.createElement(d.Fragment,null,te(b)&&(((h=b.publication)==null?void 0:h.kind)==="video"||b.source===w.Source.Camera||b.source===w.Source.ScreenShare)?d.createElement(Bg,{trackRef:b,onSubscriptionStatusChanged:I,manageSubscription:C}):te(b)&&d.createElement(al,{trackRef:b,onSubscriptionStatusChanged:I}),d.createElement("div",{className:"lk-participant-placeholder"},d.createElement(Fg,null)),d.createElement("div",{className:"lk-participant-metadata"},d.createElement("div",{className:"lk-participant-metadata-item"},b.source===w.Source.Camera?d.createElement(d.Fragment,null,S&&d.createElement(pg,{style:{marginRight:"0.25rem"}}),d.createElement(Ug,{source:w.Source.Microphone,show:"muted"}),d.createElement(xa,null)):d.createElement(d.Fragment,null,d.createElement(rl,{style:{marginRight:"0.25rem"}}),d.createElement(xa,null,"'s screen"))),d.createElement(Lg,{className:"lk-participant-metadata-item"}))),d.createElement(Dg,{trackRef:b}))))}function zg(n){const e=Yt(n,{className:"lk-focus-layout"});return d.createElement("div",O({},e),n.children)}function Wg(n){var e=n,{trackRef:t,track:i}=e,r=Y(e,["trackRef","track"]);const s=t??i;return d.createElement(Vr,O(O({},s),r))}function ol(n){var e=n,{tracks:t}=e,i=Y(e,["tracks"]);return d.createElement(d.Fragment,null,t.map(r=>d.createElement(ms.Provider,{value:r,key:ee(r)},el(i.children))))}function Hg({totalPageCount:n,nextPage:e,prevPage:t,currentPage:i,pagesContainer:r}){const[s,a]=d.useState(!1);return d.useEffect(()=>{let o;return r&&(o=gm(r.current,2e3).subscribe(a)),()=>{o&&o.unsubscribe()}},[r]),d.createElement("div",{className:"lk-pagination-control","data-lk-user-interaction":s},d.createElement("button",{className:"lk-button",onClick:t},d.createElement(wa,null)),d.createElement("span",{className:"lk-pagination-count"},`${i} of ${n}`),d.createElement("button",{className:"lk-button",onClick:e},d.createElement(wa,null)))}function Gg({totalPageCount:n,currentPage:e}){const t=new Array(n).fill("").map((i,r)=>r+1===e?d.createElement("span",{"data-lk-active":!0,key:r}):d.createElement("span",{key:r}));return d.createElement("div",{className:"lk-pagination-indicator"},t)}function Kg(n){var e=n,{tracks:t}=e,i=Y(e,["tracks"]);const r=d.createRef(),s=d.useMemo(()=>Yt(i,{className:"lk-grid-layout"}),[i]),{layout:a}=Lm(r,t.length),o=qm(a.maxTiles,t);return Gm(r,{onLeftSwipe:o.nextPage,onRightSwipe:o.prevPage}),d.createElement("div",O({ref:r,"data-lk-pagination":o.totalPageCount>1},s),d.createElement(ol,{tracks:o.tracks},i.children),t.length>a.maxTiles&&d.createElement(d.Fragment,null,d.createElement(Gg,{totalPageCount:o.totalPageCount,currentPage:o.currentPage}),d.createElement(Hg,O({pagesContainer:r},o))))}var $g=130,Qg=140,Pa=1,cl=16/10,Yg=(1-cl)*-1;function Zg(n){var e=n,{tracks:t,orientation:i}=e,r=Y(e,["tracks","orientation"]);const s=d.useRef(null),[a,o]=d.useState(0),{width:l,height:c}=Kc(s),u=i||(c>=l?"vertical":"horizontal"),h=u==="vertical"?Math.max(l*Yg,$g):Math.max(c*cl,Qg),p=gp(),v=Math.max(u==="vertical"?(c-p)/h:(l-p)/h,Pa);let b=Math.round(v);Math.abs(v-a)<.5?b=Math.round(a):a!==v&&o(v);const g=nl(t,b);return d.useLayoutEffect(()=>{s.current&&(s.current.dataset.lkOrientation=u,s.current.style.setProperty("--lk-max-visible-tiles",b.toString()))},[b,u]),d.createElement("aside",O({key:u,className:"lk-carousel",ref:s},r),d.createElement(ol,{tracks:g},r.children))}function Xg({value:n,onPinChange:e,onWidgetChange:t,children:i}){const r=Nm(n);return d.useEffect(()=>{J.debug("PinState Updated",{state:r.pin.state}),e&&r.pin.state&&e(r.pin.state)},[r.pin.state,e]),d.useEffect(()=>{J.debug("Widget Updated",{widgetState:r.widget.state}),t&&r.widget.state&&t(r.widget.state)},[t,r.widget.state]),d.createElement(qi.Provider,{value:r},i)}function ev(n){const{room:e,htmlProps:t}=Fm(n);return d.createElement("div",O({},t),e&&d.createElement(vs.Provider,{value:e},d.createElement(Zc.Provider,{value:n.featureFlags},n.children)))}function tv(){const n=il([w.Source.Microphone,w.Source.ScreenShareAudio],{updateOnlyOn:[],onlySubscribed:!1}).filter(e=>!Oc(e.participant));return d.useEffect(()=>{n.forEach(e=>e.publication.setSubscribed(!0))},[n]),d.createElement("div",{style:{display:"none"}},n.map(e=>d.createElement(al,{key:ee(e),trackRef:e})))}function nv(n){const e=d.useMemo(()=>Yt(n,{className:"lk-toast"}),[n]);return d.createElement("div",O({},e),n.children)}function iv(n){const[e,t]=d.useState(void 0),i=Xc(n.room);return d.useEffect(()=>{switch(i){case F.Reconnecting:t(d.createElement(d.Fragment,null,d.createElement(Ea,{className:"lk-spinner"})," Reconnecting"));break;case F.Connecting:t(d.createElement(d.Fragment,null,d.createElement(Ea,{className:"lk-spinner"})," Connecting"));break;case F.Disconnected:t(d.createElement(d.Fragment,null,"Disconnected"));break;default:t(void 0);break}},[i]),e?d.createElement(nv,{className:"lk-toast-connection-state"},e):d.createElement(d.Fragment,null)}function rv(n){var e=n,{entry:t,hideName:i=!1,hideTimestamp:r=!1,messageFormatter:s}=e,a=Y(e,["entry","hideName","hideTimestamp","messageFormatter"]),o,l,c,u;const h=d.useMemo(()=>s?s(t.message):t.message,[t.message,s]),p=new Date(t.timestamp),v=navigator?navigator.language:"en-US";return d.createElement("li",O({className:"lk-chat-entry",title:p.toLocaleTimeString(v,{timeStyle:"full"}),"data-lk-message-origin":(o=t.from)!=null&&o.isLocal?"local":"remote"},a),(!r||!i)&&d.createElement("span",{className:"lk-meta-data"},!i&&d.createElement("strong",{className:"lk-participant-name"},(u=(l=t.from)==null?void 0:l.name)!=null?u:(c=t.from)==null?void 0:c.identity),!r&&d.createElement("span",{className:"lk-timestamp"},p.toLocaleTimeString(v,{timeStyle:"short"}))),d.createElement("span",{className:"lk-message-body"},h))}function sv(n){var e=n,{messageFormatter:t,messageDecoder:i,messageEncoder:r}=e,s=Y(e,["messageFormatter","messageDecoder","messageEncoder"]);const a=d.useRef(null),o=d.useRef(null),l=d.useMemo(()=>({messageDecoder:i,messageEncoder:r}),[i,r]),{send:c,chatMessages:u,isSending:h}=Xm(l),p=oi(),v=d.useRef(0);function b(g){return Gc(this,null,function*(){g.preventDefault(),a.current&&a.current.value.trim()!==""&&c&&(yield c(a.current.value),a.current.value="",a.current.focus())})}return d.useEffect(()=>{var g;o&&((g=o.current)==null||g.scrollTo({top:o.current.scrollHeight}))},[o,u]),d.useEffect(()=>{var g,S,k,C,I;if(!p||u.length===0)return;if((g=p.widget.state)!=null&&g.showChat&&u.length>0&&v.current!==((S=u[u.length-1])==null?void 0:S.timestamp)){v.current=(k=u[u.length-1])==null?void 0:k.timestamp;return}const E=u.filter(L=>!v.current||L.timestamp>v.current).length,{widget:D}=p;E>0&&((C=D.state)==null?void 0:C.unreadMessages)!==E&&((I=D.dispatch)==null||I.call(D,{msg:"unread_msg",count:E}))},[u,p==null?void 0:p.widget]),d.createElement("div",Ke(O({},s),{className:"lk-chat"}),d.createElement("ul",{className:"lk-list lk-chat-messages",ref:o},s.children?u.map((g,S)=>el(s.children,{entry:g,key:S,messageFormatter:t})):u.map((g,S,k)=>{const C=S>=1&&k[S-1].from===g.from,I=S>=1&&g.timestamp-k[S-1].timestamp<6e4;return d.createElement(rv,{key:S,hideName:C,hideTimestamp:C===!1?!1:I,entry:g,messageFormatter:t})})),d.createElement("form",{className:"lk-chat-form",onSubmit:b},d.createElement("input",{className:"lk-form-control lk-chat-form-input",disabled:h,ref:a,type:"text",placeholder:"Enter a message..."}),d.createElement("button",{type:"submit",className:"lk-button lk-chat-form-button",disabled:h},"Send")))}function Ra(n){var e=n,{kind:t,initialSelection:i,onActiveDeviceChange:r,tracks:s,requestPermissions:a=!1}=e,o=Y(e,["kind","initialSelection","onActiveDeviceChange","tracks","requestPermissions"]);const[l,c]=d.useState(!1),[u,h]=d.useState([]),[p,v]=d.useState(!0),b=(C,I)=>{J.debug("handle device change"),c(!1),r==null||r(C,I)},g=d.useRef(null),S=d.useRef(null);d.useLayoutEffect(()=>{g.current&&S.current&&(u||p)&&bp(g.current,S.current).then(({x:C,y:I})=>{S.current&&Object.assign(S.current.style,{left:`${C}px`,top:`${I}px`})}),v(!1)},[g,S,u,p]);const k=d.useCallback(C=>{S.current&&C.target!==g.current&&l&&yp(S.current,C)&&c(!1)},[l,S,g]);return d.useEffect(()=>(document.addEventListener("click",k),window.addEventListener("resize",()=>v(!0)),()=>{document.removeEventListener("click",k),window.removeEventListener("resize",()=>v(!0))}),[k,v]),d.createElement(d.Fragment,null,d.createElement("button",Ke(O({className:"lk-button lk-button-menu","aria-pressed":l},o),{onClick:()=>c(!l),ref:g}),o.children),!o.disabled&&d.createElement("div",{className:"lk-device-menu",ref:S,style:{visibility:l?"visible":"hidden"}},t?d.createElement(dr,{initialSelection:i,onActiveDeviceChange:C=>b(t,C),onDeviceListChange:h,kind:t,track:s==null?void 0:s[t],requestPermissions:a}):d.createElement(d.Fragment,null,d.createElement("div",{className:"lk-device-menu-heading"},"Audio inputs"),d.createElement(dr,{kind:"audioinput",onActiveDeviceChange:C=>b("audioinput",C),onDeviceListChange:h,track:s==null?void 0:s.audioinput,requestPermissions:a}),d.createElement("div",{className:"lk-device-menu-heading"},"Video inputs"),d.createElement(dr,{kind:"videoinput",onActiveDeviceChange:C=>b("videoinput",C),onDeviceListChange:h,track:s==null?void 0:s.videoinput,requestPermissions:a}))))}function av(n){var e=n,{variation:t,controls:i}=e,r=Y(e,["variation","controls"]),s,a,o,l,c;const[u,h]=d.useState(!1),p=oi();d.useEffect(()=>{var B,N;((B=p==null?void 0:p.widget.state)==null?void 0:B.showChat)!==void 0&&h((N=p==null?void 0:p.widget.state)==null?void 0:N.showChat)},[(s=p==null?void 0:p.widget.state)==null?void 0:s.showChat]);const b=Em(`(max-width: ${u?1e3:760}px)`)?"minimal":"verbose";t??(t=b);const g=O({leave:!0},i),S=Bm();S?((a=g.camera)!=null||(g.camera=S.canPublish),(o=g.microphone)!=null||(g.microphone=S.canPublish),(l=g.screenShare)!=null||(g.screenShare=S.canPublish),(c=g.chat)!=null||(g.chat=S.canPublishData&&(i==null?void 0:i.chat))):(g.camera=!1,g.chat=!1,g.microphone=!1,g.screenShare=!1);const k=d.useMemo(()=>t==="minimal"||t==="verbose",[t]),C=d.useMemo(()=>t==="textOnly"||t==="verbose",[t]),I=Cp(),[E,D]=d.useState(!1),L=B=>{D(B)},V=Yt({className:"lk-control-bar"},r);return d.createElement("div",O({},V),g.microphone&&d.createElement("div",{className:"lk-button-group"},d.createElement(hr,{source:w.Source.Microphone,showIcon:k},C&&"Microphone"),d.createElement("div",{className:"lk-button-group-menu"},d.createElement(Ra,{kind:"audioinput"}))),g.camera&&d.createElement("div",{className:"lk-button-group"},d.createElement(hr,{source:w.Source.Camera,showIcon:k},C&&"Camera"),d.createElement("div",{className:"lk-button-group-menu"},d.createElement(Ra,{kind:"videoinput"}))),g.screenShare&&I&&d.createElement(hr,{source:w.Source.ScreenShare,captureOptions:{audio:!0,selfBrowserSurface:"include"},showIcon:k,onChange:L},C&&(E?"Stop screen share":"Share screen")),g.chat&&d.createElement(eg,null,k&&d.createElement(og,null),C&&"Chat"),g.leave&&d.createElement(tg,null,k&&d.createElement(hg,null),C&&"Leave"),d.createElement(Ag,{label:"Start Audio"}))}function ov(n){var e=n,{chatMessageFormatter:t,chatMessageDecoder:i,chatMessageEncoder:r}=e,s=Y(e,["chatMessageFormatter","chatMessageDecoder","chatMessageEncoder"]),a,o;const[l,c]=d.useState({showChat:!1,unreadMessages:0}),u=d.useRef(null),h=il([{source:w.Source.Camera,withPlaceholder:!0},{source:w.Source.ScreenShare,withPlaceholder:!1}],{updateOnlyOn:[x.ActiveSpeakersChanged],onlySubscribed:!1}),p=k=>{J.debug("updating widget state",k),c(k)},v=Rm(),b=h.filter(te).filter(k=>k.publication.source===w.Source.ScreenShare),g=(a=Wm(v))==null?void 0:a[0],S=h.filter(k=>!pp(k,g));return d.useEffect(()=>{var k,C,I,E;b.some(D=>D.publication.isSubscribed)&&u.current===null?(J.debug("Auto set screen share focus:",{newScreenShareTrack:b[0]}),(C=(k=v.pin).dispatch)==null||C.call(k,{msg:"set_pin",trackReference:b[0]}),u.current=b[0]):u.current&&!b.some(D=>{var L,V;return D.publication.trackSid===((V=(L=u.current)==null?void 0:L.publication)==null?void 0:V.trackSid)})&&(J.debug("Auto clearing screen share focus."),(E=(I=v.pin).dispatch)==null||E.call(I,{msg:"clear_pin"}),u.current=null)},[b.map(k=>`${k.publication.trackSid}_${k.publication.isSubscribed}`).join(),(o=g==null?void 0:g.publication)==null?void 0:o.trackSid]),d.createElement("div",O({className:"lk-video-conference"},s),vp()&&d.createElement(Xg,{value:v,onWidgetChange:p},d.createElement("div",{className:"lk-video-conference-inner"},g?d.createElement("div",{className:"lk-focus-layout-wrapper"},d.createElement(zg,null,d.createElement(Zg,{tracks:S},d.createElement(Vr,null)),g&&d.createElement(Wg,{trackRef:g}))):d.createElement("div",{className:"lk-grid-layout-wrapper"},d.createElement(Kg,{tracks:h},d.createElement(Vr,null))),d.createElement(av,{controls:{chat:!0}})),d.createElement(sv,{style:{display:l.showChat?"flex":"none"},messageFormatter:t,messageEncoder:r,messageDecoder:i})),d.createElement(tv,null),d.createElement(iv,null))}const Cv=({chat_id:n,video:e=!1,audio:t=!1})=>{ce().props;const[i,r]=d.useState(),[s,a]=d.useState(!0);return d.useEffect(()=>{a(!0),n&&si.get(route("livekit.generate",{chat_id:n})).then(({data:o})=>r(o)).catch(()=>mt({title:"Internal Error",description:"Please try again",variant:"destructive"})).finally(()=>a(!1))},[n]),i?f.jsx(ev,{"data-lk-theme":"default",serverUrl:{}.VITE_LIVEKIT_URL,connect:!0,token:i,video:e,audio:t,children:f.jsx(ov,{})}):f.jsxs("div",{className:"flex flex-col flex-1 justify-center items-center",children:[f.jsx(Ba,{className:"h-7 w-7 text-neutral-500 animate-spin my-3.5"}),f.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Loading...."})]})},wv=({children:n})=>(ce().props,f.jsxs("div",{className:"h-full",children:[f.jsx("div",{className:"hidden md:flex flex-col h-full w-60 z-20 inset-y-0 fixed",children:f.jsx(Ja,{})}),f.jsx("main",{className:"h-full md:pl-60",children:n})]}));export{kv as C,bv as L,Cv as M,wv as S,yv as a};
