import{c as P,q as D,r as l,W as _,h as F,j as e,g as C,a as R,y as T}from"./utils-64caab42.js";import{S as I,a as q,b as z,c as H,d as $,e as W,R as O}from"./module-c8edc7dc.js";import{U as Y,A as Q,R as B,f as G,u as U,a as K,L as A,S as V,C as J,M as X,b as Z,c as ee}from"./useChatScroll-f7e3f410.js";import{I as k,B as y,L as S,A as se,a as te,b as ae,$ as re}from"./alert-7fe151e9.js";import{t as E,u as le}from"./app-17fff6b2.js";import{A as ne,a as ie,b as oe,c as ce,d as de,e as xe}from"./alert-dialog-fd3e1fb6.js";import{D as me,i as ue,j as he,l as pe}from"./react-drag-drop-files.esm-b088b8bd.js";import{A as fe}from"./alert-circle-1273824c.js";import{L as je}from"./loader-f5ec6bed.js";import"./upload-cloud-365b74f1.js";import"./chevron-down-6a0284dd.js";const ge=P("School",[["path",{d:"m4 6 8-4 8 4",key:"1q0ilc"}],["path",{d:"m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2",key:"1vwozw"}],["path",{d:"M14 22v-4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v4",key:"cpkuc4"}],["path",{d:"M18 5v17",key:"1sw6gf"}],["path",{d:"M6 5v17",key:"1xfsm0"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]),ve="d MMMM yyyy HH:mm",Ne=({message:t,type:h,channel:d,onReply:x,hasClickedReply:s,isLastMsg:o})=>{var b;const{replies:a}=D().props,[n,p]=l.useState(t.content),[r,v]=l.useState(!1),[g,f]=l.useState(!1),{user:N}=t,i=(b=t.file)==null?void 0:b.split(".").pop(),m=i==="pdf"?route("home")+"/uploads/pdf/pdf.png":t.file,c=l.useRef(null);_({user_id:t.user_id});const j=l.useCallback(u=>{u.preventDefault(),v(!0),F.post(route("server.channel.message.update",{server_id:d.server_id,channel_id:d.id}),{message:n,message_id:t.id}).then(()=>f(!1)).catch(()=>E({title:"Internal Error",description:"Please Try Again"})).finally(()=>v(!1))},[d,n,t.id,h]);l.useEffect(()=>{c.current&&c.current.focus();const u=M=>{(M.key==="Escape"||M.code==="Escape")&&f(!1)};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[]);const w=u=>{x&&x(u)};return l.useEffect(()=>{c.current&&g&&c.current.focus()},[c,g]),e.jsx("div",{className:"relative group flex items-center hover:bg-neutral-300 dark:hover:bg-neutral-900 p-3.5 transition w-full",children:e.jsxs("div",{className:"group flex gap-x-1.5 items-start w-full",children:[e.jsx("div",{className:"cursor-pointer hover:drop-shadow-md transition",children:t.is_system_msg===0?e.jsx(Y,{user:N}):""}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex items-center gap-x-1.5",children:[e.jsx("div",{className:"flex items-center",children:t.is_system_msg===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:C("font-semibold text-sm transition"),children:N.name}),e.jsx(Q,{label:"Admin",children:e.jsx("p",{children:B.ADMIN})})]}):e.jsx("p",{className:C("font-semibold text-sm transition"),children:"System"})}),e.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:G(new Date(t.created_at),ve)})]}),t.file&&!t.deleted_at&&e.jsx("a",{href:t.file,target:"_blank",rel:"noopener noreferrer",className:C("relative aspect-square rounded-md mt-1.5 overflow-hidden border flex items-center bg-secondary ",i==="pdf"?"h-10 w-10":"h-48 w-48"),children:e.jsx("img",{src:m,alt:"file",className:"object-cover"})}),e.jsx("p",{className:C("text-xs",i==="pdf"&&!t.deleted_at?"block":"hidden"),children:"PDF File"}),!g&&e.jsxs("p",{className:C("text-sm my-4 text-neutral-600 dark:text-neutral-300",t.deleted_at&&"italic text-neutral-500 dark:text-neutral-400 text-xs mt-1"),children:[t.deleted_at?"Message Deleted":t.content,t.created_at!==t.updated_at&&!t.deleted_at&&e.jsx("span",{className:"text-[0.625rem] mx-1.5 text-neutral-500 dark:text-neutral-400",children:"(edited)"})]}),!t.file&&g&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"flex items-center w-full gap-x-1.5 pt-1.5",onSubmit:j,children:[e.jsx("div",{className:"flex-1",children:e.jsx(k,{disabled:r,ref:c,value:n,onChange:({target:u})=>p(u.value),className:"p-1.5 bg-neutral-200/90 dark:bg-neutral-700/75 border-none !border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0 text-neutral-600 dark:text-neutral-200"})}),e.jsx(y,{size:"sm",disabled:r,children:"Save"})]}),e.jsx("span",{className:"text-[0.625rem] mt-1 text-neutral-400",children:"Press ESC to cancel. Press Enter to save."})]}),t.is_system_msg===1&&!s&&d.is_closed!==1&&o&&e.jsx("div",{className:"w-full grid grid-cols-2 gap-3 pb-3.5",children:a.map(u=>e.jsx(y,{variant:"outline",size:"sm",onClick:()=>w(u),children:u},u))})]})]})})},be=({channel:t,getMsgsRoute:h,onReply:d,hasClickedReply:x})=>{var i,m;const s=l.useRef(null),o=l.useRef(null),{data:a,fetchNextPage:n,hasNextPage:p,isFetchingNextPage:r,status:v}=U({queryRoute:h,queryKey:`channel_${t.id.toString()}`,value:"0"}),g=()=>{if(!(a!=null&&a.pages))return null;n()},f=c=>{d&&d(c)};K({chatRef:s,bottomRef:o,loadMore:g,shouldLoadMore:!r&&!!p,count:((m=(i=a==null?void 0:a.pages)==null?void 0:i[0])==null?void 0:m.data.length)??0});const N=a==null?void 0:a.pages;return v==="loading"?e.jsxs("div",{className:"flex flex-col flex-1 justify-center items-center",children:[e.jsx(A,{className:"h-7 w-7 text-neutral-500 animate-spin my-3.5"}),e.jsx("p",{className:"text-xs",children:"Loading Messages..."})]}):v==="error"?e.jsxs("div",{className:"flex flex-col flex-1 justify-center items-center",children:[e.jsx(V,{className:"h-7 w-7 text-neutral-500 my-3.5"}),e.jsx("p",{className:"text-xs",children:"Server Error"})]}):e.jsxs("div",{ref:s,className:"flex-1 flex flex-col py-3.5 overflow-y-auto",children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1"}),e.jsx(J,{type:"Channel",name:t.name})]}),p&&e.jsx("div",{className:"flex justify-center",children:r?e.jsx(A,{className:"h-6 w-6 text-neutral-600 animate-ping"}):e.jsx("button",{onClick:g,className:"text-neutral-500 hover:text-neutral-600 dark:text-neutral-400 dark:hover:text-neutral-300 transition text-xs",children:"Load Previous Messages..."})}),e.jsx("div",{className:"flex flex-col-reverse mt-auto",children:N==null?void 0:N.map((c,j)=>{var w;return e.jsx(l.Fragment,{children:(w=c.data)==null?void 0:w.map((b,u)=>e.jsx(Ne,{isLastMsg:c.data.length===u+1,hasClickedReply:x,onReply:f,channel:t,type:"Channel",message:b},b.id))},j)})}),e.jsx("div",{ref:o})]})},L=`${{}.VITE_APP_NAME}`,Te=({channel:t,user:h})=>{const{data:d,setData:x,post:s,get:o,processing:a,errors:n,reset:p}=_({name:"",email:"",password:"",password_confirmation:""}),r=f=>{f.preventDefault(),s(route("support.enter"),{preserveState:!1,onError:N=>{console.error(N)}})},[v,g]=l.useState(!1);return console.log([t,h]),e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"Welcome to"}),e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 text-primary py-4 text-center md:text-left shadow-md",children:e.jsxs("div",{className:"container flex items-center",children:[e.jsxs("h1",{className:"text-xl font-extrabold w-full flex items-center",children:[e.jsx(ge,{className:"mr-4"}),e.jsx("span",{children:L})]}),e.jsx("button",{onClick:()=>g(!0),className:"bg-primary rounded text-secondary text-sm w-28 p-2",children:"Login"})]})}),e.jsx("section",{className:"py-10 bg-gray-300 dark:bg-gray-700 flex-1",children:e.jsxs("div",{className:"container flex flex-col-reverse md:flex-row items-center",children:[e.jsxs("div",{className:`w-full p-5 bg-gray-100/50 dark:bg-gray-600 rounded-md shadow-md
                                    md:w-1/3`,children:[e.jsx("h1",{className:"font-bold",children:"For inquiry or support"}),e.jsx("p",{className:"text-sm mt-1 mb-5",children:"Send us a message by providing contact details"}),e.jsxs("form",{onSubmit:r,children:[e.jsxs("div",{className:"grid flex-1 gap-2 mb-4",children:[e.jsx(S,{htmlFor:"name",children:"Name:"}),e.jsx(k,{required:!0,autoFocus:!0,autoComplete:"off",disabled:a,value:d.name,onChange:({target:f})=>x("name",f.value),id:"name",className:"dark:bg-gray-700"}),n.email&&e.jsx("span",{children:n.name})]}),e.jsxs("div",{className:"grid flex-1 gap-2",children:[e.jsx(S,{htmlFor:"email",children:"Email:"}),e.jsx(k,{required:!0,type:"email",autoComplete:"off",disabled:a,value:d.email,onChange:({target:f})=>x("email",f.value),id:"email",className:"dark:bg-gray-700"}),n.email&&e.jsx("span",{children:n.email})]}),e.jsx("div",{className:"flex items-center justify-center mt-4",children:e.jsx(y,{className:"ml-4",disabled:a,children:"Send Message"})})]})]}),e.jsx("div",{className:"mb-5 md:mb-0 md:ml-auto",children:e.jsx("img",{src:`${route("landing")}/images/school.svg`,className:"w-full h-[15rem] md:h-[30rem]"})})]})})]}),e.jsx(we,{isOpen:!!t,onClose:()=>{},channel:t,user:h}),e.jsx(ye,{openLogin:v,onClose:()=>g(!1)})]})},ye=({openLogin:t,onClose:h})=>{const{data:d,setData:x,post:s,processing:o,errors:a,reset:n}=_({email:"",password:"",remember:!1});l.useEffect(()=>()=>{n("password")},[]);const p=r=>{r.preventDefault(),s(route("login"),{onSuccess:()=>T.get(route("home"))})};return e.jsx(me,{open:t,onOpenChange:h,children:e.jsxs(ue,{className:"sm:max-w-[425px]",children:[e.jsx(he,{}),e.jsx(pe,{}),e.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[e.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Sign In"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter your email and password"})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("form",{onSubmit:p,children:[(a.email||a.password)&&e.jsxs(se,{variant:"destructive",className:"mb-6",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx(te,{children:"Error"}),e.jsxs(ae,{className:"flex flex-col space-y-1.5",children:[e.jsx("span",{children:a==null?void 0:a.email}),e.jsx("span",{children:a==null?void 0:a.password})]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(k,{required:!0,id:"email",placeholder:"name@example.com",type:"text",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:o,onChange:({target:r})=>x("email",r.value)})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(S,{htmlFor:"password",children:"Password"}),e.jsx(k,{required:!0,id:"password",placeholder:"password",type:"password",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",disabled:o,onChange:({target:r})=>x("password",r.value)})]}),e.jsxs(y,{disabled:o,children:[o&&e.jsx(je,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In"]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"absolute inset-0 flex items-center"})})]})]})]})})},we=({isOpen:t,channel:h,onClose:d,user:x})=>{const[s,o]=l.useState(h),[a,n]=l.useState(!1);D().props;const p=l.useMemo(()=>route("server.channel.message.store",{server_id:(s==null?void 0:s.server_id)||"",channel_id:(s==null?void 0:s.id)||""}),[s]),r=l.useMemo(()=>route("server.channel.message.index",{server_id:(s==null?void 0:s.server_id)||"",channel_id:(s==null?void 0:s.id)||""}),[s]),v=le(),[g,f]=l.useState(!1),N=i=>{n(!0),F.post(p,{message:i}).catch(()=>{E({title:"Internal Error",description:"Can't send message. Please try again!"}),n(!1)})};return l.useEffect(()=>{s&&window.Echo.join("channel_"+s.id.toString()).listen("NewChatMessageEvent",({message:i})=>{v.setQueryData([`channel_${s.id.toString()}`],m=>{const{pages:c}=m,j=c;return j[0]={...j[0],data:[i,...j[0].data]},{...m,pages:j}})}).listen("MessageUpdateEvent",({message:i})=>{v.setQueryData([`channel_${s.id.toString()}`],m=>{const{pages:c}=m,j=c;return j[0]={...j[0],data:j[0].data.map(b=>b.id!==i.id?b:i)},{...m,pages:j}})}).listen("CloseCaseEvent",i=>{s&&o(m=>({...m,is_closed:1}))})},[s==null?void 0:s.id,v]),!s||!x?null:e.jsxs(e.Fragment,{children:[e.jsx(I,{open:t,children:e.jsxs(q,{className:"w-full sm:w-[420px] h-full flex flex-col overflow-y-hidden space-y-2",children:[e.jsxs(z,{className:"h-auto",children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("p",{children:["Welcome to ",L]}),e.jsx("div",{className:"w-12 ml-auto",children:e.jsx(X,{})})]})}),e.jsx($,{children:"You Are Now Connected to Chat Support. Please be patient while we assign an agent"})]}),e.jsx("hr",{}),e.jsx("div",{className:"flex-1 flex flex-col overflow-y-hidden",children:e.jsx("div",{className:"flex-1 mb-2 overflow-auto",children:e.jsx(be,{hasClickedReply:a,onReply:N,getMsgsRoute:r,channel:s})})}),e.jsx("div",{className:"h-auto",children:s.is_closed!==1?e.jsx(Z,{apiRoute:p,type:"Channel",name:"Chat Support"}):e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx("p",{className:"font-semibold text-lg tracking-tight",children:"This Case Has Been Closed. You Can Not Reply To This Thread Anymore"}),(s.rating<0||!(s!=null&&s.rating))&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold text-lg tracking-tight",children:"Would You Like To Give a Feedback?"}),e.jsx(y,{onClick:()=>f(!0),children:"Give Feedback"})]}),s.rating>-1&&e.jsx("p",{className:"font-semibold text-lg tracking-tight",children:"Thank You For Your Feedback"})]})})]})}),e.jsx(Ce,{onFeedback:i=>{o(m=>({...m,rating:i}))},channel_id:s.id,isOpen:g,onClose:()=>f(!1)}),e.jsx(ee,{})]})},Ce=({isOpen:t,onClose:h,channel_id:d,onFeedback:x})=>{const[s,o]=l.useState(0),[a,n]=l.useState(""),p=()=>{F.post(route("support.feedback"),{rating:s,channel_id:d,feedbackComment:a}).then(()=>{h(),x(s)}).catch(r=>E({description:"Something Went Wrong. Please try again",variant:"destructive"}))};return e.jsx(ne,{open:t,children:e.jsxs(ie,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Please rate us! "}),e.jsx(de,{asChild:!0,children:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:" We appreciate your feedback."}),e.jsxs("div",{style:{direction:"ltr",fontFamily:"sans-serif",touchAction:"none"},children:[e.jsx(O,{allowHover:!1,transition:!0,SVGclassName:"inline-block",onClick:r=>o(r)}),e.jsxs("div",{className:"w-full",children:[e.jsx(re,{className:"uppercase text-xs font-bold",children:"Feedback / Comment"}),e.jsx("textarea",{onChange:({target:r})=>n(r.value),className:"w-full border-0 focus-visible:!ring-0 focus-visible:!ring-offset-0 resize-none rounded-md dark:bg-zinc-700"})]})]})]})})]}),e.jsxs(xe,{children:[e.jsx(y,{onClick:h,size:"sm",variant:"outline",children:"Cancel"}),e.jsx(y,{onClick:p,size:"sm",children:"Proceed"})]})]})})};export{L as APP_NAME,Te as default};
